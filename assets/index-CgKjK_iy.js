const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browserAll-UOYsXu61.js","assets/webworkerAll-CL809bMJ.js","assets/colorToUniform-qnd6aMeR.js","assets/WebGPURenderer-DEY6rgTF.js","assets/SharedSystems-DcqHkODC.js","assets/WebGLRenderer-DCiX61iL.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();const Sa=!1,Ca=(s,t)=>s===t,qt=Symbol("solid-proxy"),gi=Symbol("solid-track"),bs={equals:Ca};let Rn=Dn;const Gt=1,As=2,Bn={owned:null,cleanups:null,context:null,owner:null};var V=null;let $s=null,Pa=null,Z=null,st=null,Mt=null,Ls=0;function ys(s,t){const e=Z,i=V,r=s.length===0,n=t===void 0?i:t,o=r?Bn:{owned:null,cleanups:null,context:n?n.context:null,owner:n},a=r?s:()=>s(()=>Rt(()=>Ne(o)));V=o,Z=null;try{return fe(a,!0)}finally{Z=e,V=i}}function de(s,t){t=t?Object.assign({},bs,t):bs;const e={value:s,observers:null,observerSlots:null,comparator:t.equals||void 0},i=r=>(typeof r=="function"&&(r=r(e.value)),On(e,r));return[Gn.bind(e),i]}function oe(s,t,e){const i=Wi(s,t,!1,Gt);Ze(i)}function Fn(s,t,e){Rn=Fa;const i=Wi(s,t,!1,Gt);i.user=!0,Mt?Mt.push(i):Ze(i)}function se(s,t,e){e=e?Object.assign({},bs,e):bs;const i=Wi(s,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=e.equals||void 0,Ze(i),Gn.bind(i)}function Ta(s){return fe(s,!1)}function Rt(s){if(Z===null)return s();const t=Z;Z=null;try{return s()}finally{Z=t}}function ka(s){Fn(()=>Rt(s))}function Ln(s){return V===null||(V.cleanups===null?V.cleanups=[s]:V.cleanups.push(s)),s}function mi(){return Z}function Ma(s,t){const e=Symbol("context");return{id:e,Provider:Ga(e),defaultValue:s}}function Ea(s){let t;return V&&V.context&&(t=V.context[s.id])!==void 0?t:s.defaultValue}function Ia(s){const t=se(s),e=se(()=>yi(t()));return e.toArray=()=>{const i=e();return Array.isArray(i)?i:i!=null?[i]:[]},e}function Gn(){if(this.sources&&this.state)if(this.state===Gt)Ze(this);else{const s=st;st=null,fe(()=>Ss(this),!1),st=s}if(Z){const s=this.observers?this.observers.length:0;Z.sources?(Z.sources.push(this),Z.sourceSlots.push(s)):(Z.sources=[this],Z.sourceSlots=[s]),this.observers?(this.observers.push(Z),this.observerSlots.push(Z.sources.length-1)):(this.observers=[Z],this.observerSlots=[Z.sources.length-1])}return this.value}function On(s,t,e){let i=s.value;return(!s.comparator||!s.comparator(i,t))&&(s.value=t,s.observers&&s.observers.length&&fe(()=>{for(let r=0;r<s.observers.length;r+=1){const n=s.observers[r],o=$s&&$s.running;o&&$s.disposed.has(n),(o?!n.tState:!n.state)&&(n.pure?st.push(n):Mt.push(n),n.observers&&zn(n)),o||(n.state=Gt)}if(st.length>1e6)throw st=[],new Error},!1)),t}function Ze(s){if(!s.fn)return;Ne(s);const t=Ls;Ra(s,s.value,t)}function Ra(s,t,e){let i;const r=V,n=Z;Z=V=s;try{i=s.fn(t)}catch(o){return s.pure&&(s.state=Gt,s.owned&&s.owned.forEach(Ne),s.owned=null),s.updatedAt=e+1,Wn(o)}finally{Z=n,V=r}(!s.updatedAt||s.updatedAt<=e)&&(s.updatedAt!=null&&"observers"in s?On(s,i):s.value=i,s.updatedAt=e)}function Wi(s,t,e,i=Gt,r){const n={fn:s,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:V,context:V?V.context:null,pure:e};return V===null||V!==Bn&&(V.owned?V.owned.push(n):V.owned=[n]),n}function vs(s){if(s.state===0)return;if(s.state===As)return Ss(s);if(s.suspense&&Rt(s.suspense.inFallback))return s.suspense.effects.push(s);const t=[s];for(;(s=s.owner)&&(!s.updatedAt||s.updatedAt<Ls);)s.state&&t.push(s);for(let e=t.length-1;e>=0;e--)if(s=t[e],s.state===Gt)Ze(s);else if(s.state===As){const i=st;st=null,fe(()=>Ss(s,t[0]),!1),st=i}}function fe(s,t){if(st)return s();let e=!1;t||(st=[]),Mt?e=!0:Mt=[],Ls++;try{const i=s();return Ba(e),i}catch(i){e||(Mt=null),st=null,Wn(i)}}function Ba(s){if(st&&(Dn(st),st=null),s)return;const t=Mt;Mt=null,t.length&&fe(()=>Rn(t),!1)}function Dn(s){for(let t=0;t<s.length;t++)vs(s[t])}function Fa(s){let t,e=0;for(t=0;t<s.length;t++){const i=s[t];i.user?s[e++]=i:vs(i)}for(t=0;t<e;t++)vs(s[t])}function Ss(s,t){s.state=0;for(let e=0;e<s.sources.length;e+=1){const i=s.sources[e];if(i.sources){const r=i.state;r===Gt?i!==t&&(!i.updatedAt||i.updatedAt<Ls)&&vs(i):r===As&&Ss(i,t)}}}function zn(s){for(let t=0;t<s.observers.length;t+=1){const e=s.observers[t];e.state||(e.state=As,e.pure?st.push(e):Mt.push(e),e.observers&&zn(e))}}function Ne(s){let t;if(s.sources)for(;s.sources.length;){const e=s.sources.pop(),i=s.sourceSlots.pop(),r=e.observers;if(r&&r.length){const n=r.pop(),o=e.observerSlots.pop();i<r.length&&(n.sourceSlots[o]=i,r[i]=n,e.observerSlots[i]=o)}}if(s.tOwned){for(t=s.tOwned.length-1;t>=0;t--)Ne(s.tOwned[t]);delete s.tOwned}if(s.owned){for(t=s.owned.length-1;t>=0;t--)Ne(s.owned[t]);s.owned=null}if(s.cleanups){for(t=s.cleanups.length-1;t>=0;t--)s.cleanups[t]();s.cleanups=null}s.state=0}function La(s){return s instanceof Error?s:new Error(typeof s=="string"?s:"Unknown error",{cause:s})}function Wn(s,t=V){throw La(s)}function yi(s){if(typeof s=="function"&&!s.length)return yi(s());if(Array.isArray(s)){const t=[];for(let e=0;e<s.length;e++){const i=yi(s[e]);Array.isArray(i)?t.push.apply(t,i):t.push(i)}return t}return s}function Ga(s,t){return function(i){let r;return oe(()=>r=Rt(()=>(V.context={...V.context,[s]:i.value},Ia(()=>i.children))),void 0),r}}const Oa=Symbol("fallback");function ar(s){for(let t=0;t<s.length;t++)s[t]()}function Da(s,t,e={}){let i=[],r=[],n=[],o=0,a=t.length>1?[]:null;return Ln(()=>ar(n)),()=>{let h=s()||[],l=h.length,c,u;return h[gi],Rt(()=>{let d,p,y,g,x,_,m,w,v;if(l===0)o!==0&&(ar(n),n=[],i=[],r=[],o=0,a&&(a=[])),e.fallback&&(i=[Oa],r[0]=ys(b=>(n[0]=b,e.fallback())),o=1);else if(o===0){for(r=new Array(l),u=0;u<l;u++)i[u]=h[u],r[u]=ys(f);o=l}else{for(y=new Array(l),g=new Array(l),a&&(x=new Array(l)),_=0,m=Math.min(o,l);_<m&&i[_]===h[_];_++);for(m=o-1,w=l-1;m>=_&&w>=_&&i[m]===h[w];m--,w--)y[w]=r[m],g[w]=n[m],a&&(x[w]=a[m]);for(d=new Map,p=new Array(w+1),u=w;u>=_;u--)v=h[u],c=d.get(v),p[u]=c===void 0?-1:c,d.set(v,u);for(c=_;c<=m;c++)v=i[c],u=d.get(v),u!==void 0&&u!==-1?(y[u]=r[c],g[u]=n[c],a&&(x[u]=a[c]),u=p[u],d.set(v,u)):n[c]();for(u=_;u<l;u++)u in y?(r[u]=y[u],n[u]=g[u],a&&(a[u]=x[u],a[u](u))):r[u]=ys(f);r=r.slice(0,o=l),i=h.slice(0)}return r});function f(d){if(n[u]=d,a){const[p,y]=de(u);return a[u]=y,t(h[u],p)}return t(h[u])}}}function ot(s,t){return Rt(()=>s(t||{}))}const za=s=>`Stale read from <${s}>.`;function hr(s){const t="fallback"in s&&{fallback:()=>s.fallback};return se(Da(()=>s.each,s.children,t||void 0))}function Wa(s){const t=s.keyed,e=se(()=>s.when,void 0,void 0),i=t?e:se(e,void 0,{equals:(r,n)=>!r==!n});return se(()=>{const r=i();if(r){const n=s.children;return typeof n=="function"&&n.length>0?Rt(()=>n(t?r:()=>{if(!Rt(i))throw za("Show");return e()})):n}return s.fallback},void 0,void 0)}function Na(s,t,e){let i=e.length,r=t.length,n=i,o=0,a=0,h=t[r-1].nextSibling,l=null;for(;o<r||a<n;){if(t[o]===e[a]){o++,a++;continue}for(;t[r-1]===e[n-1];)r--,n--;if(r===o){const c=n<i?a?e[a-1].nextSibling:e[n-a]:h;for(;a<n;)s.insertBefore(e[a++],c)}else if(n===a)for(;o<r;)(!l||!l.has(t[o]))&&t[o].remove(),o++;else if(t[o]===e[n-1]&&e[a]===t[r-1]){const c=t[--r].nextSibling;s.insertBefore(e[a++],t[o++].nextSibling),s.insertBefore(e[--n],c),t[r]=e[n]}else{if(!l){l=new Map;let u=a;for(;u<n;)l.set(e[u],u++)}const c=l.get(t[o]);if(c!=null)if(a<c&&c<n){let u=o,f=1,d;for(;++u<r&&u<n&&!((d=l.get(t[u]))==null||d!==c+f);)f++;if(f>c-a){const p=t[o];for(;a<c;)s.insertBefore(e[a++],p)}else s.replaceChild(e[a++],t[o++])}else o++;else t[o++].remove()}}}const lr="_$DX_DELEGATE";function $a(s,t,e,i={}){let r;return ys(n=>{r=n,t===document?s():mt(t,s(),t.firstChild?null:void 0,e)},i.owner),()=>{r(),t.textContent=""}}function Ct(s,t,e,i){let r;const n=()=>{const a=document.createElement("template");return a.innerHTML=s,a.content.firstChild},o=()=>(r||(r=n())).cloneNode(!0);return o.cloneNode=o,o}function Ua(s,t=window.document){const e=t[lr]||(t[lr]=new Set);for(let i=0,r=s.length;i<r;i++){const n=s[i];e.has(n)||(e.add(n),t.addEventListener(n,ja))}}function Ha(s,t,e){e==null?s.removeAttribute(t):s.setAttribute(t,e)}function Va(s,t){t==null?s.removeAttribute("class"):s.className=t}function rt(s,t,e){e!=null?s.style.setProperty(t,e):s.style.removeProperty(t)}function Nn(s,t,e){return Rt(()=>s(t,e))}function mt(s,t,e,i){if(e!==void 0&&!i&&(i=[]),typeof t!="function")return Cs(s,t,i,e);oe(r=>Cs(s,t(),r,e),i)}function ja(s){let t=s.target;const e=`$$${s.type}`,i=s.target,r=s.currentTarget,n=h=>Object.defineProperty(s,"target",{configurable:!0,value:h}),o=()=>{const h=t[e];if(h&&!t.disabled){const l=t[`${e}Data`];if(l!==void 0?h.call(t,l,s):h.call(t,s),s.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(s.target)&&n(t.host),!0},a=()=>{for(;o()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(s,"currentTarget",{configurable:!0,get(){return t||document}}),s.composedPath){const h=s.composedPath();n(h[0]);for(let l=0;l<h.length-2&&(t=h[l],!!o());l++){if(t._$host){t=t._$host,a();break}if(t.parentNode===r)break}}else a();n(i)}function Cs(s,t,e,i,r){for(;typeof e=="function";)e=e();if(t===e)return e;const n=typeof t,o=i!==void 0;if(s=o&&e[0]&&e[0].parentNode||s,n==="string"||n==="number"){if(n==="number"&&(t=t.toString(),t===e))return e;if(o){let a=e[0];a&&a.nodeType===3?a.data!==t&&(a.data=t):a=document.createTextNode(t),e=Qt(s,e,i,a)}else e!==""&&typeof e=="string"?e=s.firstChild.data=t:e=s.textContent=t}else if(t==null||n==="boolean")e=Qt(s,e,i);else{if(n==="function")return oe(()=>{let a=t();for(;typeof a=="function";)a=a();e=Cs(s,a,e,i)}),()=>e;if(Array.isArray(t)){const a=[],h=e&&Array.isArray(e);if(xi(a,t,e,r))return oe(()=>e=Cs(s,a,e,i,!0)),()=>e;if(a.length===0){if(e=Qt(s,e,i),o)return e}else h?e.length===0?cr(s,a,i):Na(s,e,a):(e&&Qt(s),cr(s,a));e=a}else if(t.nodeType){if(Array.isArray(e)){if(o)return e=Qt(s,e,i,t);Qt(s,e,null,t)}else e==null||e===""||!s.firstChild?s.appendChild(t):s.replaceChild(t,s.firstChild);e=t}}return e}function xi(s,t,e,i){let r=!1;for(let n=0,o=t.length;n<o;n++){let a=t[n],h=e&&e[s.length],l;if(!(a==null||a===!0||a===!1))if((l=typeof a)=="object"&&a.nodeType)s.push(a);else if(Array.isArray(a))r=xi(s,a,h)||r;else if(l==="function")if(i){for(;typeof a=="function";)a=a();r=xi(s,Array.isArray(a)?a:[a],Array.isArray(h)?h:[h])||r}else s.push(a),r=!0;else{const c=String(a);h&&h.nodeType===3&&h.data===c?s.push(h):s.push(document.createTextNode(c))}}return r}function cr(s,t,e=null){for(let i=0,r=t.length;i<r;i++)s.insertBefore(t[i],e)}function Qt(s,t,e,i){if(e===void 0)return s.textContent="";const r=i||document.createTextNode("");if(t.length){let n=!1;for(let o=t.length-1;o>=0;o--){const a=t[o];if(r!==a){const h=a.parentNode===s;!n&&!o?h?s.replaceChild(r,a):s.insertBefore(r,e):h&&a.remove()}else n=!0}}else s.insertBefore(r,e);return[r]}const Ya="modulepreload",Xa=function(s){return"/Three_Cow_Problem/"+s},ur={},Ps=function(t,e,i){let r=Promise.resolve();if(e&&e.length>0){let h=function(l){return Promise.all(l.map(c=>Promise.resolve(c).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");r=h(e.map(l=>{if(l=Xa(l),l in ur)return;ur[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":Ya,c||(f.as="script"),f.crossOrigin="",f.href=l,a&&f.setAttribute("nonce",a),document.head.appendChild(f),c)return new Promise((d,p)=>{f.addEventListener("load",d),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return t().catch(n)})};var R=(s=>(s.Application="application",s.WebGLPipes="webgl-pipes",s.WebGLPipesAdaptor="webgl-pipes-adaptor",s.WebGLSystem="webgl-system",s.WebGPUPipes="webgpu-pipes",s.WebGPUPipesAdaptor="webgpu-pipes-adaptor",s.WebGPUSystem="webgpu-system",s.CanvasSystem="canvas-system",s.CanvasPipesAdaptor="canvas-pipes-adaptor",s.CanvasPipes="canvas-pipes",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s.MaskEffect="mask-effect",s.BlendMode="blend-mode",s.TextureSource="texture-source",s.Environment="environment",s.ShapeBuilder="shape-builder",s.Batcher="batcher",s))(R||{});const _i=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},ss=(s,t)=>_i(s).priority??t,tt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(_i).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...s){return s.map(_i).forEach(t=>{t.type.forEach(e=>{const i=this._addHandlers,r=this._queue;i[e]?i[e]?.(t):(r[e]=r[e]||[],r[e]?.push(t))})}),this},handle(s,t,e){const i=this._addHandlers,r=this._removeHandlers;if(i[s]||r[s])throw new Error(`Extension type ${s} already has a handler`);i[s]=t,r[s]=e;const n=this._queue;return n[s]&&(n[s]?.forEach(o=>t(o)),delete n[s]),this},handleByMap(s,t){return this.handle(s,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByNamedList(s,t,e=-1){return this.handle(s,i=>{t.findIndex(n=>n.name===i.name)>=0||(t.push({name:i.name,value:i.ref}),t.sort((n,o)=>ss(o.value,e)-ss(n.value,e)))},i=>{const r=t.findIndex(n=>n.name===i.name);r!==-1&&t.splice(r,1)})},handleByList(s,t,e=-1){return this.handle(s,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((r,n)=>ss(n,e)-ss(r,e)))},i=>{const r=t.indexOf(i.ref);r!==-1&&t.splice(r,1)})},mixin(s,...t){for(const e of t)Object.defineProperties(s.prototype,Object.getOwnPropertyDescriptors(e))}},qa={extension:{type:R.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await Ps(()=>import("./browserAll-UOYsXu61.js"),__vite__mapDeps([0,1,2]))}},Ka={extension:{type:R.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await Ps(()=>import("./webworkerAll-CL809bMJ.js"),__vite__mapDeps([1,2]))}};class J{constructor(t,e,i){this._x=e||0,this._y=i||0,this._observer=t}clone(t){return new J(t??this._observer,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this._observer._onUpdate(this)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this._observer._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer._onUpdate(this))}}function $n(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Us={exports:{}},dr;function Za(){return dr||(dr=1,(function(s){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function r(h,l,c){this.fn=h,this.context=l,this.once=c||!1}function n(h,l,c,u,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var d=new r(c,u||h,f),p=e?e+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],d]:h._events[p].push(d):(h._events[p]=d,h._eventsCount++),h}function o(h,l){--h._eventsCount===0?h._events=new i:delete h._events[l]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],c,u;if(this._eventsCount===0)return l;for(u in c=this._events)t.call(c,u)&&l.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},a.prototype.listeners=function(l){var c=e?e+l:l,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var f=0,d=u.length,p=new Array(d);f<d;f++)p[f]=u[f].fn;return p},a.prototype.listenerCount=function(l){var c=e?e+l:l,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(l,c,u,f,d,p){var y=e?e+l:l;if(!this._events[y])return!1;var g=this._events[y],x=arguments.length,_,m;if(g.fn){switch(g.once&&this.removeListener(l,g.fn,void 0,!0),x){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,u),!0;case 4:return g.fn.call(g.context,c,u,f),!0;case 5:return g.fn.call(g.context,c,u,f,d),!0;case 6:return g.fn.call(g.context,c,u,f,d,p),!0}for(m=1,_=new Array(x-1);m<x;m++)_[m-1]=arguments[m];g.fn.apply(g.context,_)}else{var w=g.length,v;for(m=0;m<w;m++)switch(g[m].once&&this.removeListener(l,g[m].fn,void 0,!0),x){case 1:g[m].fn.call(g[m].context);break;case 2:g[m].fn.call(g[m].context,c);break;case 3:g[m].fn.call(g[m].context,c,u);break;case 4:g[m].fn.call(g[m].context,c,u,f);break;default:if(!_)for(v=1,_=new Array(x-1);v<x;v++)_[v-1]=arguments[v];g[m].fn.apply(g[m].context,_)}}return!0},a.prototype.on=function(l,c,u){return n(this,l,c,u,!1)},a.prototype.once=function(l,c,u){return n(this,l,c,u,!0)},a.prototype.removeListener=function(l,c,u,f){var d=e?e+l:l;if(!this._events[d])return this;if(!c)return o(this,d),this;var p=this._events[d];if(p.fn)p.fn===c&&(!f||p.once)&&(!u||p.context===u)&&o(this,d);else{for(var y=0,g=[],x=p.length;y<x;y++)(p[y].fn!==c||f&&!p[y].once||u&&p[y].context!==u)&&g.push(p[y]);g.length?this._events[d]=g.length===1?g[0]:g:o(this,d)}return this},a.prototype.removeAllListeners=function(l){var c;return l?(c=e?e+l:l,this._events[c]&&o(this,c)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,s.exports=a})(Us)),Us.exports}var Qa=Za();const _t=$n(Qa),Ja=Math.PI*2,th=180/Math.PI,eh=Math.PI/180;class et{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new et(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return Hs.x=0,Hs.y=0,Hs}}const Hs=new et;class F{constructor(t=1,e=0,i=0,r=1,n=0,o=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,r,n,o){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new et;const i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e}applyInverse(t,e){e=e||new et;const i=this.a,r=this.b,n=this.c,o=this.d,a=this.tx,h=this.ty,l=1/(i*o+n*-r),c=t.x,u=t.y;return e.x=o*l*c+-n*l*u+(h*n-a*o)*l,e.y=i*l*u+-r*l*c+(-h*i+a*r)*l,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),r=this.a,n=this.c,o=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this}append(t){const e=this.a,i=this.b,r=this.c,n=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this}appendFrom(t,e){const i=t.a,r=t.b,n=t.c,o=t.d,a=t.tx,h=t.ty,l=e.a,c=e.b,u=e.c,f=e.d;return this.a=i*l+r*u,this.b=i*c+r*f,this.c=n*l+o*u,this.d=n*c+o*f,this.tx=a*l+h*u+e.tx,this.ty=a*c+h*f+e.ty,this}setTransform(t,e,i,r,n,o,a,h,l){return this.a=Math.cos(a+l)*n,this.b=Math.sin(a+l)*n,this.c=-Math.sin(a-h)*o,this.d=Math.cos(a-h)*o,this.tx=t-(i*this.a+r*this.c),this.ty=e-(i*this.b+r*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,r=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,r=this.c,n=this.d,o=t.pivot,a=-Math.atan2(-r,n),h=Math.atan2(i,e),l=Math.abs(a+h);return l<1e-5||Math.abs(Ja-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx+(o.x*e+o.y*r),t.position.y=this.ty+(o.x*i+o.y*n),t}invert(){const t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,o=t*r-e*i;return this.a=r/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-r*n)/o,this.ty=-(t*this.ty-e*n)/o,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new F;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return ih.identity()}static get shared(){return sh.identity()}}const sh=new F,ih=new F,Ht=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Vt=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],jt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Yt=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],wi=[],Un=[],is=Math.sign;function rh(){for(let s=0;s<16;s++){const t=[];wi.push(t);for(let e=0;e<16;e++){const i=is(Ht[s]*Ht[e]+jt[s]*Vt[e]),r=is(Vt[s]*Ht[e]+Yt[s]*Vt[e]),n=is(Ht[s]*jt[e]+jt[s]*Yt[e]),o=is(Vt[s]*jt[e]+Yt[s]*Yt[e]);for(let a=0;a<16;a++)if(Ht[a]===i&&Vt[a]===r&&jt[a]===n&&Yt[a]===o){t.push(a);break}}}for(let s=0;s<16;s++){const t=new F;t.set(Ht[s],Vt[s],jt[s],Yt[s],0,0),Un.push(t)}}rh();const W={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>Ht[s],uY:s=>Vt[s],vX:s=>jt[s],vY:s=>Yt[s],inv:s=>s&8?s&15:-s&7,add:(s,t)=>wi[s][t],sub:(s,t)=>wi[s][W.inv(t)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,t)=>Math.abs(s)*2<=Math.abs(t)?t>=0?W.S:W.N:Math.abs(t)*2<=Math.abs(s)?s>0?W.E:W.W:t>0?s>0?W.SE:W.SW:s>0?W.NE:W.NW,matrixAppendRotationInv:(s,t,e=0,i=0)=>{const r=Un[W.inv(t)];r.tx=e,r.ty=i,s.append(r)},transformRectCoords:(s,t,e,i)=>{const{x:r,y:n,width:o,height:a}=s,{x:h,y:l,width:c,height:u}=t;return e===W.E?(i.set(r+h,n+l,o,a),i):e===W.S?i.set(c-n-a+h,r+l,a,o):e===W.W?i.set(c-r-o+h,u-n-a+l,o,a):e===W.N?i.set(n+h,u-r-o+l,a,o):i.set(r+h,n+l,o,a)}},rs=[new et,new et,new et,new et];class j{constructor(t=0,e=0,i=0,r=0){this.type="rectangle",this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(r)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new j(0,0,0,0)}clone(){return new j(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}strokeContains(t,e,i,r=.5){const{width:n,height:o}=this;if(n<=0||o<=0)return!1;const a=this.x,h=this.y,l=i*(1-r),c=i-l,u=a-l,f=a+n+l,d=h-l,p=h+o+l,y=a+c,g=a+n-c,x=h+c,_=h+o-c;return t>=u&&t<=f&&e>=d&&e<=p&&!(t>y&&t<g&&e>x&&e<_)}intersects(t,e){if(!e){const I=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=I)return!1;const P=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>P}const i=this.left,r=this.right,n=this.top,o=this.bottom;if(r<=i||o<=n)return!1;const a=rs[0].set(t.left,t.top),h=rs[1].set(t.left,t.bottom),l=rs[2].set(t.right,t.top),c=rs[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(u===0||(e.apply(a,a),e.apply(h,h),e.apply(l,l),e.apply(c,c),Math.max(a.x,h.x,l.x,c.x)<=i||Math.min(a.x,h.x,l.x,c.x)>=r||Math.max(a.y,h.y,l.y,c.y)<=n||Math.min(a.y,h.y,l.y,c.y)>=o))return!1;const f=u*(h.y-a.y),d=u*(a.x-h.x),p=f*i+d*n,y=f*r+d*n,g=f*i+d*o,x=f*r+d*o;if(Math.max(p,y,g,x)<=f*a.x+d*a.y||Math.min(p,y,g,x)>=f*c.x+d*c.y)return!1;const _=u*(a.y-l.y),m=u*(l.x-a.x),w=_*i+m*n,v=_*r+m*n,b=_*i+m*o,A=_*r+m*o;return!(Math.max(w,v,b,A)<=_*a.x+m*a.y||Math.min(w,v,b,A)>=_*c.x+m*c.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=r,this.height=Math.max(n-r,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=r-this.y,this}scale(t,e=t){return this.x*=t,this.y*=e,this.width*=t,this.height*=e,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=r,this.height=n-r,this}getBounds(t){return t||(t=new j),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const e=t.x,i=t.y,r=t.x+t.width,n=t.y+t.height;return e>=this.x&&e<this.x+this.width&&i>=this.y&&i<this.y+this.height&&r>=this.x&&r<this.x+this.width&&n>=this.y&&n<this.y+this.height}set(t,e,i,r){return this.x=t,this.y=e,this.width=i,this.height=r,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const Vs={default:-1};function K(s="default"){return Vs[s]===void 0&&(Vs[s]=-1),++Vs[s]}const fr=new Set,D="8.0.0",nh="8.3.4",ee={quiet:!1,noColor:!1},B=(s,t,e=3)=>{if(ee.quiet||fr.has(t))return;let i=new Error().stack;const r=`${t}
Deprecated since v${s}`,n=typeof console.groupCollapsed=="function"&&!ee.noColor;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",r):(i=i.split(`
`).splice(e).join(`
`),n?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",r),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",r),console.warn(i))),fr.add(t)};Object.defineProperties(B,{quiet:{get:()=>ee.quiet,set:s=>{ee.quiet=s},enumerable:!0,configurable:!1},noColor:{get:()=>ee.noColor,set:s=>{ee.noColor=s},enumerable:!0,configurable:!1}});const Hn=()=>{};function ae(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function pr(s){return!(s&s-1)&&!!s}function Vn(s){const t={};for(const e in s)s[e]!==void 0&&(t[e]=s[e]);return t}const gr=Object.create(null);function oh(s){const t=gr[s];return t===void 0&&(gr[s]=K("resource")),t}const jn=class Yn extends _t{constructor(t={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,t={...Yn.defaultOptions,...t},this.addressMode=t.addressMode,this.addressModeU=t.addressModeU??this.addressModeU,this.addressModeV=t.addressModeV??this.addressModeV,this.addressModeW=t.addressModeW??this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=t.magFilter??this.magFilter,this.minFilter=t.minFilter??this.minFilter,this.mipmapFilter=t.mipmapFilter??this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=t.maxAnisotropy??1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){B(D,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=oh(t),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};jn.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let he=jn;const Xn=class qn extends _t{constructor(t={}){super(),this.options=t,this.uid=K("textureSource"),this._resourceType="textureSource",this._resourceId=K("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,t={...qn.defaultOptions,...t},this.label=t.label??"",this.resource=t.resource,this.autoGarbageCollect=t.autoGarbageCollect,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode,this.style=new he(Vn(t)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(t){this.style!==t&&(this._style?.off("change",this._onStyleChange,this),this._style=t,this._style?.on("change",this._onStyleChange,this),this._onStyleChange())}set maxAnisotropy(t){this._style.maxAnisotropy=t}get maxAnisotropy(){return this._style.maxAnisotropy}get addressMode(){return this._style.addressMode}set addressMode(t){this._style.addressMode=t}get repeatMode(){return this._style.addressMode}set repeatMode(t){this._style.addressMode=t}get magFilter(){return this._style.magFilter}set magFilter(t){this._style.magFilter=t}get minFilter(){return this._style.minFilter}set minFilter(t){this._style.minFilter=t}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(t){this._style.mipmapFilter=t}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(t){this._style.lodMinClamp=t}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(t){this._style.lodMaxClamp=t}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const t=this._resolution;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=K("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,i){i||(i=this._resolution),t||(t=this.width),e||(e=this.height);const r=Math.round(t*i),n=Math.round(e*i);return this.width=r/i,this.height=n/i,this._resolution=i,this.pixelWidth===r&&this.pixelHeight===n?!1:(this._refreshPOT(),this.pixelWidth=r,this.pixelHeight=n,this.emit("resize",this),this._resourceId=K("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this._style.wrapMode=t}get wrapMode(){return this._style.wrapMode}set scaleMode(t){this._style.scaleMode=t}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=pr(this.pixelWidth)&&pr(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};Xn.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let wt=Xn;class Ni extends wt{constructor(t){const e=t.resource||new Float32Array(t.width*t.height*4);let i=t.format;i||(e instanceof Float32Array?i="rgba32float":e instanceof Int32Array||e instanceof Uint32Array?i="rgba32uint":e instanceof Int16Array||e instanceof Uint16Array?i="rgba16uint":(e instanceof Int8Array,i="bgra8unorm")),super({...t,resource:e,format:i}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}Ni.extension=R.TextureSource;const mr=new F;class ah{constructor(t,e){this.mapCoord=new F,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof e>"u"?this.clampMargin=t.width<10?0:.5:this.clampMargin=e,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){this.texture!==t&&(this._texture?.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let r=0;r<t.length;r+=2){const n=t[r],o=t[r+1];e[r]=n*i.a+o*i.c+i.tx,e[r+1]=n*i.b+o*i.d+i.ty}return e}update(){const t=this._texture;this._updateID++;const e=t.uvs;this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0);const i=t.orig,r=t.trim;r&&(mr.set(i.width/r.width,0,0,i.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(mr));const n=t.source,o=this.uClampFrame,a=this.clampMargin/n._resolution,h=this.clampOffset/n._resolution;return o[0]=(t.frame.x+a+h)/n.width,o[1]=(t.frame.y+a+h)/n.height,o[2]=(t.frame.x+t.frame.width-a+h)/n.width,o[3]=(t.frame.y+t.frame.height-a+h)/n.height,this.uClampOffset[0]=this.clampOffset/n.pixelWidth,this.uClampOffset[1]=this.clampOffset/n.pixelHeight,this.isSimple=t.frame.width===n.width&&t.frame.height===n.height&&t.rotate===0,!0}}class G extends _t{constructor({source:t,label:e,frame:i,orig:r,trim:n,defaultAnchor:o,defaultBorders:a,rotate:h,dynamic:l}={}){if(super(),this.uid=K("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new j,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=e,this.source=t?.source??new wt,this.noFrame=!i,i)this.frame.copyFrom(i);else{const{width:c,height:u}=this._source;this.frame.width=c,this.frame.height=u}this.orig=r||this.frame,this.trim=n,this.rotate=h??0,this.defaultAnchor=o,this.defaultBorders=a,this.destroyed=!1,this.dynamic=l||!1,this.updateUvs()}set source(t){this._source&&this._source.off("resize",this.update,this),this._source=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new ah(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:e}=this,{width:i,height:r}=this._source,n=e.x/i,o=e.y/r,a=e.width/i,h=e.height/r;let l=this.rotate;if(l){const c=a/2,u=h/2,f=n+c,d=o+u;l=W.add(l,W.NW),t.x0=f+c*W.uX(l),t.y0=d+u*W.uY(l),l=W.add(l,2),t.x1=f+c*W.uX(l),t.y1=d+u*W.uY(l),l=W.add(l,2),t.x2=f+c*W.uX(l),t.y2=d+u*W.uY(l),l=W.add(l,2),t.x3=f+c*W.uX(l),t.y3=d+u*W.uY(l)}else t.x0=n,t.y0=o,t.x1=n+a,t.y1=o,t.x2=n+a,t.y2=o+h,t.x3=n,t.y3=o+h}destroy(t=!1){this._source&&(this._source.off("resize",this.update,this),t&&(this._source.destroy(),this._source=null)),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return B(D,"Texture.baseTexture is now Texture.source"),this._source}}G.EMPTY=new G({label:"EMPTY",source:new wt({label:"EMPTY"})});G.EMPTY.destroy=Hn;G.WHITE=new G({source:new Ni({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});G.WHITE.destroy=Hn;function hh(s,t,e){const{width:i,height:r}=e.orig,n=e.trim;if(n){const o=n.width,a=n.height;s.minX=n.x-t._x*i,s.maxX=s.minX+o,s.minY=n.y-t._y*r,s.maxY=s.minY+a}else s.minX=-t._x*i,s.maxX=s.minX+i,s.minY=-t._y*r,s.maxY=s.minY+r}const yr=new F;class xt{constructor(t=1/0,e=1/0,i=-1/0,r=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=yr,this.minX=t,this.minY=e,this.maxX=i,this.maxY=r}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new j);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=yr,this}set(t,e,i,r){this.minX=t,this.minY=e,this.maxX=i,this.maxY=r}addFrame(t,e,i,r,n){n||(n=this.matrix);const o=n.a,a=n.b,h=n.c,l=n.d,c=n.tx,u=n.ty;let f=this.minX,d=this.minY,p=this.maxX,y=this.maxY,g=o*t+h*e+c,x=a*t+l*e+u;g<f&&(f=g),x<d&&(d=x),g>p&&(p=g),x>y&&(y=x),g=o*i+h*e+c,x=a*i+l*e+u,g<f&&(f=g),x<d&&(d=x),g>p&&(p=g),x>y&&(y=x),g=o*t+h*r+c,x=a*t+l*r+u,g<f&&(f=g),x<d&&(d=x),g>p&&(p=g),x>y&&(y=x),g=o*i+h*r+c,x=a*i+l*r+u,g<f&&(f=g),x<d&&(d=x),g>p&&(p=g),x>y&&(y=x),this.minX=f,this.minY=d,this.maxX=p,this.maxY=y}addRect(t,e){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,e)}addBounds(t,e){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,e)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,i=this.minY,r=this.maxX,n=this.maxY,{a:o,b:a,c:h,d:l,tx:c,ty:u}=t;let f=o*e+h*i+c,d=a*e+l*i+u;this.minX=f,this.minY=d,this.maxX=f,this.maxY=d,f=o*r+h*i+c,d=a*r+l*i+u,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY,f=o*e+h*n+c,d=a*e+l*n+u,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY,f=o*r+h*n+c,d=a*r+l*n+u,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,e,i,r){return this.minX<t&&(this.minX=t),this.maxX>e&&(this.maxX=e),this.minY<i&&(this.minY=i),this.maxY>r&&(this.maxY=r),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new xt(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}set x(t){const e=this.maxX-this.minX;this.minX=t,this.maxX=t+e}get y(){return this.minY}set y(t){const e=this.maxY-this.minY;this.minY=t,this.maxY=t+e}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,i,r){let n=this.minX,o=this.minY,a=this.maxX,h=this.maxY;r||(r=this.matrix);const l=r.a,c=r.b,u=r.c,f=r.d,d=r.tx,p=r.ty;for(let y=e;y<i;y+=2){const g=t[y],x=t[y+1],_=l*g+u*x+d,m=c*g+f*x+p;n=_<n?_:n,o=m<o?m:o,a=_>a?_:a,h=m>h?m:h}this.minX=n,this.minY=o,this.maxX=a,this.maxY=h}containsPoint(t,e){return this.minX<=t&&this.minY<=e&&this.maxX>=t&&this.maxY>=e}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}var lh={grad:.9,turn:360,rad:360/(2*Math.PI)},Pt=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},Q=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*s)/e+0},ut=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),s>e?e:s>t?s:t},Kn=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},xr=function(s){return{r:ut(s.r,0,255),g:ut(s.g,0,255),b:ut(s.b,0,255),a:ut(s.a)}},js=function(s){return{r:Q(s.r),g:Q(s.g),b:Q(s.b),a:Q(s.a,3)}},ch=/^#([0-9a-f]{3,8})$/i,ns=function(s){var t=s.toString(16);return t.length<2?"0"+t:t},Zn=function(s){var t=s.r,e=s.g,i=s.b,r=s.a,n=Math.max(t,e,i),o=n-Math.min(t,e,i),a=o?n===t?(e-i)/o:n===e?2+(i-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:r}},Qn=function(s){var t=s.h,e=s.s,i=s.v,r=s.a;t=t/360*6,e/=100,i/=100;var n=Math.floor(t),o=i*(1-e),a=i*(1-(t-n)*e),h=i*(1-(1-t+n)*e),l=n%6;return{r:255*[i,a,o,o,h,i][l],g:255*[h,i,i,a,o,o][l],b:255*[o,o,h,i,i,a][l],a:r}},_r=function(s){return{h:Kn(s.h),s:ut(s.s,0,100),l:ut(s.l,0,100),a:ut(s.a)}},wr=function(s){return{h:Q(s.h),s:Q(s.s),l:Q(s.l),a:Q(s.a,3)}},br=function(s){return Qn((e=(t=s).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},Le=function(s){return{h:(t=Zn(s)).h,s:(r=(200-(e=t.s))*(i=t.v)/100)>0&&r<200?e*i/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,e,i,r},uh=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,dh=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,fh=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ph=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,bi={string:[[function(s){var t=ch.exec(s);return t?(s=t[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?Q(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?Q(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var t=fh.exec(s)||ph.exec(s);return t?t[2]!==t[4]||t[4]!==t[6]?null:xr({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(s){var t=uh.exec(s)||dh.exec(s);if(!t)return null;var e,i,r=_r({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*(lh[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return br(r)},"hsl"]],object:[[function(s){var t=s.r,e=s.g,i=s.b,r=s.a,n=r===void 0?1:r;return Pt(t)&&Pt(e)&&Pt(i)?xr({r:Number(t),g:Number(e),b:Number(i),a:Number(n)}):null},"rgb"],[function(s){var t=s.h,e=s.s,i=s.l,r=s.a,n=r===void 0?1:r;if(!Pt(t)||!Pt(e)||!Pt(i))return null;var o=_r({h:Number(t),s:Number(e),l:Number(i),a:Number(n)});return br(o)},"hsl"],[function(s){var t=s.h,e=s.s,i=s.v,r=s.a,n=r===void 0?1:r;if(!Pt(t)||!Pt(e)||!Pt(i))return null;var o=(function(a){return{h:Kn(a.h),s:ut(a.s,0,100),v:ut(a.v,0,100),a:ut(a.a)}})({h:Number(t),s:Number(e),v:Number(i),a:Number(n)});return Qn(o)},"hsv"]]},Ar=function(s,t){for(var e=0;e<t.length;e++){var i=t[e][0](s);if(i)return[i,t[e][1]]}return[null,void 0]},gh=function(s){return typeof s=="string"?Ar(s.trim(),bi.string):typeof s=="object"&&s!==null?Ar(s,bi.object):[null,void 0]},Ys=function(s,t){var e=Le(s);return{h:e.h,s:ut(e.s+100*t,0,100),l:e.l,a:e.a}},Xs=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},vr=function(s,t){var e=Le(s);return{h:e.h,s:e.s,l:ut(e.l+100*t,0,100),a:e.a}},Ai=(function(){function s(t){this.parsed=gh(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return Q(Xs(this.rgba),2)},s.prototype.isDark=function(){return Xs(this.rgba)<.5},s.prototype.isLight=function(){return Xs(this.rgba)>=.5},s.prototype.toHex=function(){return t=js(this.rgba),e=t.r,i=t.g,r=t.b,o=(n=t.a)<1?ns(Q(255*n)):"","#"+ns(e)+ns(i)+ns(r)+o;var t,e,i,r,n,o},s.prototype.toRgb=function(){return js(this.rgba)},s.prototype.toRgbString=function(){return t=js(this.rgba),e=t.r,i=t.g,r=t.b,(n=t.a)<1?"rgba("+e+", "+i+", "+r+", "+n+")":"rgb("+e+", "+i+", "+r+")";var t,e,i,r,n},s.prototype.toHsl=function(){return wr(Le(this.rgba))},s.prototype.toHslString=function(){return t=wr(Le(this.rgba)),e=t.h,i=t.s,r=t.l,(n=t.a)<1?"hsla("+e+", "+i+"%, "+r+"%, "+n+")":"hsl("+e+", "+i+"%, "+r+"%)";var t,e,i,r,n},s.prototype.toHsv=function(){return t=Zn(this.rgba),{h:Q(t.h),s:Q(t.s),v:Q(t.v),a:Q(t.a,3)};var t},s.prototype.invert=function(){return At({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},s.prototype.saturate=function(t){return t===void 0&&(t=.1),At(Ys(this.rgba,t))},s.prototype.desaturate=function(t){return t===void 0&&(t=.1),At(Ys(this.rgba,-t))},s.prototype.grayscale=function(){return At(Ys(this.rgba,-1))},s.prototype.lighten=function(t){return t===void 0&&(t=.1),At(vr(this.rgba,t))},s.prototype.darken=function(t){return t===void 0&&(t=.1),At(vr(this.rgba,-t))},s.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},s.prototype.alpha=function(t){return typeof t=="number"?At({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Q(this.rgba.a,3);var e},s.prototype.hue=function(t){var e=Le(this.rgba);return typeof t=="number"?At({h:t,s:e.s,l:e.l,a:e.a}):Q(e.h)},s.prototype.isEqual=function(t){return this.toHex()===At(t).toHex()},s})(),At=function(s){return s instanceof Ai?s:new Ai(s)},Sr=[],mh=function(s){s.forEach(function(t){Sr.indexOf(t)<0&&(t(Ai,bi),Sr.push(t))})};function yh(s,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var r in e)i[e[r]]=r;var n={};s.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=i[this.toHex()];if(l)return l;if(o?.closest){var c=this.toRgb(),u=1/0,f="black";if(!n.length)for(var d in e)n[d]=new s(e[d]).toRgb();for(var p in e){var y=(a=c,h=n[p],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));y<u&&(u=y,f=p)}return f}},t.string.push([function(o){var a=o.toLowerCase(),h=a==="transparent"?"#0000":e[a];return h?new s(h).toRgb():null},"name"])}mh([yh]);const le=class ke{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof ke)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,t))&&(this._value=this._cloneSource(t),this._normalize(this._value))}}get value(){return this._value}_cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}_isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((n,o)=>n===e[o]);if(t!==null&&e!==null){const n=Object.keys(t),o=Object.keys(e);return n.length!==o.length?!1:n.every(a=>t[a]===e[a])}return t===e}toRgba(){const[t,e,i,r]=this._components;return{r:t,g:e,b:i,a:r}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,r]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb),t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(r*255),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t||(t=this._arrayRgba);const[e,i,r,n]=this._components;return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb);const[e,i,r]=this._components;return t[0]=e,t[1]=i,t[2]=r,t}toNumber(){return this._int}toBgrNumber(){const[t,e,i]=this.toUint8RgbArray();return(i<<16)+(e<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,i,r,n]=ke._temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=r,this._components[3]*=n,this._refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,r=this._int>>8&255,n=this._int&255;return e&&(i=i*t+.5|0,r=r*t+.5|0,n=n*t+.5|0),(t*255<<24)+(i<<16)+(r<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(t){let e,i,r,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,i=(o>>8&255)/255,r=(o&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,r,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,r,n=255]=t,e/=255,i/=255,r/=255,n/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=ke.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=At(t);o.isValid()&&({r:e,g:i,b:r,a:n}=o.rgba,e/=255,i/=255,r/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=r,this._components[3]=n,this._refreshInt();else throw new Error(`Unable to convert color ${t}`)}_refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((r,n)=>{t[n]=Math.min(Math.max(r,e),i)}),t)}static isColorLike(t){return typeof t=="number"||typeof t=="string"||t instanceof Number||t instanceof ke||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t.r!==void 0&&t.g!==void 0&&t.b!==void 0||t.r!==void 0&&t.g!==void 0&&t.b!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0&&t.a!==void 0}};le.shared=new le;le._temp=new le;le.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Y=le;const xh={cullArea:null,cullable:!1,cullableChildren:!0};let qs=0;const Cr=500;function U(...s){qs!==Cr&&(qs++,qs===Cr?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...s))}const Qe={_registeredResources:new Set,register(s){this._registeredResources.add(s)},unregister(s){this._registeredResources.delete(s)},release(){this._registeredResources.forEach(s=>s.clear())},get registeredCount(){return this._registeredResources.size},isRegistered(s){return this._registeredResources.has(s)},reset(){this._registeredResources.clear()}};class _h{constructor(t,e){this._pool=[],this._count=0,this._index=0,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){let e;return this._index>0?e=this._pool[--this._index]:(e=new this._classType,this._count++),e.init?.(t),e}return(t){t.reset?.(),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){if(this._pool.length>0&&this._pool[0].destroy)for(let t=0;t<this._index;t++)this._pool[t].destroy();this._pool.length=0,this._count=0,this._index=0}}class wh{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){return this.getPool(t).get(e)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new _h(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(e=>{const i=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[i]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}}),t}clear(){this._poolsByClass.forEach(t=>t.clear()),this._poolsByClass.clear()}}const pt=new wh;Qe.register(pt);const bh={get isCachedAsTexture(){return!!this.renderGroup?.isCachedAsTexture},cacheAsTexture(s){typeof s=="boolean"&&s===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(s===!0?{}:s))},updateCacheTexture(){this.renderGroup?.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(s){B("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(s)}};function Ah(s,t,e){const i=s.length;let r;if(t>=i||e===0)return;e=t+e>i?i-t:e;const n=i-e;for(r=t;r<n;++r)s[r]=s[r+e];s.length=n}const vh={allowChildren:!0,removeChildren(s=0,t){const e=t??this.children.length,i=e-s,r=[];if(i>0&&i<=e){for(let o=e-1;o>=s;o--){const a=this.children[o];a&&(r.push(a),a.parent=null)}Ah(this.children,s,e);const n=this.renderGroup||this.parentRenderGroup;n&&n.removeChildren(r);for(let o=0;o<r.length;++o){const a=r[o];a.parentRenderLayer?.detach(a),this.emit("childRemoved",a,this,o),r[o].emit("removed",this)}return r.length>0&&this._didViewChangeTick++,r}else if(i===0&&this.children.length===0)return r;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(s){const t=this.getChildAt(s);return this.removeChild(t)},getChildAt(s){if(s<0||s>=this.children.length)throw new Error(`getChildAt: Index (${s}) does not exist.`);return this.children[s]},setChildIndex(s,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(s),this.addChildAt(s,t)},getChildIndex(s){const t=this.children.indexOf(s);if(t===-1)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(s,t){this.allowChildren||B(D,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:e}=this;if(t<0||t>e.length)throw new Error(`${s}addChildAt: The index ${t} supplied is out of bounds ${e.length}`);if(s.parent){const r=s.parent.children.indexOf(s);if(s.parent===this&&r===t)return s;r!==-1&&s.parent.children.splice(r,1)}t===e.length?e.push(s):e.splice(t,0,s),s.parent=this,s.didChange=!0,s._updateFlags=15;const i=this.renderGroup||this.parentRenderGroup;return i&&i.addChild(s),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",s,this,t),s.emit("added",this),s},swapChildren(s,t){if(s===t)return;const e=this.getChildIndex(s),i=this.getChildIndex(t);this.children[e]=t,this.children[i]=s;const r=this.renderGroup||this.parentRenderGroup;r&&(r.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){this.parent?.removeChild(this)},reparentChild(...s){return s.length===1?this.reparentChildAt(s[0],this.children.length):(s.forEach(t=>this.reparentChildAt(t,this.children.length)),s[0])},reparentChildAt(s,t){if(s.parent===this)return this.setChildIndex(s,t),s;const e=s.worldTransform.clone();s.removeFromParent(),this.addChildAt(s,t);const i=this.worldTransform.clone();return i.invert(),e.prepend(i),s.setFromMatrix(e),s},replaceChild(s,t){s.updateLocalTransform(),this.addChildAt(t,this.getChildIndex(s)),t.setFromMatrix(s.localTransform),t.updateLocalTransform(),this.removeChild(s)}},Sh={collectRenderables(s,t,e){this.parentRenderLayer&&this.parentRenderLayer!==e||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(s,t,e):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,s):this.collectRenderablesWithEffects(s,t,e))},collectRenderablesSimple(s,t,e){const i=this.children,r=i.length;for(let n=0;n<r;n++)i[n].collectRenderables(s,t,e)},collectRenderablesWithEffects(s,t,e){const{renderPipes:i}=t;for(let r=0;r<this.effects.length;r++){const n=this.effects[r];i[n.pipe].push(n,this,s)}this.collectRenderablesSimple(s,t,e);for(let r=this.effects.length-1;r>=0;r--){const n=this.effects[r];i[n.pipe].pop(n,this,s)}}};class Pr{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}class Ch{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this._tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let e=0;e<this._tests.length;e++){const i=this._tests[e];if(i.test(t))return pt.get(i.maskClass,t)}return t}returnMaskEffect(t){pt.return(t)}}const vi=new Ch;tt.handleByList(R.MaskEffect,vi._effectClasses);const Ph={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)},addEffect(s){this.effects.indexOf(s)===-1&&(this.effects.push(s),this.effects.sort((e,i)=>e.priority-i.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(s){const t=this.effects.indexOf(s);t!==-1&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(s){const t=this._maskEffect;t?.mask!==s&&(t&&(this.removeEffect(t),vi.returnMaskEffect(t),this._maskEffect=null),s!=null&&(this._maskEffect=vi.getMaskEffect(s),this.addEffect(this._maskEffect)))},get mask(){return this._maskEffect?.mask},setMask(s){this._maskOptions={...this._maskOptions,...s},s.mask&&(this.mask=s.mask),this._markStructureAsChanged()},set filters(s){!Array.isArray(s)&&s&&(s=[s]);const t=this._filterEffect||(this._filterEffect=new Pr);s=s;const e=s?.length>0,i=t.filters?.length>0,r=e!==i;s=Array.isArray(s)?s.slice(0):s,t.filters=Object.freeze(s),r&&(e?this.addEffect(t):(this.removeEffect(t),t.filters=s??null))},get filters(){return this._filterEffect?.filters},set filterArea(s){this._filterEffect||(this._filterEffect=new Pr),this._filterEffect.filterArea=s},get filterArea(){return this._filterEffect?.filterArea}},Th={label:null,get name(){return B(D,"Container.name property has been removed, use Container.label instead"),this.label},set name(s){B(D,"Container.name property has been removed, use Container.label instead"),this.label=s},getChildByName(s,t=!1){return this.getChildByLabel(s,t)},getChildByLabel(s,t=!1){const e=this.children;for(let i=0;i<e.length;i++){const r=e[i];if(r.label===s||s instanceof RegExp&&s.test(r.label))return r}if(t)for(let i=0;i<e.length;i++){const n=e[i].getChildByLabel(s,!0);if(n)return n}return null},getChildrenByLabel(s,t=!1,e=[]){const i=this.children;for(let r=0;r<i.length;r++){const n=i[r];(n.label===s||s instanceof RegExp&&s.test(n.label))&&e.push(n)}if(t)for(let r=0;r<i.length;r++)i[r].getChildrenByLabel(s,!0,e);return e}},it=pt.getPool(F),Et=pt.getPool(xt),kh=new F,Mh={getFastGlobalBounds(s,t){t||(t=new xt),t.clear(),this._getGlobalBoundsRecursive(!!s,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const e=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(e.worldTransform),t},_getGlobalBoundsRecursive(s,t,e){let i=t;if(s&&this.parentRenderLayer&&this.parentRenderLayer!==e||this.localDisplayStatus!==7||!this.measurable)return;const r=!!this.effects.length;if((this.renderGroup||r)&&(i=Et.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const o=this.bounds;i.addFrame(o.minX,o.minY,o.maxX,o.maxY,this.groupTransform)}const n=this.children;for(let o=0;o<n.length;o++)n[o]._getGlobalBoundsRecursive(s,i,e)}if(r){let n=!1;const o=this.renderGroup||this.parentRenderGroup;for(let a=0;a<this.effects.length;a++)this.effects[a].addBounds&&(n||(n=!0,i.applyMatrix(o.worldTransform)),this.effects[a].addBounds(i,!0));n&&i.applyMatrix(o.worldTransform.copyTo(kh).invert()),t.addBounds(i),Et.return(i)}else this.renderGroup&&(t.addBounds(i,this.relativeGroupTransform),Et.return(i))}};function Jn(s,t,e){e.clear();let i,r;return s.parent?t?i=s.parent.worldTransform:(r=it.get().identity(),i=$i(s,r)):i=F.IDENTITY,to(s,e,i,t),r&&it.return(r),e.isValid||e.set(0,0,0,0),e}function to(s,t,e,i){if(!s.visible||!s.measurable)return;let r;i?r=s.worldTransform:(s.updateLocalTransform(),r=it.get(),r.appendFrom(s.localTransform,e));const n=t,o=!!s.effects.length;if(o&&(t=Et.get().clear()),s.boundsArea)t.addRect(s.boundsArea,r);else{const a=s.bounds;a&&!a.isEmpty()&&(t.matrix=r,t.addBounds(a));for(let h=0;h<s.children.length;h++)to(s.children[h],t,r,i)}if(o){for(let a=0;a<s.effects.length;a++)s.effects[a].addBounds?.(t);n.addBounds(t,F.IDENTITY),Et.return(t)}i||it.return(r)}function $i(s,t){const e=s.parent;return e&&($i(e,t),e.updateLocalTransform(),t.append(e.localTransform)),t}function eo(s,t){if(s===16777215||!t)return t;if(t===16777215||!s)return s;const e=s>>16&255,i=s>>8&255,r=s&255,n=t>>16&255,o=t>>8&255,a=t&255,h=e*n/255|0,l=i*o/255|0,c=r*a/255|0;return(h<<16)+(l<<8)+c}const Tr=16777215;function kr(s,t){return s===Tr?t:t===Tr?s:eo(s,t)}function xs(s){return((s&255)<<16)+(s&65280)+(s>>16&255)}const Eh={getGlobalAlpha(s){if(s)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,e=this.parent;for(;e;)t*=e.alpha,e=e.parent;return t},getGlobalTransform(s=new F,t){if(t)return s.copyFrom(this.worldTransform);this.updateLocalTransform();const e=$i(this,it.get().identity());return s.appendFrom(this.localTransform,e),it.return(e),s},getGlobalTint(s){if(s)return this.renderGroup?xs(this.renderGroup.worldColor):this.parentRenderGroup?xs(kr(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,e=this.parent;for(;e;)t=kr(t,e.localColor),e=e.parent;return xs(t)}};function so(s,t,e){return t.clear(),e||(e=F.IDENTITY),io(s,t,e,s,!0),t.isValid||t.set(0,0,0,0),t}function io(s,t,e,i,r){let n;if(r)n=it.get(),n=e.copyTo(n);else{if(!s.visible||!s.measurable)return;s.updateLocalTransform();const h=s.localTransform;n=it.get(),n.appendFrom(h,e)}const o=t,a=!!s.effects.length;if(a&&(t=Et.get().clear()),s.boundsArea)t.addRect(s.boundsArea,n);else{s.renderPipeId&&(t.matrix=n,t.addBounds(s.bounds));const h=s.children;for(let l=0;l<h.length;l++)io(h[l],t,n,i,!1)}if(a){for(let h=0;h<s.effects.length;h++)s.effects[h].addLocalBounds?.(t,i);o.addBounds(t,F.IDENTITY),Et.return(t)}it.return(n)}function ro(s,t){const e=s.children;for(let i=0;i<e.length;i++){const r=e[i],n=r.uid,o=(r._didViewChangeTick&65535)<<16|r._didContainerChangeTick&65535,a=t.index;(t.data[a]!==n||t.data[a+1]!==o)&&(t.data[t.index]=n,t.data[t.index+1]=o,t.didChange=!0),t.index=a+2,r.children.length&&ro(r,t)}return t.didChange}const Ih=new F,Rh={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(s,t){const e=Math.sign(this.scale.x)||1;t!==0?this.scale.x=s/t*e:this.scale.x=e},_setHeight(s,t){const e=Math.sign(this.scale.y)||1;t!==0?this.scale.y=s/t*e:this.scale.y=e},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new xt});const s=this._localBoundsCacheData;return s.index=1,s.didChange=!1,s.data[0]!==this._didViewChangeTick&&(s.didChange=!0,s.data[0]=this._didViewChangeTick),ro(this,s),s.didChange&&so(this,s.localBounds,Ih),s.localBounds},getBounds(s,t){return Jn(this,s,t||new xt)}},Bh={_onRender:null,set onRender(s){const t=this.renderGroup||this.parentRenderGroup;if(!s){this._onRender&&t?.removeOnRender(this),this._onRender=null;return}this._onRender||t?.addOnRender(this),this._onRender=s},get onRender(){return this._onRender}},Fh={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(s){this._zIndex!==s&&(this._zIndex=s,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(Lh))}};function Lh(s,t){return s._zIndex-t._zIndex}const Gh={getGlobalPosition(s=new et,t=!1){return this.parent?this.parent.toGlobal(this._position,s,t):(s.x=this._position.x,s.y=this._position.y),s},toGlobal(s,t,e=!1){const i=this.getGlobalTransform(it.get(),e);return t=i.apply(s,t),it.return(i),t},toLocal(s,t,e,i){t&&(s=t.toGlobal(s,e,i));const r=this.getGlobalTransform(it.get(),i);return e=r.applyInverse(s,e),it.return(r),e}};class no{constructor(){this.uid=K("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}destroy(){this.instructions.length=0,this.renderables.length=0,this.renderPipes=null,this.gcTick=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let Oh=0;class Dh{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this.textureStyle=new he(this.textureOptions)}createTexture(t,e,i){const r=new wt({...this.textureOptions,width:t,height:e,resolution:1,antialias:i,autoGarbageCollect:!1});return new G({source:r,label:`texturePool_${Oh++}`})}getOptimalTexture(t,e,i=1,r){let n=Math.ceil(t*i-1e-6),o=Math.ceil(e*i-1e-6);n=ae(n),o=ae(o);const a=(n<<17)+(o<<1)+(r?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let h=this._texturePool[a].pop();return h||(h=this.createTexture(n,o,r)),h.source._resolution=i,h.source.width=n/i,h.source.height=o/i,h.source.pixelWidth=n,h.source.pixelHeight=o,h.frame.x=0,h.frame.y=0,h.frame.width=t,h.frame.height=e,h.updateUvs(),this._poolKeyHash[h.uid]=a,h}getSameSizeTexture(t,e=!1){const i=t.source;return this.getOptimalTexture(t.width,t.height,i._resolution,e)}returnTexture(t,e=!1){const i=this._poolKeyHash[t.uid];e&&(t.source.style=this.textureStyle),this._texturePool[i].push(t)}clear(t){if(t=t!==!1,t)for(const e in this._texturePool){const i=this._texturePool[e];if(i)for(let r=0;r<i.length;r++)i[r].destroy(!0)}this._texturePool={}}}const oo=new Dh;Qe.register(oo);class zh{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new F,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new no,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const e=t.children;for(let i=0;i<e.length;i++){const r=e[i];r._updateFlags=15,this.addChild(r)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(oo.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0;const t=this._parentCacheAsTextureRenderGroup;t&&!t.textureNeedsUpdate&&t.updateCacheTexture()}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const e=this.childrenToUpdate[t];e.list.fill(null),e.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const e=this.renderGroupChildren.indexOf(t);e>-1&&this.renderGroupChildren.splice(e,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup){this.addRenderGroupChild(t.renderGroup);return}t._onRender&&this.addOnRender(t);const e=t.children;for(let i=0;i<e.length;i++)this.addChild(e[i])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup){this._removeRenderGroupChild(t.renderGroup);return}const e=t.children;for(let i=0;i<e.length;i++)this.removeChild(e[i])}removeChildren(t){for(let e=0;e<t.length;e++)this.removeChild(t[e])}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeRenderGroupDepth];e||(e=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const e=this.root.children;for(let i=0;i<e.length;i++)this._getChildren(e[i],t);return t}_getChildren(t,e=[]){if(e.push(t),t.renderGroup)return e;const i=t.children;for(let r=0;r<i.length;r++)this._getChildren(i[r],e);return e}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return(this._matrixDirty&1)===0?this._inverseWorldTransform:(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new F),this._inverseWorldTransform.copyFrom(this.worldTransform).invert())}get textureOffsetInverseTransform(){return(this._matrixDirty&2)===0?this._textureOffsetInverseTransform:(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new F),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y))}get inverseParentTextureTransform(){if((this._matrixDirty&4)===0)return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new F),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this.isCachedAsTexture?this.textureOffsetInverseTransform:this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function Wh(s,t,e={}){for(const i in t)!e[i]&&t[i]!==void 0&&(s[i]=t[i])}const Ks=new J(null),os=new J(null),Zs=new J(null,1,1),as=new J(null),Mr=1,Nh=2,Qs=4;class dt extends _t{constructor(t={}){super(),this.uid=K("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.parentRenderLayer=null,this.updateTick=-1,this.localTransform=new F,this.relativeGroupTransform=new F,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new J(this,0,0),this._scale=Zs,this._pivot=os,this._origin=as,this._skew=Ks,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],Wh(this,t,{children:!0,parent:!0,effects:!0}),t.children?.forEach(e=>this.addChild(e)),t.parent?.addChild(this)}static mixin(t){B("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),tt.mixin(dt,t)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=t&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...t){if(this.allowChildren||B(D,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let r=0;r<t.length;r++)this.addChild(t[r]);return t[0]}const e=t[0],i=this.renderGroup||this.parentRenderGroup;return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),i&&(i.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),this.sortableChildren&&(this.sortDirty=!0),e.parent=this,e.didChange=!0,e._updateFlags=15,i&&i.addChild(e),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this),this._didViewChangeTick++,e._zIndex!==0&&e.depthOfChildModified(),e)}removeChild(...t){if(t.length>1){for(let r=0;r<t.length;r++)this.removeChild(t[r]);return t[0]}const e=t[0],i=this.children.indexOf(e);return i>-1&&(this._didViewChangeTick++,this.children.splice(i,1),this.renderGroup?this.renderGroup.removeChild(e):this.parentRenderGroup&&this.parentRenderGroup.removeChild(e),e.parentRenderLayer&&e.parentRenderLayer.detach(e),e.parent=null,this.emit("childRemoved",e,this,i),e.emit("removed",this)),e}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;t?.removeChild(this),this.renderGroup=pt.get(zh,this),this.groupTransform=F.IDENTITY,t?.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;t?.removeChild(this),pt.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,t?.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new F),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*th}set angle(t){this.rotation=t*eh}get pivot(){return this._pivot===os&&(this._pivot=new J(this,0,0)),this._pivot}set pivot(t){this._pivot===os&&(this._pivot=new J(this,0,0),this._origin!==as&&U("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===Ks&&(this._skew=new J(this,0,0)),this._skew}set skew(t){this._skew===Ks&&(this._skew=new J(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===Zs&&(this._scale=new J(this,1,1)),this._scale}set scale(t){this._scale===Zs&&(this._scale=new J(this,0,0)),typeof t=="string"&&(t=parseFloat(t)),typeof t=="number"?this._scale.set(t):this._scale.copyFrom(t)}get origin(){return this._origin===as&&(this._origin=new J(this,0,0)),this._origin}set origin(t){this._origin===as&&(this._origin=new J(this,0,0),this._pivot!==os&&U("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._origin.set(t):this._origin.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const e=this.getLocalBounds().width;this._setWidth(t,e)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const e=this.getLocalBounds().height;this._setHeight(t,e)}getSize(t){t||(t={});const e=this.getLocalBounds();return t.width=Math.abs(this.scale.x*e.width),t.height=Math.abs(this.scale.y*e.height),t}setSize(t,e){const i=this.getLocalBounds();typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,i.width),e!==void 0&&this._setHeight(e,i.height)}_updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}updateTransform(t){return this.position.set(typeof t.x=="number"?t.x:this.position.x,typeof t.y=="number"?t.y:this.position.y),this.scale.set(typeof t.scaleX=="number"?t.scaleX||1:this.scale.x,typeof t.scaleY=="number"?t.scaleY||1:this.scale.y),this.rotation=typeof t.rotation=="number"?t.rotation:this.rotation,this.skew.set(typeof t.skewX=="number"?t.skewX:this.skew.x,typeof t.skewY=="number"?t.skewY:this.skew.y),this.pivot.set(typeof t.pivotX=="number"?t.pivotX:this.pivot.x,typeof t.pivotY=="number"?t.pivotY:this.pivot.y),this.origin.set(typeof t.originX=="number"?t.originX:this.origin.x,typeof t.originY=="number"?t.originY:this.origin.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const e=this.localTransform,i=this._scale,r=this._pivot,n=this._origin,o=this._position,a=i._x,h=i._y,l=r._x,c=r._y,u=-n._x,f=-n._y;e.a=this._cx*a,e.b=this._sx*a,e.c=this._cy*h,e.d=this._sy*h,e.tx=o._x-(l*e.a+c*e.c)+(u*e.a+f*e.c)-u,e.ty=o._y-(l*e.b+c*e.d)+(u*e.b+f*e.d)-f}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=Mr,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const i=Y.shared.setValue(t??16777215).toBgrNumber();i!==this.localColor&&(this.localColor=i,this._updateFlags|=Mr,this._onUpdate())}get tint(){return xs(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Nh,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(t){const e=t?2:0;(this.localDisplayStatus&2)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Qs,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(t){const e=t?0:4;(this.localDisplayStatus&4)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Qs,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(t){const e=t?1:0;(this.localDisplayStatus&1)!==e&&(this._updateFlags|=Qs,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(t=!1){if(this.destroyed)return;this.destroyed=!0;let e;if(this.children.length&&(e=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof t=="boolean"?t:t?.children)&&e)for(let r=0;r<e.length;++r)e[r].destroy(t);this.renderGroup?.destroy(),this.renderGroup=null}}tt.mixin(dt,vh,Mh,Gh,Bh,Rh,Ph,Th,Fh,xh,bh,Eh,Sh);class Ui extends dt{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this._bounds=new xt(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const e=this.bounds,{x:i,y:r}=t;return i>=e.minX&&i<=e.maxX&&r>=e.minY&&r<=e.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){super.destroy(t),this._bounds=null;for(const e in this._gpuData)this._gpuData[e].destroy?.();this._gpuData=null}collectRenderablesSimple(t,e,i){const{renderPipes:r}=e;r.blendMode.pushBlendMode(this,this.groupBlendMode,t),r[this.renderPipeId].addRenderable(this,t),this.didViewUpdate=!1;const o=this.children,a=o.length;for(let h=0;h<a;h++)o[h].collectRenderables(t,e,i);r.blendMode.popBlendMode(t)}}let Ge=class Si extends Ui{constructor(t=G.EMPTY){t instanceof G&&(t={texture:t});const{texture:e=G.EMPTY,anchor:i,roundPixels:r,width:n,height:o,...a}=t;super({label:"Sprite",...a}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new J({_onUpdate:()=>{this.onViewUpdate()}}),i?this.anchor=i:e.defaultAnchor&&(this.anchor=e.defaultAnchor),this.texture=e,this.allowChildren=!1,this.roundPixels=r??!1,n!==void 0&&(this.width=n),o!==void 0&&(this.height=o)}static from(t,e=!1){return t instanceof G?new Si(t):new Si(G.from(t,e))}set texture(t){t||(t=G.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return hh(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return B("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this._anchor,e=this._texture,i=this._bounds,{width:r,height:n}=e.orig;i.minX=-t._x*r,i.maxX=i.minX+r,i.minY=-t._y*n,i.maxY=i.minY+n}destroy(t=!1){if(super.destroy(t),typeof t=="boolean"?t:t?.texture){const i=typeof t=="boolean"?t:t?.textureSource;this._texture.destroy(i)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null,this._gpuData=null}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this._texture.orig.width),e!==void 0&&this._setHeight(e,this._texture.orig.height)}};const $h=new xt;function ao(s,t,e){const i=$h;s.measurable=!0,Jn(s,e,i),t.addBoundsMask(i),s.measurable=!1}function ho(s,t,e){const i=Et.get();s.measurable=!0;const r=it.get().identity(),n=lo(s,e,r);so(s,i,n),s.measurable=!1,t.addBoundsMask(i),it.return(r),Et.return(i)}function lo(s,t,e){return s?(s!==t&&(lo(s.parent,t,e),s.updateLocalTransform(),e.append(s.localTransform)),e):(U("Mask bounds, renderable is not inside the root container"),e)}class co{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof Ge),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask=null)}addBounds(t,e){this.inverse||ao(this.mask,t,e)}addLocalBounds(t,e){ho(this.mask,t,e)}containsPoint(t,e){const i=this.mask;return e(i,t)}destroy(){this.reset()}static test(t){return t instanceof Ge}}co.extension=R.MaskEffect;class uo{constructor(t){this.priority=0,this.pipe="colorMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}uo.extension=R.MaskEffect;class fo{constructor(t){this.priority=0,this.pipe="stencilMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null)}addBounds(t,e){ao(this.mask,t,e)}addLocalBounds(t,e){ho(this.mask,t,e)}containsPoint(t,e){const i=this.mask;return e(i,t)}destroy(){this.reset()}static test(t){return t instanceof dt}}fo.extension=R.MaskEffect;const Uh={createCanvas:(s,t)=>{const e=document.createElement("canvas");return e.width=s,e.height=t,e},createImage:()=>new Image,getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,t)=>fetch(s,t),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")};let Er=Uh;const N={get(){return Er},set(s){Er=s}};class po extends wt{constructor(t){t.resource||(t.resource=N.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,e=this.height,i=this._resolution){const r=super.resize(t,e,i);return r&&this.resizeCanvas(),r}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}po.extension=R.TextureSource;class Kt extends wt{constructor(t){super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}Kt.extension=R.TextureSource;var Ci=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(Ci||{});class Js{constructor(t,e=null,i=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=e,this.priority=i,this._once=r}match(t,e=null){return this._fn===t&&this._context===e}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const e=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const go=class ht{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Js(null,null,1/0),this.deltaMS=1/ht.targetFPMS,this.elapsedMS=1/ht.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=Ci.NORMAL){return this._addListener(new Js(t,e,i))}addOnce(t,e,i=Ci.NORMAL){return this._addListener(new Js(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*ht.targetFPMS;const i=this._head;let r=i.next;for(;r;)r=r.emit(this);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,ht.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!ht._shared){const t=ht._shared=new ht;t.autoStart=!0,t._protected=!0}return ht._shared}static get system(){if(!ht._system){const t=ht._system=new ht;t.autoStart=!0,t._protected=!0}return ht._system}};go.targetFPMS=.06;let Me=go,ti;async function mo(){return ti??(ti=(async()=>{const t=N.get().createCanvas(1,1).getContext("webgl");if(!t)return"premultiply-alpha-on-upload";const e=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!e)return"premultiply-alpha-on-upload";const i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const n=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,n),t.deleteFramebuffer(r),t.deleteTexture(i),t.getExtension("WEBGL_lose_context")?.loseContext(),n[0]<=n[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),ti}const Gs=class yo extends wt{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...yo.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=Me.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource,e=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(e.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlayThrough),t.addEventListener("error",this._onError,!0)),this.alphaMode=await mo(),this._load=new Promise((i,r)=>{this.isValid?i(this):(this._resolve=i,this._reject=r,e.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${e.preloadTimeoutMs}ms`))})),t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlayThrough),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(Me.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Me.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Me.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};Gs.extension=R.TextureSource;Gs.defaultOptions={...wt.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};Gs.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Oe=Gs;const yt=(s,t,e=!1)=>(Array.isArray(s)||(s=[s]),t?s.map(i=>typeof i=="string"||e?t(i):i):s);class Hh{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||U(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=yt(t);let r;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.test(e)){r=l.getCacheableAssets(i,e);break}}const n=new Map(Object.entries(r||{}));r||i.forEach(h=>{n.set(h,e)});const o=[...n.keys()],a={cacheKeys:o,keys:i};i.forEach(h=>{this._cacheMap.set(h,a)}),o.forEach(h=>{const l=r?r[h]:e;this._cache.has(h)&&this._cache.get(h)!==l&&U("[Cache] already has key:",h),this._cache.set(h,n.get(h))})}remove(t){if(!this._cacheMap.has(t)){U(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(r=>{this._cache.delete(r)}),e.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const $=new Hh,Pi=[];tt.handleByList(R.TextureSource,Pi);function xo(s={}){const t=s&&s.resource,e=t?s.resource:s,i=t?s:{resource:s};for(let r=0;r<Pi.length;r++){const n=Pi[r];if(n.test(e))return new n(i)}throw new Error(`Could not find a source type for resource: ${i.resource}`)}function Vh(s={},t=!1){const e=s&&s.resource,i=e?s.resource:s,r=e?s:{resource:s};if(!t&&$.has(i))return $.get(i);const n=new G({source:xo(r)});return n.on("destroy",()=>{$.has(i)&&$.remove(i)}),t||$.set(i,n),n}function jh(s,t=!1){return typeof s=="string"?$.get(s):s instanceof wt?new G({source:s}):Vh(s,t)}G.from=jh;wt.from=xo;tt.add(co,uo,fo,Oe,Kt,po,Ni);var Ot=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(Ot||{});function gt(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function be(s){return s.split("?")[0].split("#")[0]}function Yh(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Xh(s,t,e){return s.replace(new RegExp(Yh(t),"g"),e)}function qh(s,t){let e="",i=0,r=-1,n=0,o=-1;for(let a=0;a<=s.length;++a){if(a<s.length)o=s.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(r===a-1||n===1))if(r!==a-1&&n===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",i=0):(e=e.slice(0,h),i=e.length-1-e.lastIndexOf("/")),r=a,n=0;continue}}else if(e.length===2||e.length===1){e="",i=0,r=a,n=0;continue}}}else e.length>0?e+=`/${s.slice(r+1,a)}`:e=s.slice(r+1,a),i=a-r-1;r=a,n=0}else o===46&&n!==-1?++n:n=-1}return e}const lt={toPosix(s){return Xh(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},isBlobUrl(s){return s.startsWith("blob:")},hasProtocol(s){return/^[^/:]+:/.test(this.toPosix(s))},getProtocol(s){gt(s),s=this.toPosix(s);const t=/^file:\/\/\//.exec(s);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(s);return e?e[0]:""},toAbsolute(s,t,e){if(gt(s),this.isDataUrl(s)||this.isBlobUrl(s))return s;const i=be(this.toPosix(t??N.get().getBaseUrl())),r=be(this.toPosix(e??this.rootname(i)));return s=this.toPosix(s),s.startsWith("/")?lt.join(r,s.slice(1)):this.isAbsolute(s)?s:this.join(i,s)},normalize(s){if(gt(s),s.length===0)return".";if(this.isDataUrl(s)||this.isBlobUrl(s))return s;s=this.toPosix(s);let t="";const e=s.startsWith("/");this.hasProtocol(s)&&(t=this.rootname(s),s=s.slice(t.length));const i=s.endsWith("/");return s=qh(s),s.length>0&&i&&(s+="/"),e?`/${s}`:t+s},isAbsolute(s){return gt(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let t;for(let e=0;e<s.length;++e){const i=s[e];if(gt(i),i.length>0)if(t===void 0)t=i;else{const r=s[e-1]??"";this.joinExtensions.includes(this.extname(r).toLowerCase())?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(s){if(gt(s),s.length===0)return".";s=this.toPosix(s);let t=s.charCodeAt(0);const e=t===47;let i=-1,r=!0;const n=this.getProtocol(s),o=s;s=s.slice(n.length);for(let a=s.length-1;a>=1;--a)if(t=s.charCodeAt(a),t===47){if(!r){i=a;break}}else r=!1;return i===-1?e?"/":this.isUrl(o)?n+s:n:e&&i===1?"//":n+s.slice(0,i)},rootname(s){gt(s),s=this.toPosix(s);let t="";if(s.startsWith("/")?t="/":t=this.getProtocol(s),this.isUrl(s)){const e=s.indexOf("/",t.length);e!==-1?t=s.slice(0,e):t=s,t.endsWith("/")||(t+="/")}return t},basename(s,t){gt(s),t&&gt(t),s=be(this.toPosix(s));let e=0,i=-1,r=!0,n;if(t!==void 0&&t.length>0&&t.length<=s.length){if(t.length===s.length&&t===s)return"";let o=t.length-1,a=-1;for(n=s.length-1;n>=0;--n){const h=s.charCodeAt(n);if(h===47){if(!r){e=n+1;break}}else a===-1&&(r=!1,a=n+1),o>=0&&(h===t.charCodeAt(o)?--o===-1&&(i=n):(o=-1,i=a))}return e===i?i=a:i===-1&&(i=s.length),s.slice(e,i)}for(n=s.length-1;n>=0;--n)if(s.charCodeAt(n)===47){if(!r){e=n+1;break}}else i===-1&&(r=!1,i=n+1);return i===-1?"":s.slice(e,i)},extname(s){gt(s),s=be(this.toPosix(s));let t=-1,e=0,i=-1,r=!0,n=0;for(let o=s.length-1;o>=0;--o){const a=s.charCodeAt(o);if(a===47){if(!r){e=o+1;break}continue}i===-1&&(r=!1,i=o+1),a===46?t===-1?t=o:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||i===-1||n===0||n===1&&t===i-1&&t===e+1?"":s.slice(t,i)},parse(s){gt(s);const t={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return t;s=be(this.toPosix(s));let e=s.charCodeAt(0);const i=this.isAbsolute(s);let r;t.root=this.rootname(s),i||this.hasProtocol(s)?r=1:r=0;let n=-1,o=0,a=-1,h=!0,l=s.length-1,c=0;for(;l>=r;--l){if(e=s.charCodeAt(l),e===47){if(!h){o=l+1;break}continue}a===-1&&(h=!1,a=l+1),e===46?n===-1?n=l:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||a===-1||c===0||c===1&&n===a-1&&n===o+1?a!==-1&&(o===0&&i?t.base=t.name=s.slice(1,a):t.base=t.name=s.slice(o,a)):(o===0&&i?(t.name=s.slice(1,n),t.base=s.slice(1,a)):(t.name=s.slice(o,n),t.base=s.slice(o,a)),t.ext=s.slice(n,a)),t.dir=this.dirname(s),t},sep:"/",delimiter:":",joinExtensions:[".html"]};function _o(s,t,e,i,r){const n=t[e];for(let o=0;o<n.length;o++){const a=n[o];e<t.length-1?_o(s.replace(i[e],a),t,e+1,i,r):r.push(s.replace(i[e],a))}}function Kh(s){const t=/\{(.*?)\}/g,e=s.match(t),i=[];if(e){const r=[];e.forEach(n=>{const o=n.substring(1,n.length-1).split(",");r.push(o)}),_o(s,r,0,e,i)}else i.push(s);return i}const Ts=s=>!Array.isArray(s);class pe{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}getAlias(t){const{alias:e,src:i}=t;return yt(e||i,n=>typeof n=="string"?n:Array.isArray(n)?n.map(o=>o?.src??o):n?.src?n.src:n,!0)}addManifest(t){this._manifest&&U("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];let r=e;Array.isArray(e)||(r=Object.entries(e).map(([n,o])=>typeof o=="string"||Array.isArray(o)?{alias:n,src:o}:{alias:n,...o})),r.forEach(n=>{const o=n.src,a=n.alias;let h;if(typeof a=="string"){const l=this._createBundleAssetId(t,a);i.push(l),h=[a,l]}else{const l=a.map(c=>this._createBundleAssetId(t,c));i.push(...l),h=[...a,...l]}this.add({...n,alias:h,src:o})}),this._bundles[t]=i}add(t){const e=[];Array.isArray(t)?e.push(...t):e.push(t);let i;i=n=>{this.hasKey(n)&&U(`[Resolver] already has key: ${n} overwriting`)},yt(e).forEach(n=>{const{src:o}=n;let{data:a,format:h,loadParser:l,parser:c}=n;const u=yt(o).map(y=>typeof y=="string"?Kh(y):Array.isArray(y)?y:[y]),f=this.getAlias(n);Array.isArray(f)?f.forEach(i):i(f);const d=[],p=y=>({...this._parsers.find(x=>x.test(y))?.parse(y),src:y});u.forEach(y=>{y.forEach(g=>{let x={};if(typeof g!="object"?x=p(g):(a=g.data??a,h=g.format??h,(g.loadParser||g.parser)&&(l=g.loadParser??l,c=g.parser??c),x={...p(g.src),...g}),!f)throw new Error(`[Resolver] alias is undefined for this asset: ${x.src}`);x=this._buildResolvedAsset(x,{aliases:f,data:a,format:h,loadParser:l,parser:c,progressSize:n.progressSize}),d.push(x)})}),f.forEach(y=>{this._assetMap[y]=d})})}resolveBundle(t){const e=Ts(t);t=yt(t);const i={};return t.forEach(r=>{const n=this._bundles[r];if(n){const o=this.resolve(n),a={};for(const h in o){const l=o[h];a[this._extractAssetIdFromBundle(r,h)]=l}i[r]=a}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const i={};for(const r in e)i[r]=e[r].src;return i}return e.src}resolve(t){const e=Ts(t);t=yt(t);const i={};return t.forEach(r=>{if(!this._resolverHash[r])if(this._assetMap[r]){let n=this._assetMap[r];const o=this._getPreferredOrder(n);o?.priority.forEach(a=>{o.params[a].forEach(h=>{const l=n.filter(c=>c[a]?c[a]===h:!1);l.length&&(n=l)})}),this._resolverHash[r]=n[0]}else this._resolverHash[r]=this._buildResolvedAsset({alias:[r],src:r},{});i[r]=this._resolverHash[r]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[e],r=this._preferredOrder.find(n=>n.params.format.includes(i.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}_buildResolvedAsset(t,e){const{aliases:i,data:r,loadParser:n,parser:o,format:a,progressSize:h}=e;return(this._basePath||this._rootPath)&&(t.src=lt.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...r||{},...t.data},t.loadParser=n??t.loadParser,t.parser=o??t.parser,t.format=a??t.format??Zh(t.src),h!==void 0&&(t.progressSize=h),t}}pe.RETINA_PREFIX=/@([0-9\.]+)x/;function Zh(s){return s.split(".").pop().split("?").shift().split("#").shift()}const Ti=(s,t)=>{const e=t.split("?")[1];return e&&(s+=`?${e}`),s},wo=class Ee{constructor(t,e){this.linkedSheets=[];let i=t;t?.source instanceof wt&&(i={texture:t,data:e});const{texture:r,data:n,cachePrefix:o=""}=i;this.cachePrefix=o,this._texture=r instanceof G?r:null,this.textureSource=r.source,this.textures={},this.animations={},this.data=n;const a=parseFloat(n.meta.scale);a?(this.resolution=a,r.source.resolution=this.resolution):this.resolution=r.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Ee.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const i=Ee.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const r=this._frameKeys[e],n=this._frames[r],o=n.frame;if(o){let a=null,h=null;const l=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,c=new j(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);n.rotated?a=new j(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new j(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(h=new j(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[r]=new G({source:this.textureSource,frame:a,orig:c,trim:h,rotate:n.rotated?2:0,defaultAnchor:n.anchor,defaultBorders:n.borders,label:r.toString()})}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const r=t[e][i];this.animations[e].push(this.textures[r])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ee.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Ee.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};wo.BATCH_SIZE=1e3;let Ir=wo;const Qh=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function bo(s,t,e){const i={};if(s.forEach(r=>{i[r]=t}),Object.keys(t.textures).forEach(r=>{i[`${t.cachePrefix}${r}`]=t.textures[r]}),!e){const r=lt.dirname(s[0]);t.linkedSheets.forEach((n,o)=>{const a=bo([`${r}/${t.data.meta.related_multi_packs[o]}`],n,!0);Object.assign(i,a)})}return i}const Jh={extension:R.Asset,cache:{test:s=>s instanceof Ir,getCacheableAssets:(s,t)=>bo(s,t,!1)},resolver:{extension:{type:R.ResolveParser,name:"resolveSpritesheet"},test:s=>{const e=s.split("?")[0].split("."),i=e.pop(),r=e.pop();return i==="json"&&Qh.includes(r)},parse:s=>{const t=s.split(".");return{resolution:parseFloat(pe.RETINA_PREFIX.exec(s)?.[1]??"1"),format:t[t.length-2],src:s}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:R.LoadParser,priority:Ot.Normal,name:"spritesheetLoader"},async testParse(s,t){return lt.extname(t.src).toLowerCase()===".json"&&!!s.frames},async parse(s,t,e){const{texture:i,imageFilename:r,textureOptions:n,cachePrefix:o}=t?.data??{};let a=lt.dirname(t.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let h;if(i instanceof G)h=i;else{const u=Ti(a+(r??s.meta.image),t.src);h=(await e.load([{src:u,data:n}]))[u]}const l=new Ir({texture:h.source,data:s,cachePrefix:o});await l.parse();const c=s?.meta?.related_multi_packs;if(Array.isArray(c)){const u=[];for(const d of c){if(typeof d!="string")continue;let p=a+d;t.data?.ignoreMultiPack||(p=Ti(p,t.src),u.push(e.load({src:p,data:{textureOptions:n,ignoreMultiPack:!0}})))}const f=await Promise.all(u);l.linkedSheets=f,f.forEach(d=>{d.linkedSheets=[l].concat(l.linkedSheets.filter(p=>p!==d))})}return l},async unload(s,t,e){await e.unload(s.textureSource._sourceOrigin),s.destroy(!1)}}};tt.add(Jh);const ei=Object.create(null),Rr=Object.create(null);function Hi(s,t){let e=Rr[s];return e===void 0&&(ei[t]===void 0&&(ei[t]=1),Rr[s]=e=ei[t]++),e}let hs;function Ao(){return(!hs||hs?.isContextLost())&&(hs=N.get().createCanvas().getContext("webgl",{})),hs}let ls;function tl(){if(!ls){ls="mediump";const s=Ao();s&&s.getShaderPrecisionFormat&&(ls=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision?"highp":"mediump")}return ls}function el(s,t,e){return t?s:e?(s=s.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${s}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${s}
        `}function sl(s,t,e){const i=e?t.maxSupportedFragmentPrecision:t.maxSupportedVertexPrecision;if(s.substring(0,9)!=="precision"){let r=e?t.requestedFragmentPrecision:t.requestedVertexPrecision;return r==="highp"&&i!=="highp"&&(r="mediump"),`precision ${r} float;
${s}`}else if(i!=="highp"&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}function il(s,t){return t?`#version 300 es
${s}`:s}const rl={},nl={};function ol(s,{name:t="pixi-program"},e=!0){t=t.replace(/\s+/g,"-"),t+=e?"-fragment":"-vertex";const i=e?rl:nl;return i[t]?(i[t]++,t+=`-${i[t]}`):i[t]=1,s.indexOf("#define SHADER_NAME")!==-1?s:`${`#define SHADER_NAME ${t}`}
${s}`}function al(s,t){return t?s.replace("#version 300 es",""):s}const si={stripVersion:al,ensurePrecision:sl,addProgramDefines:el,setProgramName:ol,insertVersion:il},Ae=Object.create(null),vo=class ki{constructor(t){t={...ki.defaultOptions,...t};const e=t.fragment.indexOf("#version 300 es")!==-1,i={stripVersion:e,ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:tl()},setProgramName:{name:t.name},addProgramDefines:e,insertVersion:e};let r=t.fragment,n=t.vertex;Object.keys(si).forEach(o=>{const a=i[o];r=si[o](r,a,!0),n=si[o](n,a,!1)}),this.fragment=r,this.vertex=n,this.transformFeedbackVaryings=t.transformFeedbackVaryings,this._key=Hi(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null,Ae[this._cacheKey]=null}static from(t){const e=`${t.vertex}:${t.fragment}`;return Ae[e]||(Ae[e]=new ki(t),Ae[e]._cacheKey=e),Ae[e]}};vo.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let So=vo;const Br={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function hl(s){return Br[s]??Br.float32}const ll={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function cl({source:s,entryPoint:t}){const e={},i=s.indexOf(`fn ${t}`);if(i!==-1){const r=s.indexOf("->",i);if(r!==-1){const n=s.substring(i,r),o=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let a;for(;(a=o.exec(n))!==null;){const h=ll[a[3]]??"float32";e[a[2]]={location:parseInt(a[1],10),format:h,stride:hl(h).stride,offset:0,instance:!1,start:0}}}}return e}function ii(s){const t=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,e=/@group\((\d+)\)/,i=/@binding\((\d+)\)/,r=/var(<[^>]+>)? (\w+)/,n=/:\s*(\w+)/,o=/struct\s+(\w+)\s*{([^}]+)}/g,a=/(\w+)\s*:\s*([\w\<\>]+)/g,h=/struct\s+(\w+)/,l=s.match(t)?.map(u=>({group:parseInt(u.match(e)[1],10),binding:parseInt(u.match(i)[1],10),name:u.match(r)[2],isUniform:u.match(r)[1]==="<uniform>",type:u.match(n)[1]}));if(!l)return{groups:[],structs:[]};const c=s.match(o)?.map(u=>{const f=u.match(h)[1],d=u.match(a).reduce((p,y)=>{const[g,x]=y.split(":");return p[g.trim()]=x.trim(),p},{});return d?{name:f,members:d}:null}).filter(({name:u})=>l.some(f=>f.type===u))??[];return{groups:l,structs:c}}var Ie=(s=>(s[s.VERTEX=1]="VERTEX",s[s.FRAGMENT=2]="FRAGMENT",s[s.COMPUTE=4]="COMPUTE",s))(Ie||{});function ul({groups:s}){const t=[];for(let e=0;e<s.length;e++){const i=s[e];t[i.group]||(t[i.group]=[]),i.isUniform?t[i.group].push({binding:i.binding,visibility:Ie.VERTEX|Ie.FRAGMENT,buffer:{type:"uniform"}}):i.type==="sampler"?t[i.group].push({binding:i.binding,visibility:Ie.FRAGMENT,sampler:{type:"filtering"}}):i.type==="texture_2d"&&t[i.group].push({binding:i.binding,visibility:Ie.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return t}function dl({groups:s}){const t=[];for(let e=0;e<s.length;e++){const i=s[e];t[i.group]||(t[i.group]={}),t[i.group][i.name]=i.binding}return t}function fl(s,t){const e=new Set,i=new Set,r=[...s.structs,...t.structs].filter(o=>e.has(o.name)?!1:(e.add(o.name),!0)),n=[...s.groups,...t.groups].filter(o=>{const a=`${o.name}-${o.binding}`;return i.has(a)?!1:(i.add(a),!0)});return{structs:r,groups:n}}const ve=Object.create(null);class Os{constructor(t){this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:e,vertex:i,layout:r,gpuLayout:n,name:o}=t;if(this.name=o,this.fragment=e,this.vertex=i,e.source===i.source){const a=ii(e.source);this.structsAndGroups=a}else{const a=ii(i.source),h=ii(e.source);this.structsAndGroups=fl(a,h)}this.layout=r??dl(this.structsAndGroups),this.gpuLayout=n??ul(this.structsAndGroups),this.autoAssignGlobalUniforms=this.layout[0]?.globalUniforms!==void 0,this.autoAssignLocalUniforms=this.layout[1]?.localUniforms!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,i=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=Hi(i,"program")}get attributeData(){return this._attributeData??(this._attributeData=cl(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,ve[this._cacheKey]=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return ve[e]||(ve[e]=new Os(t),ve[e]._cacheKey=e),ve[e]}}const Co=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],pl=Co.reduce((s,t)=>(s[t]=!0,s),{});function gl(s,t){switch(s){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*t);case"vec3<f32>":return new Float32Array(3*t);case"vec4<f32>":return new Float32Array(4*t);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Po=class To{constructor(t,e){this._touched=0,this.uid=K("uniform"),this._resourceType="uniformGroup",this._resourceId=K("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,e={...To.defaultOptions,...e},this.uniformStructures=t;const i={};for(const r in t){const n=t[r];if(n.name=r,n.size=n.size??1,!pl[n.type]){const o=n.type.match(/^array<(\w+(?:<\w+>)?),\s*(\d+)>$/);if(o){const[,a,h]=o;throw new Error(`Uniform type ${n.type} is not supported. Use type: '${a}', size: ${h} instead.`)}throw new Error(`Uniform type ${n.type} is not supported. Supported uniform types are: ${Co.join(", ")}`)}n.value??(n.value=gl(n.type,n.size)),i[r]=n.value}this.uniforms=i,this._dirtyId=1,this.ubo=e.ubo,this.isStatic=e.isStatic,this._signature=Hi(Object.keys(i).map(r=>`${r}-${t[r].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};Po.defaultOptions={ubo:!1,isStatic:!1};let ko=Po;class _s{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const i in t){const r=t[i];this.setResource(r,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const i in this.resources)t[e++]=this.resources[i]._resourceId;this._key=t.join("|")}setResource(t,e){const i=this.resources[e];t!==i&&(i&&t.off?.("change",this.onResourceChange,this),t.on?.("change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){const e=this.resources;for(const i in e)e[i]._touched=t}destroy(){const t=this.resources;for(const e in t)t[e]?.off?.("change",this.onResourceChange,this);this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const i in e)e[i]===t&&(e[i]=null)}else this._updateKey()}}var Mi=(s=>(s[s.WEBGL=1]="WEBGL",s[s.WEBGPU=2]="WEBGPU",s[s.BOTH=3]="BOTH",s))(Mi||{});class Vi extends _t{constructor(t){super(),this.uid=K("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[],this._destroyed=!1;let{gpuProgram:e,glProgram:i,groups:r,resources:n,compatibleRenderers:o,groupMap:a}=t;this.gpuProgram=e,this.glProgram=i,o===void 0&&(o=0,e&&(o|=Mi.WEBGPU),i&&(o|=Mi.WEBGL)),this.compatibleRenderers=o;const h={};if(!n&&!r&&(n={}),n&&r)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&r&&!a)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&r&&a)for(const l in a)for(const c in a[l]){const u=a[l][c];h[u]={group:l,binding:c,name:u}}else if(e&&r&&!a){const l=e.structsAndGroups.groups;a={},l.forEach(c=>{a[c.group]=a[c.group]||{},a[c.group][c.binding]=c.name,h[c.name]=c})}else if(n){r={},a={},e&&e.structsAndGroups.groups.forEach(u=>{a[u.group]=a[u.group]||{},a[u.group][u.binding]=u.name,h[u.name]=u});let l=0;for(const c in n)h[c]||(r[99]||(r[99]=new _s,this._ownedBindGroups.push(r[99])),h[c]={group:99,binding:l,name:c},a[99]=a[99]||{},a[99][l]=c,l++);for(const c in n){const u=c;let f=n[c];!f.source&&!f._resourceType&&(f=new ko(f));const d=h[u];d&&(r[d.group]||(r[d.group]=new _s,this._ownedBindGroups.push(r[d.group])),r[d.group].setResource(f,d.binding))}}this.groups=r,this._uniformBindMap=a,this.resources=this._buildResourceAccessor(r,h)}addResource(t,e,i){var r,n;(r=this._uniformBindMap)[e]||(r[e]={}),(n=this._uniformBindMap[e])[i]||(n[i]=t),this.groups[e]||(this.groups[e]=new _s,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const i={};for(const r in e){const n=e[r];Object.defineProperty(i,n.name,{get(){return t[n.group].getResource(n.binding)},set(o){t[n.group].setResource(o,n.binding)}})}return i}destroy(t=!1){this._destroyed||(this._destroyed=!0,this.emit("destroy",this),t&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(e=>{e.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null)}static from(t){const{gpu:e,gl:i,...r}=t;let n,o;return e&&(n=Os.from(e)),i&&(o=So.from(i)),new Vi({gpuProgram:n,glProgram:o,...r})}}const Ei=[];tt.handleByNamedList(R.Environment,Ei);async function ml(s){if(!s)for(let t=0;t<Ei.length;t++){const e=Ei[t];if(e.value.test()){await e.value.load();return}}}let Se;function yl(){if(typeof Se=="boolean")return Se;try{Se=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Se=!1}return Se}function Fr(s,t,e=2){const i=t&&t.length,r=i?t[0]*e:s.length;let n=Mo(s,0,r,e,!0);const o=[];if(!n||n.next===n.prev)return o;let a,h,l;if(i&&(n=Al(s,t,n,e)),s.length>80*e){a=s[0],h=s[1];let c=a,u=h;for(let f=e;f<r;f+=e){const d=s[f],p=s[f+1];d<a&&(a=d),p<h&&(h=p),d>c&&(c=d),p>u&&(u=p)}l=Math.max(c-a,u-h),l=l!==0?32767/l:0}return $e(n,o,e,a,h,l,0),o}function Mo(s,t,e,i,r){let n;if(r===Bl(s,t,e,i)>0)for(let o=t;o<e;o+=i)n=Lr(o/i|0,s[o],s[o+1],n);else for(let o=e-i;o>=t;o-=i)n=Lr(o/i|0,s[o],s[o+1],n);return n&&ce(n,n.next)&&(He(n),n=n.next),n}function Zt(s,t){if(!s)return s;t||(t=s);let e=s,i;do if(i=!1,!e.steiner&&(ce(e,e.next)||X(e.prev,e,e.next)===0)){if(He(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function $e(s,t,e,i,r,n,o){if(!s)return;!o&&n&&Tl(s,i,r,n);let a=s;for(;s.prev!==s.next;){const h=s.prev,l=s.next;if(n?_l(s,i,r,n):xl(s)){t.push(h.i,s.i,l.i),He(s),s=l.next,a=l.next;continue}if(s=l,s===a){o?o===1?(s=wl(Zt(s),t),$e(s,t,e,i,r,n,2)):o===2&&bl(s,t,e,i,r,n):$e(Zt(s),t,e,i,r,n,1);break}}}function xl(s){const t=s.prev,e=s,i=s.next;if(X(t,e,i)>=0)return!1;const r=t.x,n=e.x,o=i.x,a=t.y,h=e.y,l=i.y,c=Math.min(r,n,o),u=Math.min(a,h,l),f=Math.max(r,n,o),d=Math.max(a,h,l);let p=i.next;for(;p!==t;){if(p.x>=c&&p.x<=f&&p.y>=u&&p.y<=d&&Re(r,a,n,h,o,l,p.x,p.y)&&X(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function _l(s,t,e,i){const r=s.prev,n=s,o=s.next;if(X(r,n,o)>=0)return!1;const a=r.x,h=n.x,l=o.x,c=r.y,u=n.y,f=o.y,d=Math.min(a,h,l),p=Math.min(c,u,f),y=Math.max(a,h,l),g=Math.max(c,u,f),x=Ii(d,p,t,e,i),_=Ii(y,g,t,e,i);let m=s.prevZ,w=s.nextZ;for(;m&&m.z>=x&&w&&w.z<=_;){if(m.x>=d&&m.x<=y&&m.y>=p&&m.y<=g&&m!==r&&m!==o&&Re(a,c,h,u,l,f,m.x,m.y)&&X(m.prev,m,m.next)>=0||(m=m.prevZ,w.x>=d&&w.x<=y&&w.y>=p&&w.y<=g&&w!==r&&w!==o&&Re(a,c,h,u,l,f,w.x,w.y)&&X(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;m&&m.z>=x;){if(m.x>=d&&m.x<=y&&m.y>=p&&m.y<=g&&m!==r&&m!==o&&Re(a,c,h,u,l,f,m.x,m.y)&&X(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;w&&w.z<=_;){if(w.x>=d&&w.x<=y&&w.y>=p&&w.y<=g&&w!==r&&w!==o&&Re(a,c,h,u,l,f,w.x,w.y)&&X(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function wl(s,t){let e=s;do{const i=e.prev,r=e.next.next;!ce(i,r)&&Io(i,e,e.next,r)&&Ue(i,r)&&Ue(r,i)&&(t.push(i.i,e.i,r.i),He(e),He(e.next),e=s=r),e=e.next}while(e!==s);return Zt(e)}function bl(s,t,e,i,r,n){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&El(o,a)){let h=Ro(o,a);o=Zt(o,o.next),h=Zt(h,h.next),$e(o,t,e,i,r,n,0),$e(h,t,e,i,r,n,0);return}a=a.next}o=o.next}while(o!==s)}function Al(s,t,e,i){const r=[];for(let n=0,o=t.length;n<o;n++){const a=t[n]*i,h=n<o-1?t[n+1]*i:s.length,l=Mo(s,a,h,i,!1);l===l.next&&(l.steiner=!0),r.push(Ml(l))}r.sort(vl);for(let n=0;n<r.length;n++)e=Sl(r[n],e);return e}function vl(s,t){let e=s.x-t.x;if(e===0&&(e=s.y-t.y,e===0)){const i=(s.next.y-s.y)/(s.next.x-s.x),r=(t.next.y-t.y)/(t.next.x-t.x);e=i-r}return e}function Sl(s,t){const e=Cl(s,t);if(!e)return t;const i=Ro(e,s);return Zt(i,i.next),Zt(e,e.next)}function Cl(s,t){let e=t;const i=s.x,r=s.y;let n=-1/0,o;if(ce(s,e))return e;do{if(ce(s,e.next))return e.next;if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){const u=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(u<=i&&u>n&&(n=u,o=e.x<e.next.x?e:e.next,u===i))return o}e=e.next}while(e!==t);if(!o)return null;const a=o,h=o.x,l=o.y;let c=1/0;e=o;do{if(i>=e.x&&e.x>=h&&i!==e.x&&Eo(r<l?i:n,r,h,l,r<l?n:i,r,e.x,e.y)){const u=Math.abs(r-e.y)/(i-e.x);Ue(e,s)&&(u<c||u===c&&(e.x>o.x||e.x===o.x&&Pl(o,e)))&&(o=e,c=u)}e=e.next}while(e!==a);return o}function Pl(s,t){return X(s.prev,s,t.prev)<0&&X(t.next,s,s.next)<0}function Tl(s,t,e,i){let r=s;do r.z===0&&(r.z=Ii(r.x,r.y,t,e,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==s);r.prevZ.nextZ=null,r.prevZ=null,kl(r)}function kl(s){let t,e=1;do{let i=s,r;s=null;let n=null;for(t=0;i;){t++;let o=i,a=0;for(let l=0;l<e&&(a++,o=o.nextZ,!!o);l++);let h=e;for(;a>0||h>0&&o;)a!==0&&(h===0||!o||i.z<=o.z)?(r=i,i=i.nextZ,a--):(r=o,o=o.nextZ,h--),n?n.nextZ=r:s=r,r.prevZ=n,n=r;i=o}n.nextZ=null,e*=2}while(t>1);return s}function Ii(s,t,e,i,r){return s=(s-e)*r|0,t=(t-i)*r|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function Ml(s){let t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function Eo(s,t,e,i,r,n,o,a){return(r-o)*(t-a)>=(s-o)*(n-a)&&(s-o)*(i-a)>=(e-o)*(t-a)&&(e-o)*(n-a)>=(r-o)*(i-a)}function Re(s,t,e,i,r,n,o,a){return!(s===o&&t===a)&&Eo(s,t,e,i,r,n,o,a)}function El(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!Il(s,t)&&(Ue(s,t)&&Ue(t,s)&&Rl(s,t)&&(X(s.prev,s,t.prev)||X(s,t.prev,t))||ce(s,t)&&X(s.prev,s,s.next)>0&&X(t.prev,t,t.next)>0)}function X(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function ce(s,t){return s.x===t.x&&s.y===t.y}function Io(s,t,e,i){const r=us(X(s,t,e)),n=us(X(s,t,i)),o=us(X(e,i,s)),a=us(X(e,i,t));return!!(r!==n&&o!==a||r===0&&cs(s,e,t)||n===0&&cs(s,i,t)||o===0&&cs(e,s,i)||a===0&&cs(e,t,i))}function cs(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function us(s){return s>0?1:s<0?-1:0}function Il(s,t){let e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&Io(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function Ue(s,t){return X(s.prev,s,s.next)<0?X(s,t,s.next)>=0&&X(s,s.prev,t)>=0:X(s,t,s.prev)<0||X(s,s.next,t)<0}function Rl(s,t){let e=s,i=!1;const r=(s.x+t.x)/2,n=(s.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&r<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==s);return i}function Ro(s,t){const e=Ri(s.i,s.x,s.y),i=Ri(t.i,t.x,t.y),r=s.next,n=t.prev;return s.next=t,t.prev=s,e.next=r,r.prev=e,i.next=e,e.prev=i,n.next=i,i.prev=n,i}function Lr(s,t,e,i){const r=Ri(s,t,e);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function He(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Ri(s,t,e){return{i:s,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Bl(s,t,e,i){let r=0;for(let n=t,o=e-i;n<e;n+=i)r+=(s[o]-s[n])*(s[n+1]+s[o+1]),o=n;return r}const Fl=Fr.default||Fr;var Bo=(s=>(s[s.NONE=0]="NONE",s[s.COLOR=16384]="COLOR",s[s.STENCIL=1024]="STENCIL",s[s.DEPTH=256]="DEPTH",s[s.COLOR_DEPTH=16640]="COLOR_DEPTH",s[s.COLOR_STENCIL=17408]="COLOR_STENCIL",s[s.DEPTH_STENCIL=1280]="DEPTH_STENCIL",s[s.ALL=17664]="ALL",s))(Bo||{});class Ll{constructor(t){this.items=[],this._name=t}emit(t,e,i,r,n,o,a,h){const{name:l,items:c}=this;for(let u=0,f=c.length;u<f;u++)c[u][l](t,e,i,r,n,o,a,h);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&this.items.splice(e,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const Gl=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Fo=class Lo extends _t{constructor(t){super(),this.uid=K("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const e=[...Gl,...this.config.runners??[]];this._addRunners(...e),this._unsafeEvalCheck()}async init(t={}){const e=t.skipExtensionImports===!0?!0:t.manageImports===!1;await ml(e),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const i in this._systemsHash)t={...this._systemsHash[i].constructor.defaultOptions,...t};t={...Lo.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let i=0;i<this.runners.init.items.length;i++)await this.runners.init.items[i].init(t);this._initOptions=t}render(t,e){let i=t;if(i instanceof dt&&(i={container:i},e&&(B(D,"passing a second argument is deprecated, please use render options instead"),i.target=e.renderTexture)),i.target||(i.target=this.view.renderTarget),i.target===this.view.renderTarget&&(this._lastObjectRendered=i.container,i.clearColor??(i.clearColor=this.background.colorRgba),i.clear??(i.clear=this.background.clearBeforeRender)),i.clearColor){const r=Array.isArray(i.clearColor)&&i.clearColor.length===4;i.clearColor=r?i.clearColor:Y.shared.setValue(i.clearColor).toArray()}i.transform||(i.container.updateLocalTransform(),i.transform=i.container.localTransform),i.container.visible&&(i.container.enableRenderGroup(),this.runners.prerender.emit(i),this.runners.renderStart.emit(i),this.runners.render.emit(i),this.runners.renderEnd.emit(i),this.runners.postrender.emit(i))}resize(t,e,i){const r=this.view.resolution;this.view.resize(t,e,i),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),i!==void 0&&i!==r&&this.runners.resolutionChange.emit(i)}clear(t={}){const e=this;t.target||(t.target=e.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=Bo.ALL);const{clear:i,clearColor:r,target:n}=t;Y.shared.setValue(r??this.background.colorRgba),e.renderTarget.clear(n,i,Y.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(e=>{this.runners[e]=new Ll(e)})}_addSystems(t){let e;for(e in t){const i=t[e];this._addSystem(i.value,i.name)}}_addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const r in this.runners)this.runners[r].add(i);return this}_addPipes(t,e){const i=e.reduce((r,n)=>(r[n.name]=n.value,r),{});t.forEach(r=>{const n=r.value,o=r.name,a=i[o];this.renderPipes[o]=new n(this,a?new a:null),this.runners.destroy.add(this.renderPipes[o])})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),(t===!0||typeof t=="object"&&t.releaseGlobalResources)&&Qe.release(),Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!yl())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Fo.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Go=Fo,ds;function Ol(s){return ds!==void 0||(ds=(()=>{const t={stencil:!0,failIfMajorPerformanceCaveat:s??Go.defaultOptions.failIfMajorPerformanceCaveat};try{if(!N.get().getWebGLRenderingContext())return!1;let i=N.get().createCanvas().getContext("webgl",t);const r=!!i?.getContextAttributes()?.stencil;if(i){const n=i.getExtension("WEBGL_lose_context");n&&n.loseContext()}return i=null,r}catch{return!1}})()),ds}let fs;async function Dl(s={}){return fs!==void 0||(fs=await(async()=>{const t=N.get().getNavigator().gpu;if(!t)return!1;try{return await(await t.requestAdapter(s)).requestDevice(),!0}catch{return!1}})()),fs}const Gr=["webgl","webgpu","canvas"];async function zl(s){let t=[];s.preference?(t.push(s.preference),Gr.forEach(n=>{n!==s.preference&&t.push(n)})):t=Gr.slice();let e,i={};for(let n=0;n<t.length;n++){const o=t[n];if(o==="webgpu"&&await Dl()){const{WebGPURenderer:a}=await Ps(async()=>{const{WebGPURenderer:h}=await import("./WebGPURenderer-DEY6rgTF.js");return{WebGPURenderer:h}},__vite__mapDeps([3,2,4]));e=a,i={...s,...s.webgpu};break}else if(o==="webgl"&&Ol(s.failIfMajorPerformanceCaveat??Go.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await Ps(async()=>{const{WebGLRenderer:h}=await import("./WebGLRenderer-DCiX61iL.js");return{WebGLRenderer:h}},__vite__mapDeps([5,2,4]));e=a,i={...s,...s.webgl};break}else if(o==="canvas")throw i={...s},new Error("CanvasRenderer is not yet implemented")}if(delete i.webgpu,delete i.webgl,!e)throw new Error("No available renderer for the current environment");const r=new e;return await r.init(i),r}const Oo="8.14.3";class Do{static init(){globalThis.__PIXI_APP_INIT__?.(this,Oo)}static destroy(){}}Do.extension=R.Application;class Wl{constructor(t){this._renderer=t}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,Oo)}destroy(){this._renderer=null}}Wl.extension={type:[R.WebGLSystem,R.WebGPUSystem],name:"initHook",priority:-10};const zo=class Bi{constructor(...t){this.stage=new dt,t[0]!==void 0&&B(D,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.stage||(this.stage=new dt),this.renderer=await zl(t),Bi._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return B(D,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,e=!1){const i=Bi._plugins.slice(0);i.reverse(),i.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};zo._plugins=[];let Wo=zo;tt.handleByList(R.Application,Wo._plugins);tt.add(Do);class No extends _t{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return B(D,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return B(D,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return B(D,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return B(D,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return B(D,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners();for(const e in this.chars)this.chars[e].texture?.destroy();this.chars=null,t&&(this.pages.forEach(e=>e.texture.destroy(!0)),this.pages=null)}}/**
 * tiny-lru
 *
 * @copyright 2025 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.4.5
 */class Nl{constructor(t=0,e=0,i=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=i,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){return t.map(e=>[e,this.get(e)])}evict(t=!1){if(t||this.size>0){const e=this.first;delete this.items[e.key],--this.size===0?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){const e=this.items[t];if(e!==void 0){if(this.ttl>0&&e.expiry<=Date.now()){this.delete(t);return}return this.moveToEnd(e),e.value}}has(t){return t in this.items}moveToEnd(t){this.last!==t&&(t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),t.prev=this.last,t.next=null,this.last!==null&&(this.last.next=t),this.last=t,this.first===null&&(this.first=t))}keys(){const t=[];let e=this.first;for(;e!==null;)t.push(e.key),e=e.next;return t}setWithEvicted(t,e,i=this.resetTtl){let r=null;if(this.has(t))this.set(t,e,!0,i);else{this.max>0&&this.size===this.max&&(r={...this.first},this.evict(!0));let n=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e};++this.size===1?this.first=n:this.last.next=n,this.last=n}return r}set(t,e,i=!1,r=this.resetTtl){let n=this.items[t];return i||n!==void 0?(n.value=e,i===!1&&r&&(n.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.moveToEnd(n)):(this.max>0&&this.size===this.max&&this.evict(!0),n=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},++this.size===1?this.first=n:this.last.next=n,this.last=n),this}values(t=this.keys()){return t.map(e=>this.get(e))}}function $o(s=1e3,t=0,e=!1){if(isNaN(s)||s<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if(typeof e!="boolean")throw new TypeError("Invalid resetTtl value");return new Nl(s,t,e)}const $l=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function ks(s){const t=typeof s.fontSize=="number"?`${s.fontSize}px`:s.fontSize;let e=s.fontFamily;Array.isArray(s.fontFamily)||(e=s.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let r=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!$l.includes(r)&&(r=`"${r}"`),e[i]=r}return`${s.fontStyle} ${s.fontVariant} ${s.fontWeight} ${t} ${e.join(",")}`}const ri={willReadFrequently:!0},bt=class M{static get experimentalLetterSpacingSupported(){let t=M._experimentalLetterSpacingSupported;if(t===void 0){const e=N.get().getCanvasRenderingContext2D().prototype;t=M._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,r,n,o,a,h,l){this.text=t,this.style=e,this.width=i,this.height=r,this.lines=n,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=h,this.fontProperties=l}static measureText(t=" ",e,i=M._canvas,r=e.wordWrap){const n=`${t}-${e.styleKey}-wordWrap-${r}`;if(M._measurementCache.has(n))return M._measurementCache.get(n);const o=ks(e),a=M.measureFont(o);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);const h=M.__context;h.font=o;const c=(r?M._wordWrap(t,e,i):t).split(/(?:\r\n|\r|\n)/),u=new Array(c.length);let f=0;for(let _=0;_<c.length;_++){const m=M._measureText(c[_],e.letterSpacing,h);u[_]=m,f=Math.max(f,m)}const d=e._stroke?.width||0;let p=f+d;e.dropShadow&&(p+=e.dropShadow.distance);const y=e.lineHeight||a.fontSize;let g=Math.max(y,a.fontSize+d)+(c.length-1)*(y+e.leading);e.dropShadow&&(g+=e.dropShadow.distance);const x=new M(t,e,p,g,c,u,y+e.leading,f,a);return M._measurementCache.set(n,x),x}static _measureText(t,e,i){let r=!1;M.experimentalLetterSpacingSupported&&(M.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,r=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));const n=i.measureText(t);let o=n.width;const a=-n.actualBoundingBoxLeft;let l=n.actualBoundingBoxRight-a;if(o>0)if(r)o-=e,l-=e;else{const c=(M.graphemeSegmenter(t).length-1)*e;o+=c,l+=c}return Math.max(o,l)}static _wordWrap(t,e,i=M._canvas){const r=i.getContext("2d",ri);let n=0,o="",a="";const h=Object.create(null),{letterSpacing:l,whiteSpace:c}=e,u=M._collapseSpaces(c),f=M._collapseNewlines(c);let d=!u;const p=e.wordWrapWidth+l,y=M._tokenize(t);for(let g=0;g<y.length;g++){let x=y[g];if(M._isNewline(x)){if(!f){a+=M._addLine(o),d=!u,o="",n=0;continue}x=" "}if(u){const m=M.isBreakingSpace(x),w=M.isBreakingSpace(o[o.length-1]);if(m&&w)continue}const _=M._getFromCache(x,l,h,r);if(_>p)if(o!==""&&(a+=M._addLine(o),o="",n=0),M.canBreakWords(x,e.breakWords)){const m=M.wordWrapSplit(x);for(let w=0;w<m.length;w++){let v=m[w],b=v,A=1;for(;m[w+A];){const C=m[w+A];if(!M.canBreakChars(b,C,x,w,e.breakWords))v+=C;else break;b=C,A++}w+=A-1;const I=M._getFromCache(v,l,h,r);I+n>p&&(a+=M._addLine(o),d=!1,o="",n=0),o+=v,n+=I}}else{o.length>0&&(a+=M._addLine(o),o="",n=0);const m=g===y.length-1;a+=M._addLine(x,!m),d=!1,o="",n=0}else _+n>p&&(d=!1,a+=M._addLine(o),o="",n=0),(o.length>0||!M.isBreakingSpace(x)||d)&&(o+=x,n+=_)}return a+=M._addLine(o,!1),a}static _addLine(t,e=!0){return t=M._trimRight(t),t=e?`${t}
`:t,t}static _getFromCache(t,e,i,r){let n=i[t];return typeof n!="number"&&(n=M._measureText(t,e,r)+e,i[t]=n),n}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!M.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:M._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:M._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const e=[];let i="";if(typeof t!="string")return e;for(let r=0;r<t.length;r++){const n=t[r],o=t[r+1];if(M.isBreakingSpace(n,o)||M._isNewline(n)){i!==""&&(e.push(i),i=""),n==="\r"&&o===`
`?(e.push(`\r
`),r++):e.push(n);continue}i+=n}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,r,n){return!0}static wordWrapSplit(t){return M.graphemeSegmenter(t)}static measureFont(t){if(M._fonts[t])return M._fonts[t];const e=M._context;e.font=t;const i=e.measureText(M.METRICS_STRING+M.BASELINE_SYMBOL),r={ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,fontSize:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent};return M._fonts[t]=r,r}static clearMetrics(t=""){t?delete M._fonts[t]:M._fonts={}}static get _canvas(){if(!M.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext("2d",ri)?.measureText)return M.__canvas=e,e;t=N.get().createCanvas()}catch{t=N.get().createCanvas()}t.width=t.height=10,M.__canvas=t}return M.__canvas}static get _context(){return M.__context||(M.__context=M._canvas.getContext("2d",ri)),M.__context}};bt.METRICS_STRING="|q";bt.BASELINE_SYMBOL="M";bt.BASELINE_MULTIPLIER=1.4;bt.HEIGHT_MULTIPLIER=2;bt.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){const s=new Intl.Segmenter;return t=>{const e=s.segment(t),i=[];let r=0;for(const n of e)i[r++]=n.segment;return i}}return s=>[...s]})();bt.experimentalLetterSpacing=!1;bt._fonts={};bt._newlines=[10,13];bt._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];bt._measurementCache=$o(1e3);let St=bt;const Or=[{offset:0,color:"white"},{offset:1,color:"black"}],ji=class Fi{constructor(...t){this.uid=K("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let e=Ul(t);e={...e.type==="radial"?Fi.defaultRadialOptions:Fi.defaultLinearOptions,...Vn(e)},this._textureSize=e.textureSize,this._wrapMode=e.wrapMode,e.type==="radial"?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(r=>{this.addColorStop(r.offset,r.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:Y.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:i,y:r}=this.end,n=i-t,o=r-e;const a=n<0||o<0;if(this._wrapMode==="clamp-to-edge"){if(n<0){const g=t;t=i,i=g,n*=-1}if(o<0){const g=e;e=r,r=g,o*=-1}}const h=this.colorStops.length?this.colorStops:Or,l=this._textureSize,{canvas:c,context:u}=zr(l,1),f=a?u.createLinearGradient(this._textureSize,0,0,0):u.createLinearGradient(0,0,this._textureSize,0);Dr(f,h),u.fillStyle=f,u.fillRect(0,0,l,1),this.texture=new G({source:new Kt({resource:c,addressMode:this._wrapMode})});const d=Math.sqrt(n*n+o*o),p=Math.atan2(o,n),y=new F;y.scale(d/l,1),y.rotate(p),y.translate(t,e),this.textureSpace==="local"&&y.scale(l,l),this.transform=y}buildGradient(){this.texture||this._tick++,this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:Or,e=this._textureSize,{canvas:i,context:r}=zr(e,e),{x:n,y:o}=this.center,{x:a,y:h}=this.outerCenter,l=this.innerRadius,c=this.outerRadius,u=a-c,f=h-c,d=e/(c*2),p=(n-u)*d,y=(o-f)*d,g=r.createRadialGradient(p,y,l*d,(a-u)*d,(h-f)*d,c*d);Dr(g,t),r.fillStyle=t[t.length-1].color,r.fillRect(0,0,e,e),r.fillStyle=g,r.translate(p,y),r.rotate(this.rotation),r.scale(1,this.scale),r.translate(-p,-y),r.fillRect(0,0,e,e),this.texture=new G({source:new Kt({resource:i,addressMode:this._wrapMode})});const x=new F;x.scale(1/d,1/d),x.translate(u,f),this.textureSpace==="local"&&x.scale(e,e),this.transform=x}destroy(){this.texture?.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};ji.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};ji.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let Bt=ji;function Dr(s,t){for(let e=0;e<t.length;e++){const i=t[e];s.addColorStop(i.offset,i.color)}}function zr(s,t){const e=N.get().createCanvas(s,t),i=e.getContext("2d");return{canvas:e,context:i}}function Ul(s){let t=s[0]??{};return(typeof t=="number"||s[1])&&(B("8.5.2","use options object instead"),t={type:"linear",start:{x:s[0],y:s[1]},end:{x:s[2],y:s[3]},textureSpace:s[4],textureSize:s[5]??Bt.defaultLinearOptions.textureSize}),t}const Wr={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Ds{constructor(t,e){this.uid=K("fillPattern"),this._tick=0,this.transform=new F,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=Wr[e].addressModeU,t.source.style.addressModeV=Wr[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._tick++}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}var ni,Nr;function Hl(){if(Nr)return ni;Nr=1,ni=e;var s={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},t=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function e(n){var o=[];return n.replace(t,function(a,h,l){var c=h.toLowerCase();for(l=r(l),c=="m"&&l.length>2&&(o.push([h].concat(l.splice(0,2))),c="l",h=h=="m"?"l":"L");;){if(l.length==s[c])return l.unshift(h),o.push(l);if(l.length<s[c])throw new Error("malformed path data");o.push([h].concat(l.splice(0,s[c])))}}),o}var i=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function r(n){var o=n.match(i);return o?o.map(Number):[]}return ni}var Vl=Hl();const jl=$n(Vl);function Yl(s,t){const e=jl(s),i=[];let r=null,n=0,o=0;for(let a=0;a<e.length;a++){const h=e[a],l=h[0],c=h;switch(l){case"M":n=c[1],o=c[2],t.moveTo(n,o);break;case"m":n+=c[1],o+=c[2],t.moveTo(n,o);break;case"H":n=c[1],t.lineTo(n,o);break;case"h":n+=c[1],t.lineTo(n,o);break;case"V":o=c[1],t.lineTo(n,o);break;case"v":o+=c[1],t.lineTo(n,o);break;case"L":n=c[1],o=c[2],t.lineTo(n,o);break;case"l":n+=c[1],o+=c[2],t.lineTo(n,o);break;case"C":n=c[5],o=c[6],t.bezierCurveTo(c[1],c[2],c[3],c[4],n,o);break;case"c":t.bezierCurveTo(n+c[1],o+c[2],n+c[3],o+c[4],n+c[5],o+c[6]),n+=c[5],o+=c[6];break;case"S":n=c[3],o=c[4],t.bezierCurveToShort(c[1],c[2],n,o);break;case"s":t.bezierCurveToShort(n+c[1],o+c[2],n+c[3],o+c[4]),n+=c[3],o+=c[4];break;case"Q":n=c[3],o=c[4],t.quadraticCurveTo(c[1],c[2],n,o);break;case"q":t.quadraticCurveTo(n+c[1],o+c[2],n+c[3],o+c[4]),n+=c[3],o+=c[4];break;case"T":n=c[1],o=c[2],t.quadraticCurveToShort(n,o);break;case"t":n+=c[1],o+=c[2],t.quadraticCurveToShort(n,o);break;case"A":n=c[6],o=c[7],t.arcToSvg(c[1],c[2],c[3],c[4],c[5],n,o);break;case"a":n+=c[6],o+=c[7],t.arcToSvg(c[1],c[2],c[3],c[4],c[5],n,o);break;case"Z":case"z":t.closePath(),i.length>0&&(r=i.pop(),r?(n=r.startX,o=r.startY):(n=0,o=0)),r=null;break;default:U(`Unknown SVG path command: ${l}`)}l!=="Z"&&l!=="z"&&r===null&&(r={startX:n,startY:o},i.push(r))}return t}class Yi{constructor(t=0,e=0,i=0){this.type="circle",this.x=t,this.y=e,this.radius=i}clone(){return new Yi(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let r=this.x-t,n=this.y-e;return r*=r,n*=n,r+n<=i}strokeContains(t,e,i,r=.5){if(this.radius===0)return!1;const n=this.x-t,o=this.y-e,a=this.radius,h=(1-r)*i,l=Math.sqrt(n*n+o*o);return l<=a+h&&l>a-(i-h)}getBounds(t){return t||(t=new j),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Xi{constructor(t=0,e=0,i=0,r=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=i,this.halfHeight=r}clone(){return new Xi(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let i=(t-this.x)/this.halfWidth,r=(e-this.y)/this.halfHeight;return i*=i,r*=r,i+r<=1}strokeContains(t,e,i,r=.5){const{halfWidth:n,halfHeight:o}=this;if(n<=0||o<=0)return!1;const a=i*(1-r),h=i-a,l=n-h,c=o-h,u=n+a,f=o+a,d=t-this.x,p=e-this.y,y=d*d/(l*l)+p*p/(c*c),g=d*d/(u*u)+p*p/(f*f);return y>1&&g<=1}getBounds(t){return t||(t=new j),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=this.halfWidth*2,t.height=this.halfHeight*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function Xl(s,t,e,i,r,n){const o=s-e,a=t-i,h=r-e,l=n-i,c=o*h+a*l,u=h*h+l*l;let f=-1;u!==0&&(f=c/u);let d,p;f<0?(d=e,p=i):f>1?(d=r,p=n):(d=e+f*h,p=i+f*l);const y=s-d,g=t-p;return y*y+g*g}let ql,Kl;class De{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const i=[];for(let r=0,n=e.length;r<n;r++)i.push(e[r].x,e[r].y);e=i}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,i=e.length;for(let r=0;r<i;r+=2){const n=e[r],o=e[r+1],a=e[(r+2)%i],h=e[(r+3)%i];t+=(a-n)*(h+o)}return t<0}containsPolygon(t){const e=this.getBounds(ql),i=t.getBounds(Kl);if(!e.containsRect(i))return!1;const r=t.points;for(let n=0;n<r.length;n+=2){const o=r[n],a=r[n+1];if(!this.contains(o,a))return!1}return!0}clone(){const t=this.points.slice(),e=new De(t);return e.closePath=this.closePath,e}contains(t,e){let i=!1;const r=this.points.length/2;for(let n=0,o=r-1;n<r;o=n++){const a=this.points[n*2],h=this.points[n*2+1],l=this.points[o*2],c=this.points[o*2+1];h>e!=c>e&&t<(l-a)*((e-h)/(c-h))+a&&(i=!i)}return i}strokeContains(t,e,i,r=.5){const n=i*i,o=n*(1-r),a=n-o,{points:h}=this,l=h.length-(this.closePath?0:2);for(let c=0;c<l;c+=2){const u=h[c],f=h[c+1],d=h[(c+2)%h.length],p=h[(c+3)%h.length],y=Xl(t,e,u,f,d,p),g=Math.sign((d-u)*(e-f)-(p-f)*(t-u));if(y<=(g<0?a:o))return!0}return!1}getBounds(t){t||(t=new j);const e=this.points;let i=1/0,r=-1/0,n=1/0,o=-1/0;for(let a=0,h=e.length;a<h;a+=2){const l=e[a],c=e[a+1];i=l<i?l:i,r=l>r?l:r,n=c<n?c:n,o=c>o?c:o}return t.x=i,t.width=r-i,t.y=n,t.height=o-n,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return B("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return B("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const ps=(s,t,e,i,r,n,o)=>{const a=s-e,h=t-i,l=Math.sqrt(a*a+h*h);return l>=r-n&&l<=r+o};class qi{constructor(t=0,e=0,i=0,r=0,n=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=i,this.height=r,this.radius=n}getBounds(t){return t||(t=new j),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new qi(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let r=t-(this.x+i),n=e-(this.y+i);const o=i*i;if(r*r+n*n<=o||(r=t-(this.x+this.width-i),r*r+n*n<=o)||(n=e-(this.y+this.height-i),r*r+n*n<=o)||(r=t-(this.x+i),r*r+n*n<=o))return!0}return!1}strokeContains(t,e,i,r=.5){const{x:n,y:o,width:a,height:h,radius:l}=this,c=i*(1-r),u=i-c,f=n+l,d=o+l,p=a-l*2,y=h-l*2,g=n+a,x=o+h;return(t>=n-c&&t<=n+u||t>=g-u&&t<=g+c)&&e>=d&&e<=d+y||(e>=o-c&&e<=o+u||e>=x-u&&e<=x+c)&&t>=f&&t<=f+p?!0:t<f&&e<d&&ps(t,e,f,d,l,u,c)||t>g-l&&e<d&&ps(t,e,g-l,d,l,u,c)||t>g-l&&e>x-l&&ps(t,e,g-l,x-l,l,u,c)||t<f&&e>x-l&&ps(t,e,f,x-l,l,u,c)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const Uo={};function Zl(s,t,e){let i=2166136261;for(let r=0;r<t;r++)i^=s[r].uid,i=Math.imul(i,16777619),i>>>=0;return Uo[i]||Ql(s,t,i,e)}function Ql(s,t,e,i){const r={};let n=0;for(let a=0;a<i;a++){const h=a<t?s[a]:G.EMPTY.source;r[n++]=h.source,r[n++]=h.style}const o=new _s(r);return Uo[e]=o,o}class $r{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this.uint32View=null,this.float32View=null,this.uint16View=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._int32View=null,this._float64Array=null,this._bigUint64Array=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function Ur(s,t){const e=s.byteLength/8|0,i=new Float64Array(s,0,e);new Float64Array(t,0,e).set(i);const n=s.byteLength-e*8;if(n>0){const o=new Uint8Array(s,e*8,n);new Uint8Array(t,e*8,n).set(o)}}const Jl={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var tc=(s=>(s[s.DISABLED=0]="DISABLED",s[s.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",s[s.MASK_ACTIVE=2]="MASK_ACTIVE",s[s.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",s[s.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",s[s.NONE=5]="NONE",s))(tc||{});function Hr(s,t){return t.alphaMode==="no-premultiply-alpha"&&Jl[s]||s}const ec=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function sc(s){let t="";for(let e=0;e<s;++e)e>0&&(t+=`
else `),e<s-1&&(t+=`if(test == ${e}.0){}`);return t}function ic(s,t){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);try{for(;;){const i=ec.replace(/%forloop%/gi,sc(s));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))s=s/2|0;else break}}finally{t.deleteShader(e)}return s}let Jt=null;function rc(){if(Jt)return Jt;const s=Ao();return Jt=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),Jt=ic(Jt,s),s.getExtension("WEBGL_lose_context")?.loseContext(),Jt}class nc{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class oc{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new nc,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const ze=[];let Ms=0;Qe.register({clear:()=>{if(ze.length>0)for(const s of ze)s&&s.destroy();ze.length=0,Ms=0}});function Vr(){return Ms>0?ze[--Ms]:new oc}function jr(s){ze[Ms++]=s}let Ce=0;const Ho=class Vo{constructor(t){this.uid=K("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t={...Vo.defaultOptions,...t},t.maxTextures||(B("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),t.maxTextures=rc());const{maxTextures:e,attributesInitialSize:i,indicesInitialSize:r}=t;this.attributeBuffer=new $r(i*4),this.indexBuffer=new Uint16Array(r),this.maxTextures=e}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)jr(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const i=t._batch.textures.ids[e._source.uid];return!i&&i!==0?!1:(t._textureId=i,t.texture=e,!0)}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let i=Vr(),r=i.textures;r.clear();const n=e[this.elementStart];let o=Hr(n.blendMode,n.texture._source),a=n.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const h=this.attributeBuffer.float32View,l=this.attributeBuffer.uint32View,c=this.indexBuffer;let u=this._batchIndexSize,f=this._batchIndexStart,d="startBatch";const p=this.maxTextures;for(let y=this.elementStart;y<this.elementSize;++y){const g=e[y];e[y]=null;const _=g.texture._source,m=Hr(g.blendMode,_),w=o!==m||a!==g.topology;if(_._batchTick===Ce&&!w){g._textureId=_._textureBindLocation,u+=g.indexSize,g.packAsQuad?(this.packQuadAttributes(g,h,l,g._attributeStart,g._textureId),this.packQuadIndex(c,g._indexStart,g._attributeStart/this.vertexSize)):(this.packAttributes(g,h,l,g._attributeStart,g._textureId),this.packIndex(g,c,g._indexStart,g._attributeStart/this.vertexSize)),g._batch=i;continue}_._batchTick=Ce,(r.count>=p||w)&&(this._finishBatch(i,f,u-f,r,o,a,t,d),d="renderBatch",f=u,o=m,a=g.topology,i=Vr(),r=i.textures,r.clear(),++Ce),g._textureId=_._textureBindLocation=r.count,r.ids[_.uid]=r.count,r.textures[r.count++]=_,g._batch=i,u+=g.indexSize,g.packAsQuad?(this.packQuadAttributes(g,h,l,g._attributeStart,g._textureId),this.packQuadIndex(c,g._indexStart,g._attributeStart/this.vertexSize)):(this.packAttributes(g,h,l,g._attributeStart,g._textureId),this.packIndex(g,c,g._indexStart,g._attributeStart/this.vertexSize))}r.count>0&&(this._finishBatch(i,f,u-f,r,o,a,t,d),f=u,++Ce),this.elementStart=this.elementSize,this._batchIndexStart=f,this._batchIndexSize=u}_finishBatch(t,e,i,r,n,o,a,h){t.gpuBindGroup=null,t.bindGroup=null,t.action=h,t.batcher=this,t.textures=r,t.blendMode=n,t.topology=o,t.start=e,t.size=i,++Ce,this.batches[this.batchIndex++]=t,a.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){t*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(t*4)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,this.attributeBuffer.size*2),i=new $r(e);Ur(this.attributeBuffer.rawBinaryData,i.rawBinaryData),this.attributeBuffer=i}_resizeIndexBuffer(t){const e=this.indexBuffer;let i=Math.max(t,e.length*1.5);i+=i%2;const r=i>65535?new Uint32Array(i):new Uint16Array(i);if(r.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let n=0;n<e.length;n++)r[n]=e[n];else Ur(e.buffer,r.buffer);this.indexBuffer=r}packQuadIndex(t,e,i){t[e]=i+0,t[e+1]=i+1,t[e+2]=i+2,t[e+3]=i+0,t[e+4]=i+2,t[e+5]=i+3}packIndex(t,e,i,r){const n=t.indices,o=t.indexSize,a=t.indexOffset,h=t.attributeOffset;for(let l=0;l<o;l++)e[i++]=r+n[l+a]-h}destroy(t={}){if(this.batches!==null){for(let e=0;e<this.batches.length;e++)jr(this.batches[e]);this.batches=null,this.geometry.destroy(!0),this.geometry=null,t.shader&&(this.shader?.destroy(),this.shader=null);for(let e=0;e<this._elements.length;e++)this._elements[e]&&(this._elements[e]._batch=null);this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}};Ho.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let ac=Ho;var nt=(s=>(s[s.MAP_READ=1]="MAP_READ",s[s.MAP_WRITE=2]="MAP_WRITE",s[s.COPY_SRC=4]="COPY_SRC",s[s.COPY_DST=8]="COPY_DST",s[s.INDEX=16]="INDEX",s[s.VERTEX=32]="VERTEX",s[s.UNIFORM=64]="UNIFORM",s[s.STORAGE=128]="STORAGE",s[s.INDIRECT=256]="INDIRECT",s[s.QUERY_RESOLVE=512]="QUERY_RESOLVE",s[s.STATIC=1024]="STATIC",s))(nt||{});class Ve extends _t{constructor(t){let{data:e,size:i}=t;const{usage:r,label:n,shrinkToFit:o}=t;super(),this.uid=K("buffer"),this._resourceType="buffer",this._resourceId=K("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,i??(i=e?.byteLength);const a=!!e;this.descriptor={size:i,usage:r,mappedAtCreation:a,label:n},this.shrinkToFit=o??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&nt.STATIC)}set static(t){t?this.descriptor.usage|=nt.STATIC:this.descriptor.usage&=~nt.STATIC}setDataWithSize(t,e,i){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t){i&&this.emit("update",this);return}const r=this._data;if(this._data=t,this._dataInt32=null,!r||r.length!==t.length){!this.shrinkToFit&&r&&t.byteLength<r.byteLength?i&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=K("resource"),this.emit("change",this));return}i&&this.emit("update",this)}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function jo(s,t){if(!(s instanceof Ve)){let e=t?nt.INDEX:nt.VERTEX;s instanceof Array&&(t?(s=new Uint32Array(s),e=nt.INDEX|nt.COPY_DST):(s=new Float32Array(s),e=nt.VERTEX|nt.COPY_DST)),s=new Ve({data:s,label:t?"index-mesh-buffer":"vertex-mesh-buffer",usage:e})}return s}function hc(s,t,e){const i=s.getAttribute(t);if(!i)return e.minX=0,e.minY=0,e.maxX=0,e.maxY=0,e;const r=i.buffer.data;let n=1/0,o=1/0,a=-1/0,h=-1/0;const l=r.BYTES_PER_ELEMENT,c=(i.offset||0)/l,u=(i.stride||8)/l;for(let f=c;f<r.length;f+=u){const d=r[f],p=r[f+1];d>a&&(a=d),p>h&&(h=p),d<n&&(n=d),p<o&&(o=p)}return e.minX=n,e.minY=o,e.maxX=a,e.maxY=h,e}function lc(s){return(s instanceof Ve||Array.isArray(s)||s.BYTES_PER_ELEMENT)&&(s={buffer:s}),s.buffer=jo(s.buffer,!1),s}class cc extends _t{constructor(t={}){super(),this.uid=K("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new xt,this._boundsDirty=!0;const{attributes:e,indexBuffer:i,topology:r}=t;if(this.buffers=[],this.attributes={},e)for(const n in e)this.addAttribute(n,e[n]);this.instanceCount=t.instanceCount??1,i&&this.addIndex(i),this.topology=r||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const i=lc(e);this.buffers.indexOf(i.buffer)===-1&&(this.buffers.push(i.buffer),i.buffer.on("update",this.onBufferUpdate,this),i.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=i}addIndex(t){this.indexBuffer=jo(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,hc(this,"aPosition",this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(e=>e.destroy()),this.indexBuffer?.destroy(),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const uc=new Float32Array(1),dc=new Uint32Array(1);class fc extends cc{constructor(){const e=new Ve({data:uc,label:"attribute-batch-buffer",usage:nt.VERTEX|nt.COPY_DST,shrinkToFit:!1}),i=new Ve({data:dc,label:"index-batch-buffer",usage:nt.INDEX|nt.COPY_DST,shrinkToFit:!1}),r=24;super({attributes:{aPosition:{buffer:e,format:"float32x2",stride:r,offset:0},aUV:{buffer:e,format:"float32x2",stride:r,offset:8},aColor:{buffer:e,format:"unorm8x4",stride:r,offset:16},aTextureIdAndRound:{buffer:e,format:"uint16x2",stride:r,offset:20}},indexBuffer:i})}}function Yr(s,t,e){if(s)for(const i in s){const r=i.toLocaleLowerCase(),n=t[r];if(n){let o=s[i];i==="header"&&(o=o.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),e&&n.push(`//----${e}----//`),n.push(o)}else U(`${i} placement hook does not exist in shader`)}}const pc=/\{\{(.*?)\}\}/g;function Xr(s){const t={};return(s.match(pc)?.map(i=>i.replace(/[{()}]/g,""))??[]).forEach(i=>{t[i]=[]}),t}function qr(s,t){let e;const i=/@in\s+([^;]+);/g;for(;(e=i.exec(s))!==null;)t.push(e[1])}function Kr(s,t,e=!1){const i=[];qr(t,i),s.forEach(a=>{a.header&&qr(a.header,i)});const r=i;e&&r.sort();const n=r.map((a,h)=>`       @location(${h}) ${a},`).join(`
`);let o=t.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`
${n}
`),o}function Zr(s,t){let e;const i=/@out\s+([^;]+);/g;for(;(e=i.exec(s))!==null;)t.push(e[1])}function gc(s){const e=/\b(\w+)\s*:/g.exec(s);return e?e[1]:""}function mc(s){const t=/@.*?\s+/g;return s.replace(t,"")}function yc(s,t){const e=[];Zr(t,e),s.forEach(h=>{h.header&&Zr(h.header,e)});let i=0;const r=e.sort().map(h=>h.indexOf("builtin")>-1?h:`@location(${i++}) ${h}`).join(`,
`),n=e.sort().map(h=>`       var ${mc(h)};`).join(`
`),o=`return VSOutput(
            ${e.sort().map(h=>` ${gc(h)}`).join(`,
`)});`;let a=t.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`
${r}
`),a=a.replace("{{start}}",`
${n}
`),a=a.replace("{{return}}",`
${o}
`),a}function Qr(s,t){let e=s;for(const i in t){const r=t[i];r.join(`
`).length?e=e.replace(`{{${i}}}`,`//-----${i} START-----//
${r.join(`
`)}
//----${i} FINISH----//`):e=e.replace(`{{${i}}}`,"")}return e}const Lt=Object.create(null),oi=new Map;let xc=0;function _c({template:s,bits:t}){const e=Yo(s,t);if(Lt[e])return Lt[e];const{vertex:i,fragment:r}=bc(s,t);return Lt[e]=Xo(i,r,t),Lt[e]}function wc({template:s,bits:t}){const e=Yo(s,t);return Lt[e]||(Lt[e]=Xo(s.vertex,s.fragment,t)),Lt[e]}function bc(s,t){const e=t.map(o=>o.vertex).filter(o=>!!o),i=t.map(o=>o.fragment).filter(o=>!!o);let r=Kr(e,s.vertex,!0);r=yc(e,r);const n=Kr(i,s.fragment,!0);return{vertex:r,fragment:n}}function Yo(s,t){return t.map(e=>(oi.has(e)||oi.set(e,xc++),oi.get(e))).sort((e,i)=>e-i).join("-")+s.vertex+s.fragment}function Xo(s,t,e){const i=Xr(s),r=Xr(t);return e.forEach(n=>{Yr(n.vertex,i,n.name),Yr(n.fragment,r,n.name)}),{vertex:Qr(s,i),fragment:Qr(t,r)}}const Ac=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,vc=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,Sc=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,Cc=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,Pc={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},Tc={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function kc({bits:s,name:t}){const e=_c({template:{fragment:vc,vertex:Ac},bits:[Pc,...s]});return Os.from({name:t,vertex:{source:e.vertex,entryPoint:"main"},fragment:{source:e.fragment,entryPoint:"main"}})}function Mc({bits:s,name:t}){return new So({name:t,...wc({template:{vertex:Sc,fragment:Cc},bits:[Tc,...s]})})}const Ec={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},Ic={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},ai={};function Rc(s){const t=[];if(s===1)t.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),t.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let e=0;for(let i=0;i<s;i++)t.push(`@group(1) @binding(${e++}) var textureSource${i+1}: texture_2d<f32>;`),t.push(`@group(1) @binding(${e++}) var textureSampler${i+1}: sampler;`)}return t.join(`
`)}function Bc(s){const t=[];if(s===1)t.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{t.push("switch vTextureId {");for(let e=0;e<s;e++)e===s-1?t.push("  default:{"):t.push(`  case ${e}:{`),t.push(`      outColor = textureSampleGrad(textureSource${e+1}, textureSampler${e+1}, vUV, uvDx, uvDy);`),t.push("      break;}");t.push("}")}return t.join(`
`)}function Fc(s){return ai[s]||(ai[s]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${Rc(s)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${Bc(s)}
            `}}),ai[s]}const hi={};function Lc(s){const t=[];for(let e=0;e<s;e++)e>0&&t.push("else"),e<s-1&&t.push(`if(vTextureId < ${e}.5)`),t.push("{"),t.push(`	outColor = texture(uTextures[${e}], vUV);`),t.push("}");return t.join(`
`)}function Gc(s){return hi[s]||(hi[s]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${s}];

            `,main:`

                ${Lc(s)}
            `}}),hi[s]}const Oc={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},Dc={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},Jr={};function zc(s){let t=Jr[s];if(t)return t;const e=new Int32Array(s);for(let i=0;i<s;i++)e[i]=i;return t=Jr[s]=new ko({uTextures:{value:e,type:"i32",size:s}},{isStatic:!0}),t}class tn extends Vi{constructor(t){const e=Mc({name:"batch",bits:[Ic,Gc(t),Dc]}),i=kc({name:"batch",bits:[Ec,Fc(t),Oc]});super({glProgram:e,gpuProgram:i,resources:{batchSamplers:zc(t)}}),this.maxTextures=t}}let Pe=null;const qo=class Ko extends ac{constructor(t){super(t),this.geometry=new fc,this.name=Ko.extension.name,this.vertexSize=6,Pe??(Pe=new tn(t.maxTextures)),this.shader=Pe}packAttributes(t,e,i,r,n){const o=n<<16|t.roundPixels&65535,a=t.transform,h=a.a,l=a.b,c=a.c,u=a.d,f=a.tx,d=a.ty,{positions:p,uvs:y}=t,g=t.color,x=t.attributeOffset,_=x+t.attributeSize;for(let m=x;m<_;m++){const w=m*2,v=p[w],b=p[w+1];e[r++]=h*v+c*b+f,e[r++]=u*b+l*v+d,e[r++]=y[w],e[r++]=y[w+1],i[r++]=g,i[r++]=o}}packQuadAttributes(t,e,i,r,n){const o=t.texture,a=t.transform,h=a.a,l=a.b,c=a.c,u=a.d,f=a.tx,d=a.ty,p=t.bounds,y=p.maxX,g=p.minX,x=p.maxY,_=p.minY,m=o.uvs,w=t.color,v=n<<16|t.roundPixels&65535;e[r+0]=h*g+c*_+f,e[r+1]=u*_+l*g+d,e[r+2]=m.x0,e[r+3]=m.y0,i[r+4]=w,i[r+5]=v,e[r+6]=h*y+c*_+f,e[r+7]=u*_+l*y+d,e[r+8]=m.x1,e[r+9]=m.y1,i[r+10]=w,i[r+11]=v,e[r+12]=h*y+c*x+f,e[r+13]=u*x+l*y+d,e[r+14]=m.x2,e[r+15]=m.y2,i[r+16]=w,i[r+17]=v,e[r+18]=h*g+c*x+f,e[r+19]=u*x+l*g+d,e[r+20]=m.x3,e[r+21]=m.y3,i[r+22]=w,i[r+23]=v}_updateMaxTextures(t){this.shader.maxTextures!==t&&(Pe=new tn(t),this.shader=Pe)}destroy(){this.shader=null,super.destroy()}};qo.extension={type:[R.Batcher],name:"default"};let Wc=qo;function Nc(s,t,e,i,r,n,o,a=null){let h=0;e*=t,r*=n;const l=a.a,c=a.b,u=a.c,f=a.d,d=a.tx,p=a.ty;for(;h<o;){const y=s[e],g=s[e+1];i[r]=l*y+u*g+d,i[r+1]=c*y+f*g+p,r+=n,e+=t,h++}}function $c(s,t,e,i){let r=0;for(t*=e;r<i;)s[t]=0,s[t+1]=0,t+=e,r++}function Zo(s,t,e,i,r){const n=t.a,o=t.b,a=t.c,h=t.d,l=t.tx,c=t.ty;e||(e=0),i||(i=2),r||(r=s.length/i-e);let u=e*i;for(let f=0;f<r;f++){const d=s[u],p=s[u+1];s[u]=n*d+a*p+l,s[u+1]=o*d+h*p+c,u+=i}}const Uc=new F;class Qo{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|t&65280|(t&255)<<16,i=this.renderable;return i?eo(e,i.groupColor)+(this.alpha*i.groupAlpha*255<<24):e+(this.alpha*255<<24)}get transform(){return this.renderable?.groupTransform||Uc}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const je={extension:{type:R.ShapeBuilder,name:"circle"},build(s,t){let e,i,r,n,o,a;if(s.type==="circle"){const w=s;if(o=a=w.radius,o<=0)return!1;e=w.x,i=w.y,r=n=0}else if(s.type==="ellipse"){const w=s;if(o=w.halfWidth,a=w.halfHeight,o<=0||a<=0)return!1;e=w.x,i=w.y,r=n=0}else{const w=s,v=w.width/2,b=w.height/2;e=w.x+v,i=w.y+b,o=a=Math.max(0,Math.min(w.radius,Math.min(v,b))),r=v-o,n=b-a}if(r<0||n<0)return!1;const h=Math.ceil(2.3*Math.sqrt(o+a)),l=h*8+(r?4:0)+(n?4:0);if(l===0)return!1;if(h===0)return t[0]=t[6]=e+r,t[1]=t[3]=i+n,t[2]=t[4]=e-r,t[5]=t[7]=i-n,!0;let c=0,u=h*4+(r?2:0)+2,f=u,d=l,p=r+o,y=n,g=e+p,x=e-p,_=i+y;if(t[c++]=g,t[c++]=_,t[--u]=_,t[--u]=x,n){const w=i-y;t[f++]=x,t[f++]=w,t[--d]=w,t[--d]=g}for(let w=1;w<h;w++){const v=Math.PI/2*(w/h),b=r+Math.cos(v)*o,A=n+Math.sin(v)*a,I=e+b,C=e-b,P=i+A,k=i-A;t[c++]=I,t[c++]=P,t[--u]=P,t[--u]=C,t[f++]=C,t[f++]=k,t[--d]=k,t[--d]=I}p=r,y=n+a,g=e+p,x=e-p,_=i+y;const m=i-y;return t[c++]=g,t[c++]=_,t[--d]=m,t[--d]=g,r&&(t[c++]=x,t[c++]=_,t[--d]=m,t[--d]=x),!0},triangulate(s,t,e,i,r,n){if(s.length===0)return;let o=0,a=0;for(let c=0;c<s.length;c+=2)o+=s[c],a+=s[c+1];o/=s.length/2,a/=s.length/2;let h=i;t[h*e]=o,t[h*e+1]=a;const l=h++;for(let c=0;c<s.length;c+=2)t[h*e]=s[c],t[h*e+1]=s[c+1],c>0&&(r[n++]=h,r[n++]=l,r[n++]=h-1),h++;r[n++]=l+1,r[n++]=l,r[n++]=h-1}},Hc={...je,extension:{...je.extension,name:"ellipse"}},Vc={...je,extension:{...je.extension,name:"roundedRectangle"}},Jo=1e-4,en=1e-4;function jc(s){const t=s.length;if(t<6)return 1;let e=0;for(let i=0,r=s[t-2],n=s[t-1];i<t;i+=2){const o=s[i],a=s[i+1];e+=(o-r)*(a+n),r=o,n=a}return e<0?-1:1}function sn(s,t,e,i,r,n,o,a){const h=s-e*r,l=t-i*r,c=s+e*n,u=t+i*n;let f,d;o?(f=i,d=-e):(f=-i,d=e);const p=h+f,y=l+d,g=c+f,x=u+d;return a.push(p,y),a.push(g,x),2}function $t(s,t,e,i,r,n,o,a){const h=e-s,l=i-t;let c=Math.atan2(h,l),u=Math.atan2(r-s,n-t);a&&c<u?c+=Math.PI*2:!a&&c>u&&(u+=Math.PI*2);let f=c;const d=u-c,p=Math.abs(d),y=Math.sqrt(h*h+l*l),g=(15*p*Math.sqrt(y)/Math.PI>>0)+1,x=d/g;if(f+=x,a){o.push(s,t),o.push(e,i);for(let _=1,m=f;_<g;_++,m+=x)o.push(s,t),o.push(s+Math.sin(m)*y,t+Math.cos(m)*y);o.push(s,t),o.push(r,n)}else{o.push(e,i),o.push(s,t);for(let _=1,m=f;_<g;_++,m+=x)o.push(s+Math.sin(m)*y,t+Math.cos(m)*y),o.push(s,t);o.push(r,n),o.push(s,t)}return g*2}function Yc(s,t,e,i,r,n){const o=Jo;if(s.length===0)return;const a=t;let h=a.alignment;if(t.alignment!==.5){let L=jc(s);h=(h-.5)*L+.5}const l=new et(s[0],s[1]),c=new et(s[s.length-2],s[s.length-1]),u=i,f=Math.abs(l.x-c.x)<o&&Math.abs(l.y-c.y)<o;if(u){s=s.slice(),f&&(s.pop(),s.pop(),c.set(s[s.length-2],s[s.length-1]));const L=(l.x+c.x)*.5,Ft=(c.y+l.y)*.5;s.unshift(L,Ft),s.push(L,Ft)}const d=r,p=s.length/2;let y=s.length;const g=d.length/2,x=a.width/2,_=x*x,m=a.miterLimit*a.miterLimit;let w=s[0],v=s[1],b=s[2],A=s[3],I=0,C=0,P=-(v-A),k=w-b,z=0,O=0,H=Math.sqrt(P*P+k*k);P/=H,k/=H,P*=x,k*=x;const S=h,T=(1-S)*2,E=S*2;u||(a.cap==="round"?y+=$t(w-P*(T-E)*.5,v-k*(T-E)*.5,w-P*T,v-k*T,w+P*E,v+k*E,d,!0)+2:a.cap==="square"&&(y+=sn(w,v,P,k,T,E,!0,d))),d.push(w-P*T,v-k*T),d.push(w+P*E,v+k*E);for(let L=1;L<p-1;++L){w=s[(L-1)*2],v=s[(L-1)*2+1],b=s[L*2],A=s[L*2+1],I=s[(L+1)*2],C=s[(L+1)*2+1],P=-(v-A),k=w-b,H=Math.sqrt(P*P+k*k),P/=H,k/=H,P*=x,k*=x,z=-(A-C),O=b-I,H=Math.sqrt(z*z+O*O),z/=H,O/=H,z*=x,O*=x;const Ft=b-w,ye=v-A,xe=b-I,_e=C-A,ir=Ft*xe+ye*_e,Je=ye*xe-_e*Ft,we=Je<0;if(Math.abs(Je)<.001*Math.abs(ir)){d.push(b-P*T,A-k*T),d.push(b+P*E,A+k*E),ir>=0&&(a.join==="round"?y+=$t(b,A,b-P*T,A-k*T,b-z*T,A-O*T,d,!1)+4:y+=2,d.push(b-z*E,A-O*E),d.push(b+z*T,A+O*T));continue}const rr=(-P+w)*(-k+A)-(-P+b)*(-k+v),nr=(-z+I)*(-O+A)-(-z+b)*(-O+C),ts=(Ft*nr-xe*rr)/Je,es=(_e*rr-ye*nr)/Je,Ns=(ts-b)*(ts-b)+(es-A)*(es-A),Dt=b+(ts-b)*T,zt=A+(es-A)*T,Wt=b-(ts-b)*E,Nt=A-(es-A)*E,Aa=Math.min(Ft*Ft+ye*ye,xe*xe+_e*_e),or=we?T:E,va=Aa+or*or*_;Ns<=va?a.join==="bevel"||Ns/_>m?(we?(d.push(Dt,zt),d.push(b+P*E,A+k*E),d.push(Dt,zt),d.push(b+z*E,A+O*E)):(d.push(b-P*T,A-k*T),d.push(Wt,Nt),d.push(b-z*T,A-O*T),d.push(Wt,Nt)),y+=2):a.join==="round"?we?(d.push(Dt,zt),d.push(b+P*E,A+k*E),y+=$t(b,A,b+P*E,A+k*E,b+z*E,A+O*E,d,!0)+4,d.push(Dt,zt),d.push(b+z*E,A+O*E)):(d.push(b-P*T,A-k*T),d.push(Wt,Nt),y+=$t(b,A,b-P*T,A-k*T,b-z*T,A-O*T,d,!1)+4,d.push(b-z*T,A-O*T),d.push(Wt,Nt)):(d.push(Dt,zt),d.push(Wt,Nt)):(d.push(b-P*T,A-k*T),d.push(b+P*E,A+k*E),a.join==="round"?we?y+=$t(b,A,b+P*E,A+k*E,b+z*E,A+O*E,d,!0)+2:y+=$t(b,A,b-P*T,A-k*T,b-z*T,A-O*T,d,!1)+2:a.join==="miter"&&Ns/_<=m&&(we?(d.push(Wt,Nt),d.push(Wt,Nt)):(d.push(Dt,zt),d.push(Dt,zt)),y+=2),d.push(b-z*T,A-O*T),d.push(b+z*E,A+O*E),y+=2)}w=s[(p-2)*2],v=s[(p-2)*2+1],b=s[(p-1)*2],A=s[(p-1)*2+1],P=-(v-A),k=w-b,H=Math.sqrt(P*P+k*k),P/=H,k/=H,P*=x,k*=x,d.push(b-P*T,A-k*T),d.push(b+P*E,A+k*E),u||(a.cap==="round"?y+=$t(b-P*(T-E)*.5,A-k*(T-E)*.5,b-P*T,A-k*T,b+P*E,A+k*E,d,!1)+2:a.cap==="square"&&(y+=sn(b,A,P,k,T,E,!1,d)));const at=en*en;for(let L=g;L<y+g-2;++L)w=d[L*2],v=d[L*2+1],b=d[(L+1)*2],A=d[(L+1)*2+1],I=d[(L+2)*2],C=d[(L+2)*2+1],!(Math.abs(w*(A-C)+b*(C-v)+I*(v-A))<at)&&n.push(L,L+1,L+2)}function Xc(s,t,e,i){const r=Jo;if(s.length===0)return;const n=s[0],o=s[1],a=s[s.length-2],h=s[s.length-1],l=t||Math.abs(n-a)<r&&Math.abs(o-h)<r,c=e,u=s.length/2,f=c.length/2;for(let d=0;d<u;d++)c.push(s[d*2]),c.push(s[d*2+1]);for(let d=0;d<u-1;d++)i.push(f+d,f+d+1);l&&i.push(f+u-1,f)}function ta(s,t,e,i,r,n,o){const a=Fl(s,t,2);if(!a)return;for(let l=0;l<a.length;l+=3)n[o++]=a[l]+r,n[o++]=a[l+1]+r,n[o++]=a[l+2]+r;let h=r*i;for(let l=0;l<s.length;l+=2)e[h]=s[l],e[h+1]=s[l+1],h+=i}const qc=[],Kc={extension:{type:R.ShapeBuilder,name:"polygon"},build(s,t){for(let e=0;e<s.points.length;e++)t[e]=s.points[e];return!0},triangulate(s,t,e,i,r,n){ta(s,qc,t,e,i,r,n)}},Zc={extension:{type:R.ShapeBuilder,name:"rectangle"},build(s,t){const e=s,i=e.x,r=e.y,n=e.width,o=e.height;return n>0&&o>0?(t[0]=i,t[1]=r,t[2]=i+n,t[3]=r,t[4]=i+n,t[5]=r+o,t[6]=i,t[7]=r+o,!0):!1},triangulate(s,t,e,i,r,n){let o=0;i*=e,t[i+o]=s[0],t[i+o+1]=s[1],o+=e,t[i+o]=s[2],t[i+o+1]=s[3],o+=e,t[i+o]=s[6],t[i+o+1]=s[7],o+=e,t[i+o]=s[4],t[i+o+1]=s[5],o+=e;const a=i/e;r[n++]=a,r[n++]=a+1,r[n++]=a+2,r[n++]=a+1,r[n++]=a+3,r[n++]=a+2}},Qc={extension:{type:R.ShapeBuilder,name:"triangle"},build(s,t){return t[0]=s.x,t[1]=s.y,t[2]=s.x2,t[3]=s.y2,t[4]=s.x3,t[5]=s.y3,!0},triangulate(s,t,e,i,r,n){let o=0;i*=e,t[i+o]=s[0],t[i+o+1]=s[1],o+=e,t[i+o]=s[2],t[i+o+1]=s[3],o+=e,t[i+o]=s[4],t[i+o+1]=s[5];const a=i/e;r[n++]=a,r[n++]=a+1,r[n++]=a+2}},Jc=new F,tu=new j;function eu(s,t,e,i){const r=t.matrix?s.copyFrom(t.matrix).invert():s.identity();if(t.textureSpace==="local"){const o=e.getBounds(tu);t.width&&o.pad(t.width);const{x:a,y:h}=o,l=1/o.width,c=1/o.height,u=-a*l,f=-h*c,d=r.a,p=r.b,y=r.c,g=r.d;r.a*=l,r.b*=l,r.c*=c,r.d*=c,r.tx=u*d+f*y+r.tx,r.ty=u*p+f*g+r.ty}else r.translate(t.texture.frame.x,t.texture.frame.y),r.scale(1/t.texture.source.width,1/t.texture.source.height);const n=t.texture.source.style;return!(t.fill instanceof Bt)&&n.addressMode==="clamp-to-edge"&&(n.addressMode="repeat",n.update()),i&&r.append(Jc.copyFrom(i).invert()),r}const zs={};tt.handleByMap(R.ShapeBuilder,zs);tt.add(Zc,Kc,Qc,je,Hc,Vc);const su=new j,iu=new F;function ru(s,t){const{geometryData:e,batches:i}=t;i.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let r=0;r<s.instructions.length;r++){const n=s.instructions[r];if(n.action==="texture")nu(n.data,i,e);else if(n.action==="fill"||n.action==="stroke"){const o=n.action==="stroke",a=n.data.path.shapePath,h=n.data.style,l=n.data.hole;o&&l&&rn(l.shapePath,h,!0,i,e),l&&(a.shapePrimitives[a.shapePrimitives.length-1].holes=l.shapePath.shapePrimitives),rn(a,h,o,i,e)}}}function nu(s,t,e){const i=[],r=zs.rectangle,n=su;n.x=s.dx,n.y=s.dy,n.width=s.dw,n.height=s.dh;const o=s.transform;if(!r.build(n,i))return;const{vertices:a,uvs:h,indices:l}=e,c=l.length,u=a.length/2;o&&Zo(i,o),r.triangulate(i,a,2,u,l,c);const f=s.image,d=f.uvs;h.push(d.x0,d.y0,d.x1,d.y1,d.x3,d.y3,d.x2,d.y2);const p=pt.get(Qo);p.indexOffset=c,p.indexSize=l.length-c,p.attributeOffset=u,p.attributeSize=a.length/2-u,p.baseColor=s.style,p.alpha=s.alpha,p.texture=f,p.geometryData=e,t.push(p)}function rn(s,t,e,i,r){const{vertices:n,uvs:o,indices:a}=r;s.shapePrimitives.forEach(({shape:h,transform:l,holes:c})=>{const u=[],f=zs[h.type];if(!f.build(h,u))return;const d=a.length,p=n.length/2;let y="triangle-list";if(l&&Zo(u,l),e){const m=h.closePath??!0,w=t;w.pixelLine?(Xc(u,m,n,a),y="line-list"):Yc(u,w,!1,m,n,a)}else if(c){const m=[],w=u.slice();ou(c).forEach(b=>{m.push(w.length/2),w.push(...b)}),ta(w,m,n,2,p,a,d)}else f.triangulate(u,n,2,p,a,d);const g=o.length/2,x=t.texture;if(x!==G.WHITE){const m=eu(iu,t,h,l);Nc(n,2,p,o,g,2,n.length/2-p,m)}else $c(o,g,2,n.length/2-p);const _=pt.get(Qo);_.indexOffset=d,_.indexSize=a.length-d,_.attributeOffset=p,_.attributeSize=n.length/2-p,_.baseColor=t.color,_.alpha=t.alpha,_.texture=x,_.geometryData=r,_.topology=y,i.push(_)})}function ou(s){const t=[];for(let e=0;e<s.length;e++){const i=s[e].shape,r=[];zs[i.type].build(i,r)&&t.push(r)}return t}class au{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class hu{constructor(){this.instructions=new no}init(t){const e=t.maxTextures;this.batcher?this.batcher._updateMaxTextures(e):this.batcher=new Wc({maxTextures:e}),this.instructions.reset()}get geometry(){return B(nh,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const Ki=class Li{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(t){Li.defaultOptions.bezierSmoothness=t?.bezierSmoothness??Li.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),ru(t,e);const i=t.batchMode;t.customShader||i==="no-batch"?e.isBatchable=!1:i==="auto"?e.isBatchable=e.geometryData.vertices.length<400:e.isBatchable=!0,t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=pt.get(hu,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:i,geometryData:r}=this._gpuContextHash[t.uid],n=r.vertices.length,o=r.indices.length;for(let c=0;c<i.length;c++)i[c].applyTransform=!1;const a=e.batcher;a.ensureAttributeBuffer(n),a.ensureIndexBuffer(o),a.begin();for(let c=0;c<i.length;c++){const u=i[c];a.add(u)}a.finish(e.instructions);const h=a.geometry;h.indexBuffer.setDataWithSize(a.indexBuffer,a.indexSize,!0),h.buffers[0].setDataWithSize(a.attributeBuffer.float32View,a.attributeSize,!0);const l=a.batches;for(let c=0;c<l.length;c++){const u=l[c];u.bindGroup=Zl(u.textures.textures,u.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new au;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(pt.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(i=>{pt.return(i)})}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context);this._gpuContextHash={},this._graphicsDataContextHash={},this._renderer=null}};Ki.extension={type:[R.WebGLSystem,R.WebGPUSystem,R.CanvasSystem],name:"graphicsContext"};Ki.defaultOptions={bezierSmoothness:.5};let ea=Ki;const lu=8,gs=11920929e-14,cu=1;function sa(s,t,e,i,r,n,o,a,h,l){const u=Math.min(.99,Math.max(0,l??ea.defaultOptions.bezierSmoothness));let f=(cu-u)/1;return f*=f,uu(t,e,i,r,n,o,a,h,s,f),s}function uu(s,t,e,i,r,n,o,a,h,l){Gi(s,t,e,i,r,n,o,a,h,l,0),h.push(o,a)}function Gi(s,t,e,i,r,n,o,a,h,l,c){if(c>lu)return;const u=(s+e)/2,f=(t+i)/2,d=(e+r)/2,p=(i+n)/2,y=(r+o)/2,g=(n+a)/2,x=(u+d)/2,_=(f+p)/2,m=(d+y)/2,w=(p+g)/2,v=(x+m)/2,b=(_+w)/2;if(c>0){let A=o-s,I=a-t;const C=Math.abs((e-o)*I-(i-a)*A),P=Math.abs((r-o)*I-(n-a)*A);if(C>gs&&P>gs){if((C+P)*(C+P)<=l*(A*A+I*I)){h.push(v,b);return}}else if(C>gs){if(C*C<=l*(A*A+I*I)){h.push(v,b);return}}else if(P>gs){if(P*P<=l*(A*A+I*I)){h.push(v,b);return}}else if(A=v-(s+o)/2,I=b-(t+a)/2,A*A+I*I<=l){h.push(v,b);return}}Gi(s,t,u,f,x,_,v,b,h,l,c+1),Gi(v,b,m,w,y,g,o,a,h,l,c+1)}const du=8,fu=11920929e-14,pu=1;function gu(s,t,e,i,r,n,o,a){const l=Math.min(.99,Math.max(0,a??ea.defaultOptions.bezierSmoothness));let c=(pu-l)/1;return c*=c,mu(t,e,i,r,n,o,s,c),s}function mu(s,t,e,i,r,n,o,a){Oi(o,s,t,e,i,r,n,a,0),o.push(r,n)}function Oi(s,t,e,i,r,n,o,a,h){if(h>du)return;const l=(t+i)/2,c=(e+r)/2,u=(i+n)/2,f=(r+o)/2,d=(l+u)/2,p=(c+f)/2;let y=n-t,g=o-e;const x=Math.abs((i-n)*g-(r-o)*y);if(x>fu){if(x*x<=a*(y*y+g*g)){s.push(d,p);return}}else if(y=d-(t+n)/2,g=p-(e+o)/2,y*y+g*g<=a){s.push(d,p);return}Oi(s,t,e,l,c,d,p,a,h+1),Oi(s,d,p,u,f,n,o,a,h+1)}function ia(s,t,e,i,r,n,o,a){let h=Math.abs(r-n);(!o&&r>n||o&&n>r)&&(h=2*Math.PI-h),a||(a=Math.max(6,Math.floor(6*Math.pow(i,1/3)*(h/Math.PI)))),a=Math.max(a,3);let l=h/a,c=r;l*=o?-1:1;for(let u=0;u<a+1;u++){const f=Math.cos(c),d=Math.sin(c),p=t+f*i,y=e+d*i;s.push(p,y),c+=l}}function yu(s,t,e,i,r,n){const o=s[s.length-2],h=s[s.length-1]-e,l=o-t,c=r-e,u=i-t,f=Math.abs(h*u-l*c);if(f<1e-8||n===0){(s[s.length-2]!==t||s[s.length-1]!==e)&&s.push(t,e);return}const d=h*h+l*l,p=c*c+u*u,y=h*c+l*u,g=n*Math.sqrt(d)/f,x=n*Math.sqrt(p)/f,_=g*y/d,m=x*y/p,w=g*u+x*l,v=g*c+x*h,b=l*(x+_),A=h*(x+_),I=u*(g+m),C=c*(g+m),P=Math.atan2(A-v,b-w),k=Math.atan2(C-v,I-w);ia(s,w+t,v+e,n,P,k,l*c>u*h)}const We=Math.PI*2,li={centerX:0,centerY:0,ang1:0,ang2:0},ci=({x:s,y:t},e,i,r,n,o,a,h)=>{s*=e,t*=i;const l=r*s-n*t,c=n*s+r*t;return h.x=l+o,h.y=c+a,h};function xu(s,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),i=t===1.5707963267948966?.551915024494:e,r=Math.cos(s),n=Math.sin(s),o=Math.cos(s+t),a=Math.sin(s+t);return[{x:r-n*i,y:n+r*i},{x:o+a*i,y:a-o*i},{x:o,y:a}]}const nn=(s,t,e,i)=>{const r=s*i-t*e<0?-1:1;let n=s*e+t*i;return n>1&&(n=1),n<-1&&(n=-1),r*Math.acos(n)},_u=(s,t,e,i,r,n,o,a,h,l,c,u,f)=>{const d=Math.pow(r,2),p=Math.pow(n,2),y=Math.pow(c,2),g=Math.pow(u,2);let x=d*p-d*g-p*y;x<0&&(x=0),x/=d*g+p*y,x=Math.sqrt(x)*(o===a?-1:1);const _=x*r/n*u,m=x*-n/r*c,w=l*_-h*m+(s+e)/2,v=h*_+l*m+(t+i)/2,b=(c-_)/r,A=(u-m)/n,I=(-c-_)/r,C=(-u-m)/n,P=nn(1,0,b,A);let k=nn(b,A,I,C);a===0&&k>0&&(k-=We),a===1&&k<0&&(k+=We),f.centerX=w,f.centerY=v,f.ang1=P,f.ang2=k};function wu(s,t,e,i,r,n,o,a=0,h=0,l=0){if(n===0||o===0)return;const c=Math.sin(a*We/360),u=Math.cos(a*We/360),f=u*(t-i)/2+c*(e-r)/2,d=-c*(t-i)/2+u*(e-r)/2;if(f===0&&d===0)return;n=Math.abs(n),o=Math.abs(o);const p=Math.pow(f,2)/Math.pow(n,2)+Math.pow(d,2)/Math.pow(o,2);p>1&&(n*=Math.sqrt(p),o*=Math.sqrt(p)),_u(t,e,i,r,n,o,h,l,c,u,f,d,li);let{ang1:y,ang2:g}=li;const{centerX:x,centerY:_}=li;let m=Math.abs(g)/(We/4);Math.abs(1-m)<1e-7&&(m=1);const w=Math.max(Math.ceil(m),1);g/=w;let v=s[s.length-2],b=s[s.length-1];const A={x:0,y:0};for(let I=0;I<w;I++){const C=xu(y,g),{x:P,y:k}=ci(C[0],n,o,u,c,x,_,A),{x:z,y:O}=ci(C[1],n,o,u,c,x,_,A),{x:H,y:S}=ci(C[2],n,o,u,c,x,_,A);sa(s,v,b,P,k,z,O,H,S),v=H,b=S,y+=g}}function bu(s,t,e){const i=(o,a)=>{const h=a.x-o.x,l=a.y-o.y,c=Math.sqrt(h*h+l*l),u=h/c,f=l/c;return{len:c,nx:u,ny:f}},r=(o,a)=>{o===0?s.moveTo(a.x,a.y):s.lineTo(a.x,a.y)};let n=t[t.length-1];for(let o=0;o<t.length;o++){const a=t[o%t.length],h=a.radius??e;if(h<=0){r(o,a),n=a;continue}const l=t[(o+1)%t.length],c=i(a,n),u=i(a,l);if(c.len<1e-4||u.len<1e-4){r(o,a),n=a;continue}let f=Math.asin(c.nx*u.ny-c.ny*u.nx),d=1,p=!1;c.nx*u.nx-c.ny*-u.ny<0?f<0?f=Math.PI+f:(f=Math.PI-f,d=-1,p=!0):f>0&&(d=-1,p=!0);const y=f/2;let g,x=Math.abs(Math.cos(y)*h/Math.sin(y));x>Math.min(c.len/2,u.len/2)?(x=Math.min(c.len/2,u.len/2),g=Math.abs(x*Math.sin(y)/Math.cos(y))):g=h;const _=a.x+u.nx*x+-u.ny*g*d,m=a.y+u.ny*x+u.nx*g*d,w=Math.atan2(c.ny,c.nx)+Math.PI/2*d,v=Math.atan2(u.ny,u.nx)-Math.PI/2*d;o===0&&s.moveTo(_+Math.cos(w)*g,m+Math.sin(w)*g),s.arc(_,m,g,w,v,p),n=a}}function Au(s,t,e,i){const r=(a,h)=>Math.sqrt((a.x-h.x)**2+(a.y-h.y)**2),n=(a,h,l)=>({x:a.x+(h.x-a.x)*l,y:a.y+(h.y-a.y)*l}),o=t.length;for(let a=0;a<o;a++){const h=t[(a+1)%o],l=h.radius??e;if(l<=0){a===0?s.moveTo(h.x,h.y):s.lineTo(h.x,h.y);continue}const c=t[a],u=t[(a+2)%o],f=r(c,h);let d;if(f<1e-4)d=h;else{const g=Math.min(f/2,l);d=n(h,c,g/f)}const p=r(u,h);let y;if(p<1e-4)y=h;else{const g=Math.min(p/2,l);y=n(h,u,g/p)}a===0?s.moveTo(d.x,d.y):s.lineTo(d.x,d.y),s.quadraticCurveTo(h.x,h.y,y.x,y.y,i)}}const vu=new j;class Su{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new xt,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const i=this._currentPoly.points,r=i[i.length-2],n=i[i.length-1];return(r!==t||n!==e)&&i.push(t,e),this}arc(t,e,i,r,n,o){this._ensurePoly(!1);const a=this._currentPoly.points;return ia(a,t,e,i,r,n,o),this}arcTo(t,e,i,r,n){this._ensurePoly();const o=this._currentPoly.points;return yu(o,t,e,i,r,n),this}arcToSvg(t,e,i,r,n,o,a){const h=this._currentPoly.points;return wu(h,this._currentPoly.lastX,this._currentPoly.lastY,o,a,t,e,i,r,n),this}bezierCurveTo(t,e,i,r,n,o,a){this._ensurePoly();const h=this._currentPoly;return sa(this._currentPoly.points,h.lastX,h.lastY,t,e,i,r,n,o,a),this}quadraticCurveTo(t,e,i,r,n){this._ensurePoly();const o=this._currentPoly;return gu(this._currentPoly.points,o.lastX,o.lastY,t,e,i,r,n),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));const i=this.shapePrimitives,r=i.length;for(let n=0;n<t.instructions.length;n++){const o=t.instructions[n];this[o.action](...o.data)}if(t.checkForHoles&&i.length-r>1){let n=null;for(let o=r;o<i.length;o++){const a=i[o];if(a.shape.type==="polygon"){const h=a.shape,l=n?.shape;l&&l.containsPolygon(h)?(n.holes||(n.holes=[]),n.holes.push(a),i.copyWithin(o,o+1),i.length--,o--):n=a}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,i,r,n){return this.drawShape(new j(t,e,i,r),n),this}circle(t,e,i,r){return this.drawShape(new Yi(t,e,i),r),this}poly(t,e,i){const r=new De(t);return r.closePath=e,this.drawShape(r,i),this}regularPoly(t,e,i,r,n=0,o){r=Math.max(r|0,3);const a=-1*Math.PI/2+n,h=Math.PI*2/r,l=[];for(let c=0;c<r;c++){const u=a-c*h;l.push(t+i*Math.cos(u),e+i*Math.sin(u))}return this.poly(l,!0,o),this}roundPoly(t,e,i,r,n,o=0,a){if(r=Math.max(r|0,3),n<=0)return this.regularPoly(t,e,i,r,o);const h=i*Math.sin(Math.PI/r)-.001;n=Math.min(n,h);const l=-1*Math.PI/2+o,c=Math.PI*2/r,u=(r-2)*Math.PI/r/2;for(let f=0;f<r;f++){const d=f*c+l,p=t+i*Math.cos(d),y=e+i*Math.sin(d),g=d+Math.PI+u,x=d-Math.PI-u,_=p+n*Math.cos(g),m=y+n*Math.sin(g),w=p+n*Math.cos(x),v=y+n*Math.sin(x);f===0?this.moveTo(_,m):this.lineTo(_,m),this.quadraticCurveTo(p,y,w,v,a)}return this.closePath()}roundShape(t,e,i=!1,r){return t.length<3?this:(i?Au(this,t,e,r):bu(this,t,e),this.closePath())}filletRect(t,e,i,r,n){if(n===0)return this.rect(t,e,i,r);const o=Math.min(i,r)/2,a=Math.min(o,Math.max(-o,n)),h=t+i,l=e+r,c=a<0?-a:0,u=Math.abs(a);return this.moveTo(t,e+u).arcTo(t+c,e+c,t+u,e,u).lineTo(h-u,e).arcTo(h-c,e+c,h,e+u,u).lineTo(h,l-u).arcTo(h-c,l-c,t+i-u,l,u).lineTo(t+u,l).arcTo(t+c,l-c,t,l-u,u).closePath()}chamferRect(t,e,i,r,n,o){if(n<=0)return this.rect(t,e,i,r);const a=Math.min(n,Math.min(i,r)/2),h=t+i,l=e+r,c=[t+a,e,h-a,e,h,e+a,h,l-a,h-a,l,t+a,l,t,l-a,t,e+a];for(let u=c.length-1;u>=2;u-=2)c[u]===c[u-2]&&c[u-1]===c[u-3]&&c.splice(u-1,2);return this.poly(c,!0,o)}ellipse(t,e,i,r,n){return this.drawShape(new Xi(t,e,i,r),n),this}roundRect(t,e,i,r,n,o){return this.drawShape(new qi(t,e,i,r,n),o),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let i=this._currentPoly;return i&&this.endPoly(),i=new De,i.points.push(t,e),this._currentPoly=i,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new De,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let i=e.shape.x,r=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const n=e.transform,o=i;i=n.a*i+n.c*r+n.tx,r=n.b*o+n.d*r+n.ty}this._currentPoly.points.push(i,r)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const i=t.instructions[e];this[i.action](...i.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let i=0;i<e.length;i++){const r=e[i],n=r.shape.getBounds(vu);r.transform?t.addRect(n,r.transform):t.addRect(n)}return t}}class It{constructor(t,e=!1){this.instructions=[],this.uid=K("graphicsPath"),this._dirty=!0,this.checkForHoles=e,typeof t=="string"?Yl(t,this):this.instructions=t?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new Su(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,i,r,n){const o=this.instructions[this.instructions.length-1],a=this.getLastPoint(et.shared);let h=0,l=0;if(!o||o.action!=="bezierCurveTo")h=a.x,l=a.y;else{h=o.data[2],l=o.data[3];const c=a.x,u=a.y;h=c+(c-h),l=u+(u-l)}return this.instructions.push({action:"bezierCurveTo",data:[h,l,t,e,i,r,n]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,i){const r=this.instructions[this.instructions.length-1],n=this.getLastPoint(et.shared);let o=0,a=0;if(!r||r.action!=="quadraticCurveTo")o=n.x,a=n.y;else{o=r.data[0],a=r.data[1];const h=n.x,l=n.y;o=h+(h-o),a=l+(l-a)}return this.instructions.push({action:"quadraticCurveTo",data:[o,a,t,e,i]}),this._dirty=!0,this}rect(t,e,i,r,n){return this.instructions.push({action:"rect",data:[t,e,i,r,n]}),this._dirty=!0,this}circle(t,e,i,r){return this.instructions.push({action:"circle",data:[t,e,i,r]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,i,r,n,o,a){n||(n=r/2);const h=-1*Math.PI/2+o,l=i*2,c=Math.PI*2/l,u=[];for(let f=0;f<l;f++){const d=f%2?n:r,p=f*c+h;u.push(t+d*Math.cos(p),e+d*Math.sin(p))}return this.poly(u,!0,a),this}clone(t=!1){const e=new It;if(e.checkForHoles=this.checkForHoles,!t)e.instructions=this.instructions.slice();else for(let i=0;i<this.instructions.length;i++){const r=this.instructions[i];e.instructions.push({action:r.action,data:r.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,i=t.b,r=t.c,n=t.d,o=t.tx,a=t.ty;let h=0,l=0,c=0,u=0,f=0,d=0,p=0,y=0;for(let g=0;g<this.instructions.length;g++){const x=this.instructions[g],_=x.data;switch(x.action){case"moveTo":case"lineTo":h=_[0],l=_[1],_[0]=e*h+r*l+o,_[1]=i*h+n*l+a;break;case"bezierCurveTo":c=_[0],u=_[1],f=_[2],d=_[3],h=_[4],l=_[5],_[0]=e*c+r*u+o,_[1]=i*c+n*u+a,_[2]=e*f+r*d+o,_[3]=i*f+n*d+a,_[4]=e*h+r*l+o,_[5]=i*h+n*l+a;break;case"quadraticCurveTo":c=_[0],u=_[1],h=_[2],l=_[3],_[0]=e*c+r*u+o,_[1]=i*c+n*u+a,_[2]=e*h+r*l+o,_[3]=i*h+n*l+a;break;case"arcToSvg":h=_[5],l=_[6],p=_[0],y=_[1],_[0]=e*p+r*y,_[1]=i*p+n*y,_[5]=e*h+r*l+o,_[6]=i*h+n*l+a;break;case"circle":_[4]=Te(_[3],t);break;case"rect":_[4]=Te(_[4],t);break;case"ellipse":_[8]=Te(_[8],t);break;case"roundRect":_[5]=Te(_[5],t);break;case"addPath":_[0].transform(t);break;case"poly":_[2]=Te(_[2],t);break;default:U("unknown transform action",x.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,i=this.instructions[e];if(!i)return t.x=0,t.y=0,t;for(;i.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;i=this.instructions[e]}switch(i.action){case"moveTo":case"lineTo":t.x=i.data[0],t.y=i.data[1];break;case"quadraticCurveTo":t.x=i.data[2],t.y=i.data[3];break;case"bezierCurveTo":t.x=i.data[4],t.y=i.data[5];break;case"arc":case"arcToSvg":t.x=i.data[5],t.y=i.data[6];break;case"addPath":i.data[0].getLastPoint(t);break}return t}}function Te(s,t){return s?s.prepend(t):t.clone()}function q(s,t,e){const i=s.getAttribute(t);return i?Number(i):e}function Cu(s,t){const e=s.querySelectorAll("defs");for(let i=0;i<e.length;i++){const r=e[i];for(let n=0;n<r.children.length;n++){const o=r.children[n];switch(o.nodeName.toLowerCase()){case"lineargradient":t.defs[o.id]=Pu(o);break;case"radialgradient":t.defs[o.id]=Tu();break}}}}function Pu(s){const t=q(s,"x1",0),e=q(s,"y1",0),i=q(s,"x2",1),r=q(s,"y2",0),n=s.getAttribute("gradientUnits")||"objectBoundingBox",o=new Bt(t,e,i,r,n==="objectBoundingBox"?"local":"global");for(let a=0;a<s.children.length;a++){const h=s.children[a],l=q(h,"offset",0),c=Y.shared.setValue(h.getAttribute("stop-color")).toNumber();o.addColorStop(l,c)}return o}function Tu(s){return U("[SVG Parser] Radial gradients are not yet supported"),new Bt(0,0,1,0)}function on(s){const t=s.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const an={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function ra(s,t){const e=s.getAttribute("style"),i={},r={},n={strokeStyle:i,fillStyle:r,useFill:!1,useStroke:!1};for(const o in an){const a=s.getAttribute(o);a&&hn(t,n,o,a.trim())}if(e){const o=e.split(";");for(let a=0;a<o.length;a++){const h=o[a].trim(),[l,c]=h.split(":");an[l]&&hn(t,n,l,c.trim())}}return{strokeStyle:n.useStroke?i:null,fillStyle:n.useFill?r:null,useFill:n.useFill,useStroke:n.useStroke}}function hn(s,t,e,i){switch(e){case"stroke":if(i!=="none"){if(i.startsWith("url(")){const r=on(i);t.strokeStyle.fill=s.defs[r]}else t.strokeStyle.color=Y.shared.setValue(i).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(i);break;case"fill":if(i!=="none"){if(i.startsWith("url(")){const r=on(i);t.fillStyle.fill=s.defs[r]}else t.fillStyle.color=Y.shared.setValue(i).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(i);break;case"stroke-opacity":t.strokeStyle.alpha=Number(i);break;case"opacity":t.fillStyle.alpha=Number(i),t.strokeStyle.alpha=Number(i);break}}function ku(s){if(s.length<=2)return!0;const t=s.map(a=>a.area).sort((a,h)=>h-a),[e,i]=t,r=t[t.length-1],n=e/i,o=i/r;return!(n>3&&o<2)}function Mu(s){return s.split(/(?=[Mm])/).filter(i=>i.trim().length>0)}function Eu(s){const t=s.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!t||t.length<4)return 0;const e=t.map(Number),i=[],r=[];for(let c=0;c<e.length;c+=2)c+1<e.length&&(i.push(e[c]),r.push(e[c+1]));if(i.length===0||r.length===0)return 0;const n=Math.min(...i),o=Math.max(...i),a=Math.min(...r),h=Math.max(...r);return(o-n)*(h-a)}function ln(s,t){const e=new It(s,!1);for(const i of e.instructions)t.instructions.push(i)}function Iu(s,t){if(typeof s=="string"){const o=document.createElement("div");o.innerHTML=s.trim(),s=o.querySelector("svg")}const e={context:t,defs:{},path:new It};Cu(s,e);const i=s.children,{fillStyle:r,strokeStyle:n}=ra(s,e);for(let o=0;o<i.length;o++){const a=i[o];a.nodeName.toLowerCase()!=="defs"&&na(a,e,r,n)}return t}function na(s,t,e,i){const r=s.children,{fillStyle:n,strokeStyle:o}=ra(s,t);n&&e?e={...e,...n}:n&&(e=n),o&&i?i={...i,...o}:o&&(i=o);const a=!e&&!i;a&&(e={color:0});let h,l,c,u,f,d,p,y,g,x,_,m,w,v,b,A,I;switch(s.nodeName.toLowerCase()){case"path":{v=s.getAttribute("d");const C=s.getAttribute("fill-rule"),P=Mu(v),k=C==="evenodd",z=P.length>1;if(k&&z){const H=P.map(T=>({path:T,area:Eu(T)}));if(H.sort((T,E)=>E.area-T.area),P.length>3||!ku(H))for(let T=0;T<H.length;T++){const E=H[T],at=T===0;t.context.beginPath();const L=new It(void 0,!0);ln(E.path,L),t.context.path(L),at?(e&&t.context.fill(e),i&&t.context.stroke(i)):t.context.cut()}else for(let T=0;T<H.length;T++){const E=H[T],at=T%2===1;t.context.beginPath();const L=new It(void 0,!0);ln(E.path,L),t.context.path(L),at?t.context.cut():(e&&t.context.fill(e),i&&t.context.stroke(i))}}else{const H=C?C==="evenodd":!0;b=new It(v,H),t.context.path(b),e&&t.context.fill(e),i&&t.context.stroke(i)}break}case"circle":p=q(s,"cx",0),y=q(s,"cy",0),g=q(s,"r",0),t.context.ellipse(p,y,g,g),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"rect":h=q(s,"x",0),l=q(s,"y",0),A=q(s,"width",0),I=q(s,"height",0),x=q(s,"rx",0),_=q(s,"ry",0),x||_?t.context.roundRect(h,l,A,I,x||_):t.context.rect(h,l,A,I),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"ellipse":p=q(s,"cx",0),y=q(s,"cy",0),x=q(s,"rx",0),_=q(s,"ry",0),t.context.beginPath(),t.context.ellipse(p,y,x,_),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"line":c=q(s,"x1",0),u=q(s,"y1",0),f=q(s,"x2",0),d=q(s,"y2",0),t.context.beginPath(),t.context.moveTo(c,u),t.context.lineTo(f,d),i&&t.context.stroke(i);break;case"polygon":w=s.getAttribute("points"),m=w.match(/\d+/g).map(C=>parseInt(C,10)),t.context.poly(m,!0),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"polyline":w=s.getAttribute("points"),m=w.match(/\d+/g).map(C=>parseInt(C,10)),t.context.poly(m,!1),i&&t.context.stroke(i);break;case"g":case"svg":break;default:{U(`[SVG parser] <${s.nodeName}> elements unsupported`);break}}a&&(e=null);for(let C=0;C<r.length;C++)na(r[C],t,e,i)}function Ru(s){return Y.isColorLike(s)}function cn(s){return s instanceof Ds}function un(s){return s instanceof Bt}function Bu(s){return s instanceof G}function Fu(s,t,e){const i=Y.shared.setValue(t??0);return s.color=i.toNumber(),s.alpha=i.alpha===1?e.alpha:i.alpha,s.texture=G.WHITE,{...e,...s}}function Lu(s,t,e){return s.texture=t,{...e,...s}}function dn(s,t,e){return s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,{...e,...s}}function fn(s,t,e){return t.buildGradient(),s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,s.textureSpace=t.textureSpace,{...e,...s}}function Gu(s,t){const e={...t,...s},i=Y.shared.setValue(e.color);return e.alpha*=i.alpha,e.color=i.toNumber(),e}function Xt(s,t){if(s==null)return null;const e={},i=s;return Ru(s)?Fu(e,s,t):Bu(s)?Lu(e,s,t):cn(s)?dn(e,s,t):un(s)?fn(e,s,t):i.fill&&cn(i.fill)?dn(i,i.fill,t):i.fill&&un(i.fill)?fn(i,i.fill,t):Gu(i,t)}function Es(s,t){const{width:e,alignment:i,miterLimit:r,cap:n,join:o,pixelLine:a,...h}=t,l=Xt(s,h);return l?{width:e,alignment:i,miterLimit:r,cap:n,join:o,pixelLine:a,...l}:null}const Ou=new et,pn=new F,Zi=class vt extends _t{constructor(){super(...arguments),this.uid=K("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new It,this._transform=new F,this._fillStyle={...vt.defaultFillStyle},this._strokeStyle={...vt.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new xt,this._boundsDirty=!0}clone(){const t=new vt;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=Xt(t,vt.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=Es(t,vt.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=Xt(t,vt.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=Xt(t,vt.defaultStrokeStyle),this}texture(t,e,i,r,n,o){return this.instructions.push({action:"texture",data:{image:t,dx:i||0,dy:r||0,dw:n||t.frame.width,dh:o||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?Y.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new It,this}fill(t,e){let i;const r=this.instructions[this.instructions.length-1];return this._tick===0&&r?.action==="stroke"?i=r.data.path:i=this._activePath.clone(),i?(t!=null&&(e!==void 0&&typeof t=="number"&&(B(D,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=Xt(t,vt.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:i}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(et.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const i=this.instructions[this.instructions.length-1];return this._tick===0&&i?.action==="fill"?e=i.data.path:e=this._activePath.clone(),e?(t!=null&&(this._strokeStyle=Es(t,vt.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],i=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(i);else{e.data.hole=i;break}}return this._initNextPathLocation(),this}arc(t,e,i,r,n,o){this._tick++;const a=this._transform;return this._activePath.arc(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,i,r,n,o),this}arcTo(t,e,i,r,n){this._tick++;const o=this._transform;return this._activePath.arcTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*i+o.c*r+o.tx,o.b*i+o.d*r+o.ty,n),this}arcToSvg(t,e,i,r,n,o,a){this._tick++;const h=this._transform;return this._activePath.arcToSvg(t,e,i,r,n,h.a*o+h.c*a+h.tx,h.b*o+h.d*a+h.ty),this}bezierCurveTo(t,e,i,r,n,o,a){this._tick++;const h=this._transform;return this._activePath.bezierCurveTo(h.a*t+h.c*e+h.tx,h.b*t+h.d*e+h.ty,h.a*i+h.c*r+h.tx,h.b*i+h.d*r+h.ty,h.a*n+h.c*o+h.tx,h.b*n+h.d*o+h.ty,a),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(t,e,i,r){return this._tick++,this._activePath.ellipse(t,e,i,r,this._transform.clone()),this}circle(t,e,i){return this._tick++,this._activePath.circle(t,e,i,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const i=this._transform;return this._activePath.lineTo(i.a*t+i.c*e+i.tx,i.b*t+i.d*e+i.ty),this}moveTo(t,e){this._tick++;const i=this._transform,r=this._activePath.instructions,n=i.a*t+i.c*e+i.tx,o=i.b*t+i.d*e+i.ty;return r.length===1&&r[0].action==="moveTo"?(r[0].data[0]=n,r[0].data[1]=o,this):(this._activePath.moveTo(n,o),this)}quadraticCurveTo(t,e,i,r,n){this._tick++;const o=this._transform;return this._activePath.quadraticCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*i+o.c*r+o.tx,o.b*i+o.d*r+o.ty,n),this}rect(t,e,i,r){return this._tick++,this._activePath.rect(t,e,i,r,this._transform.clone()),this}roundRect(t,e,i,r,n){return this._tick++,this._activePath.roundRect(t,e,i,r,n,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,i,r,n=0,o){return this._tick++,this._activePath.regularPoly(t,e,i,r,n,o),this}roundPoly(t,e,i,r,n,o){return this._tick++,this._activePath.roundPoly(t,e,i,r,n,o),this}roundShape(t,e,i,r){return this._tick++,this._activePath.roundShape(t,e,i,r),this}filletRect(t,e,i,r,n){return this._tick++,this._activePath.filletRect(t,e,i,r,n),this}chamferRect(t,e,i,r,n,o){return this._tick++,this._activePath.chamferRect(t,e,i,r,n,o),this}star(t,e,i,r,n=0,o=0){return this._tick++,this._activePath.star(t,e,i,r,n,o,this._transform.clone()),this}svg(t){return this._tick++,Iu(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,i,r,n,o){return t instanceof F?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,i,r,n,o),this)}transform(t,e,i,r,n,o){return t instanceof F?(this._transform.append(t),this):(pn.set(t,e,i,r,n,o),this._transform.append(pn),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,!this.dirty&&(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const i=this.instructions[e],r=i.action;if(r==="fill"){const n=i.data;t.addBounds(n.path.bounds)}else if(r==="texture"){const n=i.data;t.addFrame(n.dx,n.dy,n.dx+n.dw,n.dy+n.dh,n.transform)}if(r==="stroke"){const n=i.data,o=n.style.alignment,a=n.style.width*(1-o),h=n.path.bounds;t.addFrame(h.minX-a,h.minY-a,h.maxX+a,h.maxY+a)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let i=!1;for(let r=0;r<e.length;r++){const n=e[r],o=n.data,a=o.path;if(!n.action||!a)continue;const h=o.style,l=a.shapePath.shapePrimitives;for(let c=0;c<l.length;c++){const u=l[c].shape;if(!h||!u)continue;const f=l[c].transform,d=f?f.applyInverse(t,Ou):t;if(n.action==="fill")i=u.contains(d.x,d.y);else{const y=h;i=u.strokeContains(d.x,d.y,y.width,y.alignment)}const p=o.hole;if(p){const y=p.shapePath?.shapePrimitives;if(y)for(let g=0;g<y.length;g++)y[g].shape.contains(d.x,d.y)&&(i=!1)}if(i)return!0}}return i}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){const i=typeof t=="boolean"?t:t?.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(i)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(i))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Zi.defaultFillStyle={color:16777215,alpha:1,texture:G.WHITE,matrix:null,fill:null,textureSpace:"local"};Zi.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:G.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let ct=Zi;const Qi=class te extends _t{constructor(t={}){super(),this.uid=K("textStyle"),this._tick=0,Du(t);const e={...te.defaultTextStyle,...t};for(const i in e){const r=i;this[r]=e[i]}this.update(),this._tick=0}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.update())}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.update())}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...te.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...te.defaultDropShadow}):null,this.update())}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!==t&&(this._fontFamily=t,this.update())}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update())}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t.toLowerCase(),this.update())}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.update())}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.update())}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.update())}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.update())}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.update())}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.update())}get filters(){return this._filters}set filters(t){this._filters!==t&&(this._filters=Object.freeze(t),this.update())}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.update())}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.update())}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.update())}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.update())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.update())}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...ct.defaultFillStyle,...t},()=>{this._fill=Xt({...this._originalFill},ct.defaultFillStyle)})),this._fill=Xt(t===0?"black":t,ct.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...ct.defaultStrokeStyle,...t},()=>{this._stroke=Es({...this._originalStroke},ct.defaultStrokeStyle)})),this._stroke=Es(t,ct.defaultStrokeStyle),this.update())}update(){this._tick++,this.emit("update",this)}reset(){const t=te.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return`${this.uid}-${this._tick}`}clone(){return new te({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){if(this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){const i=typeof t=="boolean"?t:t?.textureSource;this._fill?.texture&&this._fill.texture.destroy(i),this._originalFill?.texture&&this._originalFill.texture.destroy(i),this._stroke?.texture&&this._stroke.texture.destroy(i),this._originalStroke?.texture&&this._originalStroke.texture.destroy(i)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(i,r,n)=>(i[r]===n||(i[r]=n,e?.(r,n),this.update()),!0)})}_isFillStyle(t){return(t??null)!==null&&!(Y.isColorLike(t)||t instanceof Bt||t instanceof Ds)}};Qi.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};Qi.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Ye=Qi;function Du(s){const t=s;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=Ye.defaultDropShadow;s.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){B(D,"strokeThickness is now a part of stroke");const e=t.stroke;let i={};if(Y.isColorLike(e))i.color=e;else if(e instanceof Bt||e instanceof Ds)i.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))i=e;else throw new Error("Invalid stroke value.");s.stroke={...i,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){if(B(D,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(t.fill)||t.fill.length===0)throw new Error("Invalid fill value. Expected an array of colors for gradient fill.");t.fill.length!==t.fillGradientStops.length&&U("The number of fill colors must match the number of fill gradient stops.");const e=new Bt({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),i=t.fillGradientStops.slice(),r=t.fill.map(n=>Y.shared.setValue(n).toNumber());i.forEach((n,o)=>{e.addColorStop(n,r[o])}),s.fill={fill:e}}}class zu{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const i=N.get().createCanvas();i.width=t,i.height=e;const r=i.getContext("2d");return{canvas:i,context:r}}getOptimalCanvasAndContext(t,e,i=1){t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),t=ae(t),e=ae(e);const r=(t<<17)+(e<<1);this._canvasPool[r]||(this._canvasPool[r]=[]);let n=this._canvasPool[r].pop();return n||(n=this._createCanvasAndContext(t,e)),n}returnCanvasAndContext(t){const e=t.canvas,{width:i,height:r}=e,n=(i<<17)+(r<<1);t.context.resetTransform(),t.context.clearRect(0,0,i,r),this._canvasPool[n].push(t)}clear(){this._canvasPool={}}}const Xe=new zu;Qe.register(Xe);const gn=1e5;function Is(s,t,e,i=0){if(s.texture===G.WHITE&&!s.fill)return Y.shared.setValue(s.color).setAlpha(s.alpha??1).toHexa();if(s.fill){if(s.fill instanceof Ds){const r=s.fill,n=t.createPattern(r.texture.source.resource,"repeat"),o=r.transform.copyTo(F.shared);return o.scale(r.texture.frame.width,r.texture.frame.height),n.setTransform(o),n}else if(s.fill instanceof Bt){const r=s.fill,n=r.type==="linear",o=r.textureSpace==="local";let a=1,h=1;o&&e&&(a=e.width+i,h=e.height+i);let l,c=!1;if(n){const{start:u,end:f}=r;l=t.createLinearGradient(u.x*a,u.y*h,f.x*a,f.y*h),c=Math.abs(f.x-u.x)<Math.abs((f.y-u.y)*.1)}else{const{center:u,innerRadius:f,outerCenter:d,outerRadius:p}=r;l=t.createRadialGradient(u.x*a,u.y*h,f*a,d.x*a,d.y*h,p*a)}if(c&&o&&e){const u=e.lineHeight/h;for(let f=0;f<e.lines.length;f++){const d=(f*e.lineHeight+i/2)/h;r.colorStops.forEach(p=>{const y=d+p.offset*u;l.addColorStop(Math.floor(y*gn)/gn,Y.shared.setValue(p.color).toHex())})}}else r.colorStops.forEach(u=>{l.addColorStop(u.offset,Y.shared.setValue(u.color).toHex())});return l}}else{const r=t.createPattern(s.texture.source.resource,"repeat"),n=s.matrix.copyTo(F.shared);return n.scale(s.texture.frame.width,s.texture.frame.height),r.setTransform(n),r}return U("FillStyle not recognised",s),"red"}const oa=class aa extends No{constructor(t){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const e={...aa.defaultOptions,...t};this._textureSize=e.textureSize,this._mipmap=e.mipmap;const i=e.style.clone();e.overrideFill&&(i._fill.color=16777215,i._fill.alpha=1,i._fill.texture=G.WHITE,i._fill.fill=null),this.applyFillAsTint=e.overrideFill;const r=i.fontSize;i.fontSize=this.baseMeasurementFontSize;const n=ks(i);e.overrideSize?i._stroke&&(i._stroke.width*=this.baseRenderedFontSize/r):i.fontSize=this.baseRenderedFontSize=r,this._style=i,this._skipKerning=e.skipKerning??!1,this.resolution=e.resolution??1,this._padding=e.padding??4,e.textureStyle&&(this._textureStyle=e.textureStyle instanceof he?e.textureStyle:new he(e.textureStyle)),this.fontMetrics=St.measureFont(n),this.lineHeight=i.lineHeight||this.fontMetrics.fontSize||i.fontSize}ensureCharacters(t){const e=St.graphemeSegmenter(t).filter(g=>!this._currentChars.includes(g)).filter((g,x,_)=>_.indexOf(g)===x);if(!e.length)return;this._currentChars=[...this._currentChars,...e];let i;this._currentPageIndex===-1?i=this._nextPage():i=this.pages[this._currentPageIndex];let{canvas:r,context:n}=i.canvasAndContext,o=i.texture.source;const a=this._style;let h=this._currentX,l=this._currentY,c=this._currentMaxCharHeight;const u=this.baseRenderedFontSize/this.baseMeasurementFontSize,f=this._padding*u;let d=!1;const p=r.width/this.resolution,y=r.height/this.resolution;for(let g=0;g<e.length;g++){const x=e[g],_=St.measureText(x,a,r,!1);_.lineHeight=_.height;const m=_.width*u,w=Math.ceil((a.fontStyle==="italic"?2:1)*m),v=_.height*u,b=w+f*2,A=v+f*2;if(d=!1,x!==`
`&&x!=="\r"&&x!=="	"&&x!==" "&&(d=!0,c=Math.ceil(Math.max(A,c))),h+b>p&&(l+=c,c=A,h=0,l+c>y)){o.update();const C=this._nextPage();r=C.canvasAndContext.canvas,n=C.canvasAndContext.context,o=C.texture.source,h=0,l=0,c=0}const I=m/u-(a.dropShadow?.distance??0)-(a._stroke?.width??0);if(this.chars[x]={id:x.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:I,kerning:{}},d){this._drawGlyph(n,_,h+f,l+f,u,a);const C=o.width*u,P=o.height*u,k=new j(h/C*o.width,l/P*o.height,b/C*o.width,A/P*o.height);this.chars[x].texture=new G({source:o,frame:k}),h+=Math.ceil(b)}}o.update(),this._currentX=h,this._currentY=l,this._currentMaxCharHeight=c,this._skipKerning&&this._applyKerning(e,n)}get pageTextures(){return B(D,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const i=this._measureCache;for(let r=0;r<t.length;r++){const n=t[r];for(let o=0;o<this._currentChars.length;o++){const a=this._currentChars[o];let h=i[n];h||(h=i[n]=e.measureText(n).width);let l=i[a];l||(l=i[a]=e.measureText(a).width);let c=e.measureText(n+a).width,u=c-(h+l);u&&(this.chars[n].kerning[a]=u),c=e.measureText(n+a).width,u=c-(h+l),u&&(this.chars[a].kerning[n]=u)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=Xe.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const i=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),r=new G({source:new Kt({resource:e.canvas,resolution:i,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(r.source.style=this._textureStyle);const n={canvasAndContext:e,texture:r};return this.pages[this._currentPageIndex]=n,n}_setupContext(t,e,i){e.fontSize=this.baseRenderedFontSize,t.scale(i,i),t.font=ks(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const r=e._stroke,n=r?.width??0;if(r&&(t.lineWidth=n,t.lineJoin=r.join,t.miterLimit=r.miterLimit,t.strokeStyle=Is(r,t)),e._fill&&(t.fillStyle=Is(e._fill,t)),e.dropShadow){const o=e.dropShadow,a=Y.shared.setValue(o.color).toArray(),h=o.blur*i,l=o.distance*i;t.shadowColor=`rgba(${a[0]*255},${a[1]*255},${a[2]*255},${o.alpha})`,t.shadowBlur=h,t.shadowOffsetX=Math.cos(o.angle)*l,t.shadowOffsetY=Math.sin(o.angle)*l}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,i,r,n,o){const a=e.text,h=e.fontProperties,c=(o._stroke?.width??0)*n,u=i+c/2,f=r-c/2,d=h.descent*n,p=e.lineHeight*n;let y=!1;o.stroke&&c&&(y=!0,t.strokeText(a,u,f+p-d));const{shadowBlur:g,shadowOffsetX:x,shadowOffsetY:_}=t;o._fill&&(y&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillText(a,u,f+p-d)),y&&(t.shadowBlur=g,t.shadowOffsetX=x,t.shadowOffsetY=_)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:i}=this.pages[t];Xe.returnCanvasAndContext(e),i.destroy(!0)}this.pages=null}};oa.defaultOptions={textureSize:512,style:new Ye,mipmap:!0};let mn=oa;function Wu(s,t,e,i){const r={width:0,height:0,offsetY:0,scale:t.fontSize/e.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};r.offsetY=e.baseLineOffset;let n=r.lines[0],o=null,a=!0;const h={width:0,start:0,index:0,positions:[],chars:[]},l=e.baseMeasurementFontSize/t.fontSize,c=t.letterSpacing*l,u=t.wordWrapWidth*l,f=t.lineHeight?t.lineHeight*l:e.lineHeight,d=t.wordWrap&&t.breakWords,p=x=>{const _=n.width;for(let m=0;m<h.index;m++){const w=x.positions[m];n.chars.push(x.chars[m]),n.charPositions.push(w+_)}n.width+=x.width,a=!1,h.width=0,h.index=0,h.chars.length=0},y=()=>{let x=n.chars.length-1;if(i){let _=n.chars[x];for(;_===" ";)n.width-=e.chars[_].xAdvance,_=n.chars[--x]}r.width=Math.max(r.width,n.width),n={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},a=!0,r.lines.push(n),r.height+=f},g=x=>x-c>u;for(let x=0;x<s.length+1;x++){let _;const m=x===s.length;m||(_=s[x]);const w=e.chars[_]||e.chars[" "];if(/(?:\s)/.test(_)||_==="\r"||_===`
`||m){if(!a&&t.wordWrap&&g(n.width+h.width)?(y(),p(h),m||n.charPositions.push(0)):(h.start=n.width,p(h),m||n.charPositions.push(0)),_==="\r"||_===`
`)y();else if(!m){const I=w.xAdvance+(w.kerning[o]||0)+c;n.width+=I,n.spaceWidth=I,n.spacesIndex.push(n.charPositions.length),n.chars.push(_)}}else{const A=w.kerning[o]||0,I=w.xAdvance+A+c;d&&g(n.width+h.width+I)&&(p(h),y()),h.positions[h.index++]=h.width+A,h.chars.push(_),h.width+=I}o=_}return y(),t.align==="center"?Nu(r):t.align==="right"?$u(r):t.align==="justify"&&Uu(r),r}function Nu(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],i=s.width/2-e.width/2;for(let r=0;r<e.charPositions.length;r++)e.charPositions[r]+=i}}function $u(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],i=s.width-e.width;for(let r=0;r<e.charPositions.length;r++)e.charPositions[r]+=i}}function Uu(s){const t=s.width;for(let e=0;e<s.lines.length;e++){const i=s.lines[e];let r=0,n=i.spacesIndex[r++],o=0;const a=i.spacesIndex.length,l=(t-i.width)/a;for(let c=0;c<i.charPositions.length;c++)c===n&&(n=i.spacesIndex[r++],o+=l),i.charPositions[c]+=o}}function Hu(s){if(s==="")return[];typeof s=="string"&&(s=[s]);const t=[];for(let e=0,i=s.length;e<i;e++){const r=s[e];if(Array.isArray(r)){if(r.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);if(r[0].length===0||r[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const n=r[0].charCodeAt(0),o=r[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(let a=n,h=o;a<=h;a++)t.push(String.fromCharCode(a))}else t.push(...Array.from(r))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}let ms=0;class Vu{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null},this.measureCache=$o(1e3)}getFont(t,e){let i=`${e.fontFamily}-bitmap`,r=!0;if(e._fill.fill&&!e._stroke?(i+=e._fill.fill.styleKey,r=!1):(e._stroke||e.dropShadow)&&(i=`${e.styleKey}-bitmap`,r=!1),!$.has(i)){const o=Object.create(e);o.lineHeight=0;const a=new mn({style:o,overrideFill:r,overrideSize:!0,...this.defaultOptions});ms++,ms>50&&U("BitmapText",`You have dynamically created ${ms} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),a.once("destroy",()=>{ms--,$.remove(i)}),$.set(i,a)}const n=$.get(i);return n.ensureCharacters?.(t),n}getLayout(t,e,i=!0){const r=this.getFont(t,e),n=`${t}-${e.styleKey}-${i}`;if(this.measureCache.has(n))return this.measureCache.get(n);const o=St.graphemeSegmenter(t),a=Wu(o,e,r,i);return this.measureCache.set(n,a),a}measureText(t,e,i=!0){return this.getLayout(t,e,i)}install(...t){let e=t[0];typeof e=="string"&&(e={name:e,style:t[1],chars:t[2]?.chars,resolution:t[2]?.resolution,padding:t[2]?.padding,skipKerning:t[2]?.skipKerning},B(D,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const i=e?.name;if(!i)throw new Error("[BitmapFontManager] Property `name` is required.");e={...this.defaultOptions,...e};const r=e.style,n=r instanceof Ye?r:new Ye(r),o=e.dynamicFill??this._canUseTintForStyle(n),a=new mn({style:n,overrideFill:o,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1,textureStyle:e.textureStyle}),h=Hu(e.chars);return a.ensureCharacters(h.join("")),$.set(`${i}-bitmap`,a),a.once("destroy",()=>$.remove(`${i}-bitmap`)),a}uninstall(t){const e=`${t}-bitmap`,i=$.get(e);i&&i.destroy()}_canUseTintForStyle(t){return!t._stroke&&(!t.dropShadow||t.dropShadow.color===0)&&!t._fill.fill&&t._fill.color===16777215}}const yn=new Vu;class ha extends No{constructor(t,e){super();const{textures:i,data:r}=t;Object.keys(r.pages).forEach(n=>{const o=r.pages[parseInt(n,10)],a=i[o.id];this.pages.push({texture:a})}),Object.keys(r.chars).forEach(n=>{const o=r.chars[n],{frame:a,source:h,rotate:l}=i[o.page],c=W.transformRectCoords(o,a,l,new j),u=new G({frame:c,orig:new j(0,0,o.width,o.height),source:h,rotate:l});this.chars[n]={id:n.codePointAt(0),xOffset:o.xOffset,yOffset:o.yOffset,xAdvance:o.xAdvance,kerning:o.kerning??{},texture:u}}),this.baseRenderedFontSize=r.fontSize,this.baseMeasurementFontSize=r.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:r.fontSize},this.baseLineOffset=r.baseLineOffset,this.lineHeight=r.lineHeight,this.fontFamily=r.fontFamily,this.distanceField=r.distanceField??{type:"none",range:0},this.url=e}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}static install(t){yn.install(t)}static uninstall(t){yn.uninstall(t)}}const ui={test(s){return typeof s=="string"&&s.startsWith("info face=")},parse(s){const t=s.match(/^[a-z]+\s+.+$/gm),e={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const u in t){const f=t[u].match(/^[a-z]+/gm)[0],d=t[u].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),p={};for(const y in d){const g=d[y].split("="),x=g[0],_=g[1].replace(/"/gm,""),m=parseFloat(_),w=isNaN(m)?_:m;p[x]=w}e[f].push(p)}const i={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[r]=e.info,[n]=e.common,[o]=e.distanceField??[];o&&(i.distanceField={range:parseInt(o.distanceRange,10),type:o.fieldType}),i.fontSize=parseInt(r.size,10),i.fontFamily=r.face,i.lineHeight=parseInt(n.lineHeight,10);const a=e.page;for(let u=0;u<a.length;u++)i.pages.push({id:parseInt(a[u].id,10)||0,file:a[u].file});const h={};i.baseLineOffset=i.lineHeight-parseInt(n.base,10);const l=e.char;for(let u=0;u<l.length;u++){const f=l[u],d=parseInt(f.id,10);let p=f.letter??f.char??String.fromCharCode(d);p==="space"&&(p=" "),h[d]=p,i.chars[p]={id:d,page:parseInt(f.page,10)||0,x:parseInt(f.x,10),y:parseInt(f.y,10),width:parseInt(f.width,10),height:parseInt(f.height,10),xOffset:parseInt(f.xoffset,10),yOffset:parseInt(f.yoffset,10),xAdvance:parseInt(f.xadvance,10),kerning:{}}}const c=e.kerning||[];for(let u=0;u<c.length;u++){const f=parseInt(c[u].first,10),d=parseInt(c[u].second,10),p=parseInt(c[u].amount,10);i.chars[h[d]].kerning[h[f]]=p}return i}},xn={test(s){const t=s;return typeof t!="string"&&"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(s){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},e=s.getElementsByTagName("info")[0],i=s.getElementsByTagName("common")[0],r=s.getElementsByTagName("distanceField")[0];r&&(t.distanceField={type:r.getAttribute("fieldType"),range:parseInt(r.getAttribute("distanceRange"),10)});const n=s.getElementsByTagName("page"),o=s.getElementsByTagName("char"),a=s.getElementsByTagName("kerning");t.fontSize=parseInt(e.getAttribute("size"),10),t.fontFamily=e.getAttribute("face"),t.lineHeight=parseInt(i.getAttribute("lineHeight"),10);for(let l=0;l<n.length;l++)t.pages.push({id:parseInt(n[l].getAttribute("id"),10)||0,file:n[l].getAttribute("file")});const h={};t.baseLineOffset=t.lineHeight-parseInt(i.getAttribute("base"),10);for(let l=0;l<o.length;l++){const c=o[l],u=parseInt(c.getAttribute("id"),10);let f=c.getAttribute("letter")??c.getAttribute("char")??String.fromCharCode(u);f==="space"&&(f=" "),h[u]=f,t.chars[f]={id:u,page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xOffset:parseInt(c.getAttribute("xoffset"),10),yOffset:parseInt(c.getAttribute("yoffset"),10),xAdvance:parseInt(c.getAttribute("xadvance"),10),kerning:{}}}for(let l=0;l<a.length;l++){const c=parseInt(a[l].getAttribute("first"),10),u=parseInt(a[l].getAttribute("second"),10),f=parseInt(a[l].getAttribute("amount"),10);t.chars[h[u]].kerning[h[c]]=f}return t}},_n={test(s){return typeof s=="string"&&s.match(/<font(\s|>)/)?xn.test(N.get().parseXML(s)):!1},parse(s){return xn.parse(N.get().parseXML(s))}},ju=[".xml",".fnt"],Yu={extension:{type:R.CacheParser,name:"cacheBitmapFont"},test:s=>s instanceof ha,getCacheableAssets(s,t){const e={};return s.forEach(i=>{e[i]=t,e[`${i}-bitmap`]=t}),e[`${t.fontFamily}-bitmap`]=t,e}},Xu={extension:{type:R.LoadParser,priority:Ot.Normal},name:"loadBitmapFont",id:"bitmap-font",test(s){return ju.includes(lt.extname(s).toLowerCase())},async testParse(s){return ui.test(s)||_n.test(s)},async parse(s,t,e){const i=ui.test(s)?ui.parse(s):_n.parse(s),{src:r}=t,{pages:n}=i,o=[],a=i.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let u=0;u<n.length;++u){const f=n[u].file;let d=lt.join(lt.dirname(r),f);d=Ti(d,r),o.push({src:d,data:a})}const h=await e.load(o),l=o.map(u=>h[u.src]);return new ha({data:i,textures:l},r)},async load(s,t){return await(await N.get().fetch(s)).text()},async unload(s,t,e){await Promise.all(s.pages.map(i=>e.unload(i.texture.source._sourceOrigin))),s.destroy()}};class qu{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const Ku={extension:{type:R.CacheParser,name:"cacheTextureArray"},test:s=>Array.isArray(s)&&s.every(t=>t instanceof G),getCacheableAssets:(s,t)=>{const e={};return s.forEach(i=>{t.forEach((r,n)=>{e[i+(n===0?"":n+1)]=r})}),e}};async function la(s){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=s});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(s)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const Zu={extension:{type:R.DetectionParser,priority:1},test:async()=>la("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async s=>[...s,"avif"],remove:async s=>s.filter(t=>t!=="avif")},wn=["png","jpg","jpeg"],Qu={extension:{type:R.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...wn],remove:async s=>s.filter(t=>!wn.includes(t))},Ju="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Ws(s){return Ju?!1:document.createElement("video").canPlayType(s)!==""}const td={extension:{type:R.DetectionParser,priority:0},test:async()=>Ws("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(t=>t!=="mp4"&&t!=="m4v")},ed={extension:{type:R.DetectionParser,priority:0},test:async()=>Ws("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(t=>t!=="ogv")},sd={extension:{type:R.DetectionParser,priority:0},test:async()=>Ws("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(t=>t!=="webm")},id={extension:{type:R.DetectionParser,priority:0},test:async()=>la("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async s=>[...s,"webp"],remove:async s=>s.filter(t=>t!=="webp")},ca=class ws{constructor(){this.loadOptions={...ws.defaultOptions},this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{let r=null,n=null;if((e.parser||e.loadParser)&&(n=this._parserHash[e.parser||e.loadParser],e.loadParser&&U(`[Assets] "loadParser" is deprecated, use "parser" instead for ${t}`),n||U(`[Assets] specified load parser "${e.parser||e.loadParser}" not found while loading ${t}`)),!n){for(let o=0;o<this.parsers.length;o++){const a=this.parsers[o];if(a.load&&a.test?.(t,e,this)){n=a;break}}if(!n)return U(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=await n.load(t,e,this),i.parser=n;for(let o=0;o<this.parsers.length;o++){const a=this.parsers[o];a.parse&&a.parse&&await a.testParse?.(r,e,this)&&(r=await a.parse(r,e,this)||r,i.parser=a)}return r})(),i}async load(t,e){this._parsersValidated||this._validateParsers();const i=typeof e=="function"?{...ws.defaultOptions,...this.loadOptions,onProgress:e}:{...ws.defaultOptions,...this.loadOptions,...e||{}},{onProgress:r,onError:n,strategy:o,retryCount:a,retryDelay:h}=i;let l=0;const c={},u=Ts(t),f=yt(t,y=>({alias:[y],src:y,data:{}})),d=f.reduce((y,g)=>y+(g.progressSize||1),0),p=f.map(async y=>{const g=lt.toAbsolute(y.src);c[y.src]||(await this._loadAssetWithRetry(g,y,{onProgress:r,onError:n,strategy:o,retryCount:a,retryDelay:h},c),l+=y.progressSize||1,r&&r(l/d))});return await Promise.all(p),u?c[f[0].src]:c}async unload(t){const i=yt(t,r=>({alias:[r],src:r})).map(async r=>{const n=lt.toAbsolute(r.src),o=this.promiseCache[n];if(o){const a=await o.promise;delete this.promiseCache[n],await o.parser?.unload?.(a,r,this)}});await Promise.all(i)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name||t.id).reduce((t,e)=>(!e.name&&!e.id?U("[Assets] parser should have an id"):(t[e.name]||t[e.id])&&U(`[Assets] parser id conflict "${e.id}"`),t[e.name]=e,e.id&&(t[e.id]=e),t),{})}async _loadAssetWithRetry(t,e,i,r){let n=0;const{onError:o,strategy:a,retryCount:h,retryDelay:l}=i,c=u=>new Promise(f=>setTimeout(f,u));for(;;)try{this.promiseCache[t]||(this.promiseCache[t]=this._getLoadPromiseAndParser(t,e)),r[e.src]=await this.promiseCache[t].promise;return}catch(u){delete this.promiseCache[t],delete r[e.src],n++;const f=a!=="retry"||n>h;if(a==="retry"&&!f){o&&o(u,e),await c(l);continue}if(a==="skip"){o&&o(u,e);return}throw o&&o(u,e),new Error(`[Loader.load] Failed to load ${t}.
${u}`)}}};ca.defaultOptions={onProgress:void 0,onError:void 0,strategy:"throw",retryCount:3,retryDelay:250};let rd=ca;function ge(s,t){if(Array.isArray(t)){for(const e of t)if(s.startsWith(`data:${e}`))return!0;return!1}return s.startsWith(`data:${t}`)}function me(s,t){const e=s.split("?")[0],i=lt.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const nd=".json",od="application/json",ad={extension:{type:R.LoadParser,priority:Ot.Low},name:"loadJson",id:"json",test(s){return ge(s,od)||me(s,nd)},async load(s){return await(await N.get().fetch(s)).json()}},hd=".txt",ld="text/plain",cd={name:"loadTxt",id:"text",extension:{type:R.LoadParser,priority:Ot.Low,name:"loadTxt"},test(s){return ge(s,ld)||me(s,hd)},async load(s){return await(await N.get().fetch(s)).text()}},ud=["normal","bold","100","200","300","400","500","600","700","800","900"],dd=[".ttf",".otf",".woff",".woff2"],fd=["font/ttf","font/otf","font/woff","font/woff2"],pd=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function gd(s){const t=lt.extname(s),r=lt.basename(s,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let n=r.length>0;for(const a of r)if(!a.match(pd)){n=!1;break}let o=r.join(" ");return n||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const md=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function yd(s){return md.test(s)?s:encodeURI(s)}const xd={extension:{type:R.LoadParser,priority:Ot.Low},name:"loadWebFont",id:"web-font",test(s){return ge(s,fd)||me(s,dd)},async load(s,t){const e=N.get().getFontFaceSet();if(e){const i=[],r=t.data?.family??gd(s),n=t.data?.weights?.filter(a=>ud.includes(a))??["normal"],o=t.data??{};for(let a=0;a<n.length;a++){const h=n[a],l=new FontFace(r,`url(${yd(s)})`,{...o,weight:h});await l.load(),e.add(l),i.push(l)}return $.has(`${r}-and-url`)?$.get(`${r}-and-url`).entries.push({url:s,faces:i}):$.set(`${r}-and-url`,{entries:[{url:s,faces:i}]}),i.length===1?i[0]:i}return U("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){const t=Array.isArray(s)?s:[s],e=t[0].family,i=$.get(`${e}-and-url`),r=i.entries.find(n=>n.faces.some(o=>t.indexOf(o)!==-1));r.faces=r.faces.filter(n=>t.indexOf(n)===-1),r.faces.length===0&&(i.entries=i.entries.filter(n=>n!==r)),t.forEach(n=>{N.get().getFontFaceSet().delete(n)}),i.entries.length===0&&$.remove(`${e}-and-url`)}};function Ji(s,t=1){const e=pe.RETINA_PREFIX?.exec(s);return e?parseFloat(e[1]):t}function tr(s,t,e){s.label=e,s._sourceOrigin=e;const i=new G({source:s,label:e}),r=()=>{delete t.promiseCache[e],$.has(e)&&$.remove(e)};return i.source.once("destroy",()=>{t.promiseCache[e]&&(U("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),r())}),i.once("destroy",()=>{s.destroyed||(U("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),r())}),i}const _d=".svg",wd="image/svg+xml",bd={extension:{type:R.LoadParser,priority:Ot.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(s){return ge(s,wd)||me(s,_d)},async load(s,t,e){return t.data?.parseAsGraphicsContext??this.config.parseAsGraphicsContext?vd(s):Ad(s,t,e,this.config.crossOrigin)},unload(s){s.destroy(!0)}};async function Ad(s,t,e,i){const r=await N.get().fetch(s),n=N.get().createImage();n.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await r.text())}`,n.crossOrigin=i,await n.decode();const o=t.data?.width??n.width,a=t.data?.height??n.height,h=t.data?.resolution||Ji(s),l=Math.ceil(o*h),c=Math.ceil(a*h),u=N.get().createCanvas(l,c),f=u.getContext("2d");f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(n,0,0,o*h,a*h);const{parseAsGraphicsContext:d,...p}=t.data??{},y=new Kt({resource:u,alphaMode:"premultiply-alpha-on-upload",resolution:h,...p});return tr(y,e,s)}async function vd(s){const e=await(await N.get().fetch(s)).text(),i=new ct;return i.svg(e),i}const Sd=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let ie=null,Di=class{constructor(){ie||(ie=URL.createObjectURL(new Blob([Sd],{type:"application/javascript"}))),this.worker=new Worker(ie)}};Di.revokeObjectURL=function(){ie&&(URL.revokeObjectURL(ie),ie=null)};const Cd=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let re=null;class ua{constructor(){re||(re=URL.createObjectURL(new Blob([Cd],{type:"application/javascript"}))),this.worker=new Worker(re)}}ua.revokeObjectURL=function(){re&&(URL.revokeObjectURL(re),re=null)};let bn=0,di;class Pd{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new Di;e.addEventListener("message",i=>{e.terminate(),Di.revokeObjectURL(),t(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t,e){return this._run("loadImageBitmap",[t,e?.data?.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){di===void 0&&(di=navigator.hardwareConcurrency||4);let t=this._workerPool.pop();return!t&&this._createdWorkers<di&&(this._createdWorkers++,t=new ua().worker,t.addEventListener("message",e=>{this._complete(e.data),this._returnWorker(e.target),this._next()})),t}_returnWorker(t){this._workerPool.push(t)}_complete(t){this._resolveHash[t.uuid]&&(t.error!==void 0?this._resolveHash[t.uuid].reject(t.error):this._resolveHash[t.uuid].resolve(t.data),delete this._resolveHash[t.uuid])}async _run(t,e){await this._initWorkers();const i=new Promise((r,n)=>{this._queue.push({id:t,arguments:e,resolve:r,reject:n})});return this._next(),i}_next(){if(!this._queue.length)return;const t=this._getWorker();if(!t)return;const e=this._queue.pop(),i=e.id;this._resolveHash[bn]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:bn++,id:i})}reset(){this._workerPool.forEach(t=>t.terminate()),this._workerPool.length=0,Object.values(this._resolveHash).forEach(({reject:t})=>{t?.(new Error("WorkerManager has been reset before completion"))}),this._resolveHash={},this._queue.length=0,this._initialized=!1,this._createdWorkers=0}}const An=new Pd,Td=[".jpeg",".jpg",".png",".webp",".avif"],kd=["image/jpeg","image/png","image/webp","image/avif"];async function Md(s,t){const e=await N.get().fetch(s);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${e.status} ${e.statusText}`);const i=await e.blob();return t?.data?.alphaMode==="premultiplied-alpha"?createImageBitmap(i,{premultiplyAlpha:"none"}):createImageBitmap(i)}const da={name:"loadTextures",id:"texture",extension:{type:R.LoadParser,priority:Ot.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return ge(s,kd)||me(s,Td)},async load(s,t,e){let i=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await An.isImageBitmapSupported()?i=await An.loadImageBitmap(s,t):i=await Md(s,t):i=await new Promise((n,o)=>{i=N.get().createImage(),i.crossOrigin=this.config.crossOrigin,i.src=s,i.complete?n(i):(i.onload=()=>{n(i)},i.onerror=o)});const r=new Kt({resource:i,alphaMode:"premultiply-alpha-on-upload",resolution:t.data?.resolution||Ji(s),...t.data});return tr(r,e,s)},unload(s){s.destroy(!0)}},Ed=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"];let fi,pi;function Id(s,t,e){e===void 0&&!t.startsWith("data:")?s.crossOrigin=Bd(t):e!==!1&&(s.crossOrigin=typeof e=="string"?e:"anonymous")}function Rd(s){return new Promise((t,e)=>{s.addEventListener("canplaythrough",i),s.addEventListener("error",r),s.load();function i(){n(),t()}function r(o){n(),e(o)}function n(){s.removeEventListener("canplaythrough",i),s.removeEventListener("error",r)}})}function Bd(s,t=globalThis.location){if(s.startsWith("data:"))return"";t||(t=globalThis.location);const e=new URL(s,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Fd(){const s=[],t=[];for(const e of Ed){const i=Oe.MIME_TYPES[e.substring(1)]||`video/${e.substring(1)}`;Ws(i)&&(s.push(e),t.includes(i)||t.push(i))}return{validVideoExtensions:s,validVideoMime:t}}const Ld={name:"loadVideo",id:"video",extension:{type:R.LoadParser,name:"loadVideo"},test(s){if(!fi||!pi){const{validVideoExtensions:i,validVideoMime:r}=Fd();fi=i,pi=r}const t=ge(s,pi),e=me(s,fi);return t||e},async load(s,t,e){const i={...Oe.defaultOptions,resolution:t.data?.resolution||Ji(s),alphaMode:t.data?.alphaMode||await mo(),...t.data},r=document.createElement("video"),n={preload:i.autoLoad!==!1?"auto":void 0,"webkit-playsinline":i.playsinline!==!1?"":void 0,playsinline:i.playsinline!==!1?"":void 0,muted:i.muted===!0?"":void 0,loop:i.loop===!0?"":void 0,autoplay:i.autoPlay!==!1?"":void 0};Object.keys(n).forEach(h=>{const l=n[h];l!==void 0&&r.setAttribute(h,l)}),i.muted===!0&&(r.muted=!0),Id(r,s,i.crossorigin);const o=document.createElement("source");let a;if(i.mime)a=i.mime;else if(s.startsWith("data:"))a=s.slice(5,s.indexOf(";"));else if(!s.startsWith("blob:")){const h=s.split("?")[0].slice(s.lastIndexOf(".")+1).toLowerCase();a=Oe.MIME_TYPES[h]||`video/${h}`}return o.src=s,a&&(o.type=a),new Promise(h=>{const l=async()=>{const c=new Oe({...i,resource:r});r.removeEventListener("canplay",l),t.data.preload&&await Rd(r),h(tr(c,e,s))};i.preload&&!i.autoPlay&&r.load(),r.addEventListener("canplay",l),r.appendChild(o)})},unload(s){s.destroy(!0)}},fa={extension:{type:R.ResolveParser,name:"resolveTexture"},test:da.test,parse:s=>({resolution:parseFloat(pe.RETINA_PREFIX.exec(s)?.[1]??"1"),format:s.split(".").pop(),src:s})},Gd={extension:{type:R.ResolveParser,priority:-2,name:"resolveJson"},test:s=>pe.RETINA_PREFIX.test(s)&&s.endsWith(".json"),parse:fa.parse};class Od{constructor(){this._detections=[],this._initialized=!1,this.resolver=new pe,this.loader=new rd,this.cache=$,this._backgroundLoader=new qu(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized){U("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let n=t.manifest;typeof n=="string"&&(n=await this.load(n)),this.resolver.addManifest(n)}const e=t.texturePreference?.resolution??1,i=typeof e=="number"?[e]:e,r=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:r,resolution:i}}),t.preferences&&this.setPreferences(t.preferences),t.loadOptions&&(this.loader.loadOptions={...this.loader.loadOptions,...t.loadOptions})}add(t){this.resolver.add(t)}async load(t,e){this._initialized||await this.init();const i=Ts(t),r=yt(t).map(a=>{if(typeof a!="string"){const h=this.resolver.getAlias(a);return h.some(l=>!this.resolver.hasKey(l))&&this.add(a),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),n=this.resolver.resolve(r),o=await this._mapLoadToResolve(n,e);return i?o[r[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const r=this.resolver.resolveBundle(t),n={},o=Object.keys(r);let a=0;const h=[],l=()=>{e?.(h.reduce((u,f)=>u+f,0)/a)},c=o.map((u,f)=>{const d=r[u],p=Object.values(d),g=[...new Set(p.flat())].reduce((x,_)=>x+(_.progressSize||1),0);return h.push(0),a+=g,this._mapLoadToResolve(d,x=>{h[f]=x*g,l()}).then(x=>{n[u]=x})});return await Promise.all(c),i?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return $.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=$.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=[...new Set(Object.values(t))];this._backgroundLoader.active=!1;const r=await this.loader.load(i,e);this._backgroundLoader.active=!0;const n={};return i.forEach(o=>{const a=r[o.src],h=[o.src];o.alias&&h.push(...o.alias),h.forEach(l=>{n[l]=a}),$.set(h,a)}),n}async unload(t){this._initialized||await this.init();const e=yt(t).map(r=>typeof r!="string"?r.src:r),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=yt(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(r=>this._unloadFromResolved(e[r]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{$.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,r)=>e.indexOf(i)===r),e}get detections(){return this._detections}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}}const Be=new Od;tt.handleByList(R.LoadParser,Be.loader.parsers).handleByList(R.ResolveParser,Be.resolver.parsers).handleByList(R.CacheParser,Be.cache.parsers).handleByList(R.DetectionParser,Be.detections);tt.add(Ku,Qu,Zu,id,td,ed,sd,ad,cd,xd,bd,da,Ld,Xu,Yu,fa,Gd);const vn={loader:R.LoadParser,resolver:R.ResolveParser,cache:R.CacheParser,detection:R.DetectionParser};tt.handle(R.Asset,s=>{const t=s.ref;Object.entries(vn).filter(([e])=>!!t[e]).forEach(([e,i])=>tt.add(Object.assign(t[e],{extension:t[e].extension??i})))},s=>{const t=s.ref;Object.keys(vn).filter(e=>!!t[e]).forEach(e=>tt.remove(t[e]))});class ue extends Ui{constructor(t){t instanceof ct&&(t={context:t});const{context:e,roundPixels:i,...r}=t||{};super({label:"Graphics",...r}),this.renderPipeId="graphics",e?this._context=e:this._context=this._ownedContext=new ct,this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=i??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||t?.context===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new ue(this._context.clone()):(this._ownedContext=null,new ue(this._context))}lineStyle(t,e,i){B(D,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const r={};return t&&(r.width=t),e&&(r.color=e),i&&(r.alpha=i),this.context.strokeStyle=r,this}beginFill(t,e){B(D,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const i={};return t!==void 0&&(i.color=t),e!==void 0&&(i.alpha=e),this.context.fillStyle=i,this}endFill(){B(D,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==ct.defaultStrokeStyle.width||t.color!==ct.defaultStrokeStyle.color||t.alpha!==ct.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return B(D,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return B(D,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return B(D,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return B(D,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return B(D,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return B(D,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}class Dd extends Ui{constructor(t,e){const{text:i,resolution:r,style:n,anchor:o,width:a,height:h,roundPixels:l,...c}=t;super({...c}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=e,this.text=i??"",this.style=n,this.resolution=r??null,this.allowChildren=!1,this._anchor=new J({_onUpdate:()=>{this.onViewUpdate()}}),o&&(this.anchor=o),this.roundPixels=l??!1,a!==void 0&&(this.width=a),h!==void 0&&(this.height=h)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}set text(t){t=t.toString(),this._text!==t&&(this._text=t,this.onViewUpdate())}get text(){return this._text}set resolution(t){this._autoResolution=t===null,this._resolution=t,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(t){t||(t={}),this._style?.off("update",this.onViewUpdate,this),t instanceof this._styleClass?this._style=t:this._style=new this._styleClass(t),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(t){this._setWidth(t,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(t){this._setHeight(t,this.bounds.height)}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this.bounds.width,t.height=Math.abs(this.scale.y)*this.bounds.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this.bounds.width),e!==void 0&&this._setHeight(e,this.bounds.height)}containsPoint(t){const e=this.bounds.width,i=this.bounds.height,r=-e*this.anchor.x;let n=0;return t.x>=r&&t.x<=r+e&&(n=-i*this.anchor.y,t.y>=n&&t.y<=n+i)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}destroy(t=!1){super.destroy(t),this.owner=null,this._bounds=null,this._anchor=null,(typeof t=="boolean"?t:t?.style)&&this._style.destroy(t),this._style=null,this._text=null}get styleKey(){return`${this._text}:${this._style.styleKey}:${this._resolution}`}}function zd(s,t){let e=s[0]??{};return(typeof e=="string"||s[1])&&(B(D,`use new ${t}({ text: "hi!", style }) instead`),e={text:e,style:s[1]}),e}let Ut=null,Tt=null;function Wd(s,t){Ut||(Ut=N.get().createCanvas(256,128),Tt=Ut.getContext("2d",{willReadFrequently:!0}),Tt.globalCompositeOperation="copy",Tt.globalAlpha=1),(Ut.width<s||Ut.height<t)&&(Ut.width=ae(s),Ut.height=ae(t))}function Sn(s,t,e){for(let i=0,r=4*e*t;i<t;++i,r+=4)if(s[r+3]!==0)return!1;return!0}function Cn(s,t,e,i,r){const n=4*t;for(let o=i,a=i*n+4*e;o<=r;++o,a+=n)if(s[a+3]!==0)return!1;return!0}function Nd(...s){let t=s[0];t.canvas||(t={canvas:s[0],resolution:s[1]});const{canvas:e}=t,i=Math.min(t.resolution??1,1),r=t.width??e.width,n=t.height??e.height;let o=t.output;if(Wd(r,n),!Tt)throw new TypeError("Failed to get canvas 2D context");Tt.drawImage(e,0,0,r,n,0,0,r*i,n*i);const h=Tt.getImageData(0,0,r,n).data;let l=0,c=0,u=r-1,f=n-1;for(;c<n&&Sn(h,r,c);)++c;if(c===n)return j.EMPTY;for(;Sn(h,r,f);)--f;for(;Cn(h,r,l,c,f);)++l;for(;Cn(h,r,u,c,f);)--u;return++u,++f,Tt.globalCompositeOperation="source-over",Tt.strokeRect(l,c,u-l,f-c),Tt.globalCompositeOperation="copy",o??(o=new j),o.set(l/i,c/i,(u-l)/i,(f-c)/i),o}const Pn=new j;class $d{getCanvasAndContext(t){const{text:e,style:i,resolution:r=1}=t,n=i._getFinalPadding(),o=St.measureText(e||" ",i),a=Math.ceil(Math.ceil(Math.max(1,o.width)+n*2)*r),h=Math.ceil(Math.ceil(Math.max(1,o.height)+n*2)*r),l=Xe.getOptimalCanvasAndContext(a,h);this._renderTextToCanvas(e,i,n,r,l);const c=i.trim?Nd({canvas:l.canvas,width:a,height:h,resolution:1,output:Pn}):Pn.set(0,0,a,h);return{canvasAndContext:l,frame:c}}returnCanvasAndContext(t){Xe.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,i,r,n){const{canvas:o,context:a}=n,h=ks(e),l=St.measureText(t||" ",e),c=l.lines,u=l.lineHeight,f=l.lineWidths,d=l.maxLineWidth,p=l.fontProperties,y=o.height;if(a.resetTransform(),a.scale(r,r),a.textBaseline=e.textBaseline,e._stroke?.width){const m=e._stroke;a.lineWidth=m.width,a.miterLimit=m.miterLimit,a.lineJoin=m.join,a.lineCap=m.cap}a.font=h;let g,x;const _=e.dropShadow?2:1;for(let m=0;m<_;++m){const w=e.dropShadow&&m===0,v=w?Math.ceil(Math.max(1,y)+i*2):0,b=v*r;if(w){a.fillStyle="black",a.strokeStyle="black";const C=e.dropShadow,P=C.color,k=C.alpha;a.shadowColor=Y.shared.setValue(P).setAlpha(k).toRgbaString();const z=C.blur*r,O=C.distance*r;a.shadowBlur=z,a.shadowOffsetX=Math.cos(C.angle)*O,a.shadowOffsetY=Math.sin(C.angle)*O+b}else{if(a.fillStyle=e._fill?Is(e._fill,a,l,i*2):null,e._stroke?.width){const C=e._stroke.width*.5+i*2;a.strokeStyle=Is(e._stroke,a,l,C)}a.shadowColor="black"}let A=(u-p.fontSize)/2;u-p.fontSize<0&&(A=0);const I=e._stroke?.width??0;for(let C=0;C<c.length;C++)g=I/2,x=I/2+C*u+p.ascent+A,e.align==="right"?g+=d-f[C]:e.align==="center"&&(g+=(d-f[C])/2),e._stroke?.width&&this._drawLetterSpacing(c[C],e,n,g+i,x+i-v,!0),e._fill!==void 0&&this._drawLetterSpacing(c[C],e,n,g+i,x+i-v)}}_drawLetterSpacing(t,e,i,r,n,o=!1){const{context:a}=i,h=e.letterSpacing;let l=!1;if(St.experimentalLetterSpacingSupported&&(St.experimentalLetterSpacing?(a.letterSpacing=`${h}px`,a.textLetterSpacing=`${h}px`,l=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px")),h===0||l){o?a.strokeText(t,r,n):a.fillText(t,r,n);return}let c=r;const u=St.graphemeSegmenter(t);let f=a.measureText(t).width,d=0;for(let p=0;p<u.length;++p){const y=u[p];o?a.strokeText(y,c,n):a.fillText(y,c,n);let g="";for(let x=p+1;x<u.length;++x)g+=u[x];d=a.measureText(g).width,c+=f-d+h,f=d}}}const Tn=new $d;class kn extends Dd{constructor(...t){const e=zd(t,"Text");super(e,Ye),this.renderPipeId="text",e.textureStyle&&(this.textureStyle=e.textureStyle instanceof he?e.textureStyle:new he(e.textureStyle))}updateBounds(){const t=this._bounds,e=this._anchor;let i=0,r=0;if(this._style.trim){const{frame:n,canvasAndContext:o}=Tn.getCanvasAndContext({text:this.text,style:this._style,resolution:1});Tn.returnCanvasAndContext(o),i=n.width,r=n.height}else{const n=St.measureText(this._text,this._style);i=n.width,r=n.height}t.minX=-e._x*i,t.maxX=t.minX+i,t.minY=-e._y*r,t.maxY=t.minY+r}}tt.add(qa,Ka);const zi=Symbol("store-raw"),ne=Symbol("store-node"),kt=Symbol("store-has"),pa=Symbol("store-self");function ga(s){let t=s[qt];if(!t&&(Object.defineProperty(s,qt,{value:t=new Proxy(s,Vd)}),!Array.isArray(s))){const e=Object.keys(s),i=Object.getOwnPropertyDescriptors(s);for(let r=0,n=e.length;r<n;r++){const o=e[r];i[o].get&&Object.defineProperty(s,o,{enumerable:i[o].enumerable,get:i[o].get.bind(t)})}}return t}function Rs(s){let t;return s!=null&&typeof s=="object"&&(s[qt]||!(t=Object.getPrototypeOf(s))||t===Object.prototype||Array.isArray(s))}function qe(s,t=new Set){let e,i,r,n;if(e=s!=null&&s[zi])return e;if(!Rs(s)||t.has(s))return s;if(Array.isArray(s)){Object.isFrozen(s)?s=s.slice(0):t.add(s);for(let o=0,a=s.length;o<a;o++)r=s[o],(i=qe(r,t))!==r&&(s[o]=i)}else{Object.isFrozen(s)?s=Object.assign({},s):t.add(s);const o=Object.keys(s),a=Object.getOwnPropertyDescriptors(s);for(let h=0,l=o.length;h<l;h++)n=o[h],!a[n].get&&(r=s[n],(i=qe(r,t))!==r&&(s[n]=i))}return s}function Bs(s,t){let e=s[t];return e||Object.defineProperty(s,t,{value:e=Object.create(null)}),e}function Ke(s,t,e){if(s[t])return s[t];const[i,r]=de(e,{equals:!1,internal:!0});return i.$=r,s[t]=i}function Ud(s,t){const e=Reflect.getOwnPropertyDescriptor(s,t);return!e||e.get||!e.configurable||t===qt||t===ne||(delete e.value,delete e.writable,e.get=()=>s[qt][t]),e}function ma(s){mi()&&Ke(Bs(s,ne),pa)()}function Hd(s){return ma(s),Reflect.ownKeys(s)}const Vd={get(s,t,e){if(t===zi)return s;if(t===qt)return e;if(t===gi)return ma(s),e;const i=Bs(s,ne),r=i[t];let n=r?r():s[t];if(t===ne||t===kt||t==="__proto__")return n;if(!r){const o=Object.getOwnPropertyDescriptor(s,t);mi()&&(typeof n!="function"||s.hasOwnProperty(t))&&!(o&&o.get)&&(n=Ke(i,t,n)())}return Rs(n)?ga(n):n},has(s,t){return t===zi||t===qt||t===gi||t===ne||t===kt||t==="__proto__"?!0:(mi()&&Ke(Bs(s,kt),t)(),t in s)},set(){return!0},deleteProperty(){return!0},ownKeys:Hd,getOwnPropertyDescriptor:Ud};function Fs(s,t,e,i=!1){if(!i&&s[t]===e)return;const r=s[t],n=s.length;e===void 0?(delete s[t],s[kt]&&s[kt][t]&&r!==void 0&&s[kt][t].$()):(s[t]=e,s[kt]&&s[kt][t]&&r===void 0&&s[kt][t].$());let o=Bs(s,ne),a;if((a=Ke(o,t,r))&&a.$(()=>e),Array.isArray(s)&&s.length!==n){for(let h=s.length;h<n;h++)(a=o[h])&&a.$();(a=Ke(o,"length",n))&&a.$(s.length)}(a=o[pa])&&a.$()}function ya(s,t){const e=Object.keys(t);for(let i=0;i<e.length;i+=1){const r=e[i];Fs(s,r,t[r])}}function jd(s,t){if(typeof t=="function"&&(t=t(s)),t=qe(t),Array.isArray(t)){if(s===t)return;let e=0,i=t.length;for(;e<i;e++){const r=t[e];s[e]!==r&&Fs(s,e,r)}Fs(s,"length",i)}else ya(s,t)}function Fe(s,t,e=[]){let i,r=s;if(t.length>1){i=t.shift();const o=typeof i,a=Array.isArray(s);if(Array.isArray(i)){for(let h=0;h<i.length;h++)Fe(s,[i[h]].concat(t),e);return}else if(a&&o==="function"){for(let h=0;h<s.length;h++)i(s[h],h)&&Fe(s,[h].concat(t),e);return}else if(a&&o==="object"){const{from:h=0,to:l=s.length-1,by:c=1}=i;for(let u=h;u<=l;u+=c)Fe(s,[u].concat(t),e);return}else if(t.length>1){Fe(s[i],t,[i].concat(e));return}r=s[i],e=[i].concat(e)}let n=t[0];typeof n=="function"&&(n=n(r,e),n===r)||i===void 0&&n==null||(n=qe(n),i===void 0||Rs(r)&&Rs(n)&&!Array.isArray(n)?ya(r,n):Fs(s,i,n))}function Yd(...[s,t]){const e=qe(s||{}),i=Array.isArray(e),r=ga(e);function n(...o){Ta(()=>{i&&o.length===1?jd(e,o[0]):Fe(e,o)})}return[r,n]}function Xd(){let s=null,t=[];const[e,i]=de(null),[r,n]=Yd({messages:[],pendingChoice:null}),o=p=>{s=p},a=p=>{n("messages",y=>[...y,p])},h=p=>{const y=()=>p;n("messages",g=>[...g,y])},l=()=>{t.forEach(p=>p.remove()),t=[]},c=()=>{if(!s)return;l();const p=m=>()=>{const w=e(),v=r.pendingChoice?.options.length??0;v>0&&i(w===null?m===1?0:v-1:(w+m+v)%v)},y=p(-1),g=p(1),x=()=>{const m=e();if(m!==null&&r.pendingChoice){const w=r.pendingChoice.options[m];d(w)}return!0},_=(m,w)=>{m.forEach(v=>{const b=s.bind(v,w);t.push(b)})};_(["w","W","a","A","ArrowUp","ArrowLeft"],y),_(["s","S","d","D","ArrowDown","ArrowRight"],g),_([" "],x)},u=async(...p)=>(s?.lock(),new Promise(y=>{n("pendingChoice",{options:p,resolve:y}),c()})),f=()=>{n("messages",[])},d=p=>{r.pendingChoice&&(r.pendingChoice.resolve(p),n("pendingChoice",null),i(null),l(),s?.unlock())};return{write:h,writeHTML:a,showButtons:u,clear:f,attachInputHandler:o,getMessages:()=>r.messages,getPendingChoice:()=>r.pendingChoice,onButtonClick:d,getHighlightedOption:e}}function qd(){const s=new Set,t=new Set;let e=!1,i=[];const r=d=>{if(d.repeat)return;s.add(d.key);let p=!1;i=i.filter(y=>y.key!==d.key?!0:(p=!0,!y.callback())),p||t.add(d.key)},n=d=>{s.delete(d.key)},o=()=>{window.addEventListener("keydown",r),window.addEventListener("keyup",n)},a=d=>!e&&s.has(d),h=d=>{if(e)return!1;const p=t.has(d);return t.delete(d),p},l=()=>{e=!0},c=()=>{e=!1},u=()=>{window.removeEventListener("keydown",r),window.removeEventListener("keyup",n)},f=(d,p)=>{const y={key:d,callback:p};return i.push(y),{remove:()=>{const g=i.indexOf(y);g!==-1&&i.splice(g,1)}}};return o(),{isKeyPressed:a,consumeKeyPress:h,lock:l,unlock:c,destroy:u,bind:f}}const er=(s,t)=>`/Three_Cow_Problem/art/${t}/${s}`,Kd=s=>{const[t,e]=de(void 0);return{get:()=>t(),goTo:n=>{t()?.onLeave?.(s),e(n(s)),s.avatar.get().onEnterRoom?.(s);for(const o of t().objects)o.onEnterRoom?.(s);t().onEnter?.(s)}}},Zd=async s=>{const t=[s.avatar.get(),...s.room.get().objects];for(const e of t)if(e.getAssetPaths){const i=e.getAssetPaths().map(r=>er(r,s.gameName));await Be.load(i)}},Qd=s=>Object.assign(s,{__sigil:"StaticOrResetRoom"});var Jd=Ct("<div><div class=split-panel-child></div><div class=split-panel-child>");const xa=s=>{const t=s.type,e=`${s.percent}%`,i=`${100-s.percent}%`;return(()=>{var r=Jd(),n=r.firstChild,o=n.nextSibling;return Va(r,`split-panel split-panel-${t}`),rt(n,"--size",e),mt(n,()=>s.children[0]),rt(o,"--size",i),mt(o,()=>s.children[1]),r})()},tf=()=>{const[s,t]=de(null);return{set:r=>{t(()=>r)},get:()=>{const r=s();return r?ot(r,{}):null}}},ef=(s,t,e)=>i=>ot(xa,{type:"v",percent:s,get children(){return[ot(t,{}),ot(e,{})]}}),sf=(s,t,e)=>i=>ot(xa,{type:"h",percent:s,get children(){return[ot(t,{}),ot(e,{})]}}),rf=s=>{let t=s;return{set:r=>{t=r},get:()=>t}},_a=Ma(),nf=s=>ot(_a.Provider,{get value(){return s.value},get children(){return s.children}}),sr=()=>{const s=Ea(_a);if(!s)throw new Error("tried to get game context outside of game context provider");return s},ft={fromFile:(s,t,e,i,r)=>({type:"fromFile",path:s,scale:t,flipped:i,isStatic:r,anchor:e,flip:()=>ft.fromFile(s,t,e,!i,r),static:()=>ft.fromFile(s,t,e,i,!0),setAnchor:h=>ft.fromFile(s,t,h,i,r)}),circle:(s,t,e)=>({type:"circle",radius:s,label:t,isStatic:e,static:()=>ft.circle(s,t,!0)})},Mn=(s="BottomCenter")=>{let t=.5,e=.5;return s.includes("Left")?t=0:s.includes("Right")&&(t=1),s.includes("Top")?e=0:s.includes("Bottom")&&(e=1),[t,e]},En=(s,t,e,i,r)=>{switch(s.type){case"circle":{let n=t.children[0];if((!n||!(n instanceof ue))&&(t.removeChildren(),n=new ue,t.addChild(n)),n.clear(),n.circle(0,0,s.radius).fill(e),n.circle(0,0,s.radius).stroke({width:2,color:i}),s.label){let o=t.children[1];!o||!(o instanceof kn)?(o=new kn({text:s.label,style:{fontSize:14,fill:i}}),o.anchor.set(.5,.5),t.children.length>1&&t.removeChildAt(1),t.addChild(o)):(o.text=s.label,o.style.fill=i)}else t.children.length>1&&t.removeChildAt(1);break}case"fromFile":{const n=er(s.path,r);let o=t.children[0],a=t._cachedPath;if(!o||!(o instanceof Ge)){t.removeChildren(),o=Ge.from(n);const[f,d]=Mn(s.anchor);o.anchor.set(f,d),o.texture.source.scaleMode="nearest",t.addChild(o),t._cachedPath=n}else a!==n&&(o.texture=Ge.from(n).texture,o.texture.source.scaleMode="nearest",t._cachedPath=n);const[h,l]=Mn(s.anchor);o.anchor.set(h,l);const c=s.scale??1,u=s.flipped?-c:c;o.scale.set(u,c);break}}};var of=Ct("<div class=panel><div>");const af=()=>{const s=sr();let t;return ka(async()=>{await Zd(s);const e=new Wo;await e.init({resizeTo:t,backgroundColor:0,resolution:window.devicePixelRatio*2,autoDensity:!0}),e.ticker.maxFPS=60,t.appendChild(e.canvas);const i=new dt;e.stage.addChild(i);const r=new dt;e.stage.addChild(r);const n=new ue;r.addChild(n);const o=new Map,a=new Map;let h=0;e.ticker.add(()=>{const l=s.color.getDark(),c=s.color.getLight();e.renderer.background.color=l;const u=e.screen.width,d=e.screen.height-50,p=s.room.get(),y=p.sideviewGfx;if(y){const w=p.avatarPosition.x,b=(y.scrollDeadzone??50)/100*u,A=u/2-b/2,I=u/2+b/2,C=w-h;C<A?h=w-A:C>I&&(h=w-I),h=Math.max(0,Math.min(h,y.width-u))}let g=-h;y&&y.width<u&&(g=(u-y.width)/2),r.x=g;const x=y?.width??u;n.clear(),n.moveTo(0,d),n.lineTo(x,d),n.stroke({width:2,color:c});const _=[...s.room.get().objects,s.avatar.get()],m=new Set(_);for(const[w,v]of o)m.has(w)||(r.removeChild(v),v.destroy({children:!0}),o.delete(w));for(const[w,v]of a)m.has(w)||(i.removeChild(v),v.destroy({children:!0}),a.delete(w));for(const w of _){if(!w.getSprite||!w.getX)continue;const v=w.getSprite(s);if(v.isStatic){let b=a.get(w);b||(b=new dt,a.set(w,b),i.addChild(b)),En(v,b,l,c,s.gameName);const A=w.getX(s),I=u/2;b.x=I+A/100*(u/2);const C=w.getY?w.getY(s):0,P=v.type==="circle"?v.radius:0,k=d-C-P;b.y=k}else{let b=o.get(w);b||(b=new dt,o.set(w,b),r.addChild(b)),En(v,b,l,c,s.gameName);const A=w.getY?w.getY(s):0,I=v.type==="circle"?v.radius:0,C=d-A-I;b.x=w.getX(s),b.y=C}}}),e.ticker.update(),Ln(()=>{e.destroy()})}),(()=>{var e=of(),i=e.firstChild;rt(e,"overflow","hidden"),rt(e,"padding","0");var r=t;return typeof r=="function"?Nn(r,i):t=i,rt(i,"width","100%"),rt(i,"height","100%"),e})()};var hf=Ct("<div class=buttons>"),lf=Ct("<div class=panel>"),cf=Ct("<div>"),uf=Ct("<button>");const df=()=>{const s=sr();let t;return Fn(()=>{s.log.getMessages().length,s.log.getPendingChoice(),t.scrollTop=t.scrollHeight}),(()=>{var e=lf(),i=t;return typeof i=="function"?Nn(i,e):t=e,mt(e,ot(hr,{get each(){return s.log.getMessages()},children:r=>(()=>{var n=cf();return mt(n,ot(r,{})),n})()}),null),mt(e,ot(Wa,{get when(){return s.log.getPendingChoice()},get children(){var r=hf();return mt(r,ot(hr,{get each(){return s.log.getPendingChoice().options},children:(n,o)=>(()=>{var a=uf();return a.$$click=()=>s.log.onButtonClick(n),mt(a,n),oe(()=>a.classList.toggle("hover",s.log.getHighlightedOption()===o())),a})()})),r}}),null),e})()};Ua(["click"]);const ff=()=>sr();var pf=Ct('<div class=panel style=align-items:center;justify-content:center><iframe allow="autoplay; encrypted-media"allowfullscreen title="YouTube video">');const gf=()=>{const s=ff(),t=()=>{const e=`https://www.youtube.com/embed/${s.getSlop()}`,i=new URLSearchParams({autoplay:"1",mute:"1",controls:"0"});return i.set("loop","1"),i.set("playlist",s.getSlop()),`${e}?${i.toString()}`};return(()=>{var e=pf(),i=e.firstChild;return rt(e,"padding","0"),rt(e,"height","100%"),rt(e,"width","100%"),rt(e,"overflow","hidden"),rt(e,"display","flex"),rt(i,"width","400%"),rt(i,"height","100%"),rt(i,"border","none"),oe(()=>Ha(i,"src",t())),e})()},mf=ef(25,af,sf(75,df,gf)),In=100;function yf(s=2){const t=new Set,e=(l,c)=>c.getX?Math.abs(c.getX(l)-l.room.get().avatarPosition.x):1/0,i=l=>l.room.get().avatarPosition.x,r=()=>"@",n=l=>ft.circle(30,"@"),o=async l=>{for(const c of l.room.get().objects){const u=e(l,c)<In,f=t.has(c);u!==f&&(u?(t.add(c),c.onEnterInteractRange&&await c.onEnterInteractRange(l)):(t.delete(c),c.onLeaveInteractRange&&await c.onLeaveInteractRange(l)))}};return{getX:i,getDisplayName:r,getSprite:n,processInput:(l,c)=>{let u={...c};if((l.input.isKeyPressed("a")||l.input.isKeyPressed("ArrowLeft"))&&(u.x-=s,o(l)),(l.input.isKeyPressed("d")||l.input.isKeyPressed("ArrowRight"))&&(u.x+=s,o(l)),l.input.consumeKeyPress(" ")){const p=l.room.get().objects.filter(y=>e(l,y)<In).reduce((y,g)=>!y||e(l,g)<e(l,y)?g:y,null);p?.onInteract&&p.onInteract(l)}const f=l.room.get().sideviewGfx;return f&&(u.x=Math.max(0,Math.min(u.x,f.width))),u},onEnterRoom:()=>{t.clear()}}}const wa={...yf(),getAssetPaths:()=>["cowboy.png"],getSprite:()=>ft.fromFile("cowboy.png",.2)};function xf(){const s=[];return{runTask:i=>new Promise(r=>{s.push({onTick:i,resolve:r})}),update:()=>{for(let i=s.length-1;i>=0;i--){const r=s[i];r.onTick()&&(r.resolve(),s.splice(i,1))}}}}const _f=()=>{const s=getComputedStyle(document.documentElement);let t=new Y(s.getPropertyValue("--dark").trim()),e=new Y(s.getPropertyValue("--light").trim());return{getDark:()=>t,getLight:()=>e,setDark:a=>{document.documentElement.style.setProperty("--dark",a),t=new Y(a)},setLight:a=>{document.documentElement.style.setProperty("--light",a),e=new Y(a)}}},wf=()=>{const s=new AudioContext,t=new Map;let e=null;const i=a=>{e=a.gameName},r=async a=>{if(t.has(a))return t.get(a);if(!e)throw new Error("AudioController not initialized");const h=er(a,e),c=await(await fetch(h)).arrayBuffer(),u=await s.decodeAudioData(c);return t.set(a,u),u};return{init:i,play:async(a,h=1)=>{const l=await r(a),c=s.createBufferSource();c.buffer=l;const u=s.createGain();return u.gain.value=Math.max(0,Math.min(1,h)),c.connect(u),u.connect(s.destination),c.start(0),new Promise(f=>{c.onended=()=>f()})},startLoop:(a,h=1)=>{let l=null,c=null;return r(a).then(f=>{l=s.createBufferSource(),c=s.createGain(),l.buffer=f,l.loop=!0,c.gain.value=Math.max(0,Math.min(1,h)),l.connect(c),c.connect(s.destination),l.start(0)}),{stop:()=>{l&&(l.stop(),l.disconnect()),c&&c.disconnect()}}}}};function bf(s,t){async function e(l){l.log.write(`"Yay! Let's hit the hay. We've got a big day ahead of us."`),l.log.write('"Goodnight, Tessie."')}async function i(l){l.log.write(`"Fine! I'll do it myself. Then you'll see!"`)}async function r(l){return l.log.write(`"No it's not! think about it. small fire. relaxing. Big fire. SOOO COZY."`),await a(l)}async function n(l){return l.log.write('"Thank you. I know"'),await a(l)}async function o(l){return l.log.write('"That was nice. The fire is so relaxing.... We should burn down the saloon tomorrow."'),await t(l,'...Wait what?"','"Excuse me?"',`"What in tarnation'?`),l.log.write('"This fire is so nice. I just think a bigger one would be even nicer."'),await s(l,"That's the craziest thing I've ever heard","Tessie, You're a genius.")?await r(l):await n(l)}async function a(l){return l.log.write('"Soooooo?"'),await s(l,"So what?",`"I'm in."`)?await h(l):await e(l)}async function h(l){return l.log.write(`"So are you gonna do it? For li'l ol mee?"`),await s(l,'"No. Tessie? look at me. No."','"Fine, if it will get you to to sleep"')?await i(l):await e(l)}return o}var Af=Ct("<span style=margin-left:20px>");const vf=(s,t)=>{s.log.writeHTML(()=>(()=>{var e=Af();return mt(e,t),e})())};function Sf(s,t){async function e(m){return vf(m,'"Okay here we go... Once upon a Time there was a little Cow named Jack who lived with her mom. They were both very poor, and their only possesion was an unnamed old woman. Jacks mom sent her to the market to sell the old woman, for whatever she could get so that they would have money to pay for their streaming services. At the market she decided to sell the old woman for the price of three magic beans. Now normally that would be an excellent deal, but Jacks mother had a deadly magical legume allergy.  When Jack got home, her mother threw the beans out the window, and had to go to the ER. When they got back the next morning there was a giant beanstalk in their yard where Mrs.Jack threw the beans. Jack had a penchant for climbing due to probably goat ancestry, and immediately climbed to the very top. At the top of the Beanstalk lived a sky-whale who ate cows (can you imagine?). The sky-whale had a massive high yield savings account left to her by her exceedingly rich sky-parents, and would use the funds to pay off the police and media so she could swoop down from the sky in the dead of night to steal calves to feed her cow eating habit. All in all she was very bad. Jack, being in on this open secret, felt it completely justified to steal the login info for said savings account from the little sticky note the sky-whale left on her computer monitor. In a few short weeks Jack and her mother were living in a Luxembourg mansion with their newfound wealth, where they lived happily ever after. The end."'),m.log.write('"That story always makes me feel so happy... We should rob the bank."'),await t(m,'Oh my God..."','"not you too..."','"Fried flapjacks on rainy morning, whats gotten into you guys?'),m.log.write('"What? Its an inspirational tale!"'),await s(m,'"NO. No more crimes. No bank robbery."','"Ugh. Youre not wrong."')?await u(m):await n(m)}async function i(m){return m.log.write('"You know that song makes me scared to cross bridges."'),await s(m,'"How about Goldicow and the three additional cows?"','"How about Jack (who is a cow) and the Beanstalk. (a-gosh-ding-dang-gain)"')?await f(m):await _(m)}async function r(m){return m.log.write('"No... Can I get a bedtime story?"'),await y(m)}async function n(m){m.log.write('"Yay! Ill meet you here at first light. Bring GUNS."')}async function o(m){return m.log.write('"Nein! Meine kleinen Hoofen Thumben..."'),await s(m,'"How about Jack (who is a cow) and the Beanstalk. (a-gosh-ding-dang-gain)"'),await _(m)}async function a(m){return m.log.write('"Maaaaybeeee."'),await h(m)}async function h(m){return await s(m,'"Do you need me to guess what you need?"','"What can I do ya for?"')?await r(m):await x(m)}async function l(m){return m.log.write('"No its not. Its boring and its also dusty. The worst way for a night to be."'),await s(m,'"Its not all that bad."','"Youre right it does kinda suck"')?await c(m):await g(m)}async function c(m){return m.log.write('"It IS."'),await h(m)}async function u(m){m.log.write('"YOURE NOT MY REAL DAD!"')}async function f(m){return m.log.write('"That one spreads the harmful stereotype that all cows eat nothing but Cow Porridge."'),await s(m,'"How about Little Red Riding Cow?"','"How about Jack (who is a cow) and the Beanstalk. (a-gosh-ding-dang-gain)"')?await d(m):await _(m)}async function d(m){return m.log.write('"You KNOW me and my Grandma arent on good terms right now."'),await s(m,'"How about Die Geschichte vom Daumenlutscher."','"How about Jack (who is a cow) and the Beanstalk. (a-gosh-ding-dang-gain)"')?await o(m):await _(m)}async function p(m){return await s(m,'"Hey there, Nessie."'),m.log.write('"Hiiii."'),await s(m,'"Sure is a nice night."','"Im guessing you need something too?"')?await l(m):await a(m)}async function y(m){return await s(m,'"How about the story of the Three BillyCows Gruff?"','"How about Jack (who is a cow) and the Beanstalk. (a-gosh-ding-dang-gain)"')?await i(m):await _(m)}async function g(m){return m.log.write('"Right? Dust is the most boring type of particle!"'),await h(m)}async function x(m){return m.log.write('"Will you tell me a bedtime story? Pweeeeze?"'),await y(m)}async function _(m){return m.log.write('"Finally. Yes please"'),await m.log.showButtons("Tell story."),await e(m)}return p}function Cf(s,t){async function e(u){return u.log.write('"What? Why would you say that?"'),await s(u,`"Sorry, it's been a rough week for me."`,'"I have a hunch is all."')?await h(u):await i(u)}async function i(u){return u.log.write(`"Typical. You see an innocent award-winning champion cow and you immediately think, 'Oh, she's gonna do crimes. Cows do crimes. Let's talk about all the crime you like to do.' That's you right now. That's what you sound like."`),await s(u,`"You're right. I shouldn't have made assumptions. What's troubling you?"`),await n(u)}async function r(u){u.log.write('"Thank you. This will be my first night of real rest in months. Meet me at the town jail at HIGH NOON."')}async function n(u){return u.log.write(`"I keep having nightmares. It's all these crimes you and my sisters have been doing. They can't go on! They're gonna catch up with us! Everytime I close my eyes I see the hangman's noose."`),await s(u,`"Wow. That's heavy."`,`"Bessie. Look at me. You're being paranoid. No one is coming after us"`)?await l(u):await a(u)}async function o(u){return u.log.write('"YES"'),await s(u,'"NO!"',`"Ugh. I can't believe I'm going along with this"`)?await o(u):await r(u)}async function a(u){return u.log.write(`"I thought you might say that. That's why I snagged this poster before we left town."`),u.log.write('She shows you a wanted poster featuring the faces of Tessie, Nessie, Bessie, and yourself. it reads, "WANTED DEAD OR ALIVE Cow Crime Quartet continues crimespree and must be caught."'),await s(u,'"Oh no."'),await l(u)}async function h(u){return u.log.write(`"Well I've been having a rough time too."`),await s(u,`"Oh? How's that?"`),await n(u)}async function l(u){return u.log.write('"But I have a solution! We both want to not be held accountable for our many many crimes, and theres only one person with the power to do that holding."'),u.log.write(`OPTIONS("And who's that?" | "I do not like where this is heading even one bit." | "Ok, So murder. You're gonna suggest murder."`),u.log.write(`"The Sheriff. We've gotta take him down."`),await s(u,'"NO."',`"...I guess we're killing someone."`)?await o(u):await r(u)}async function c(u){return await s(u,`"Hi Bessie. I take it you have a crime you'd like to commit?"`),await e(u)}return c}var Pf=Ct('<span style=margin-left:20px>"<!>"');function Tf(s,t){const e=()=>["bessie.png","nessie.png","tessie.png","cow.png"];let n=s,o=!1;const a=()=>n,h=(S,T)=>{S.log.writeHTML(()=>(()=>{var E=Pf(),at=E.firstChild,L=at.nextSibling;return L.nextSibling,mt(E,T,L),E})())},l=async(S,T,E="")=>{var at=!0;return E==""?await S.log.showButtons(T):at=await S.log.showButtons(T,E)==T,h(S,at?T:E),at},c=async(S,...T)=>{const E=await S.log.showButtons(...T),at=T.indexOf(E);return h(S,E),at},u=bf(l,c),f=Sf(l,c),d=Cf(l),p=S=>S.currentNight===0?ft.fromFile("tessie.png",.3):S.currentNight===1?ft.fromFile("nessie.png",.3):S.currentNight===2?ft.fromFile("bessie.png",.3):ft.fromFile("cow.png",.3).flip(),y=async S=>{console.log("room entered"),o||(o=!0,await S.task.runTask(()=>(n-=2.5,n<=600)))};async function g(S){return await l(S,"Hey there,Tessie."),S.log.write('"Hey there, Cow Poke"'),await l(S,"Here for some before bed S'mores?","Can't sleep again, huh?")?await x(S):await w(S)}async function x(S){return S.log.write('"Noooo."'),await l(S,"Here for a campfire sing-along?","Can't sleep again, huh?")?await _(S):await w(S)}async function _(S){return S.log.write('"Not exactlyyy."'),await l(S,"Here for a shiatzu massage?","Can't sleep again, huh?")?await m(S):await w(S)}async function m(S){return S.log.write('"Noooooooo."'),await l(S,"Here to give me a shiatzu massage?","Can't sleep again, huh?")&&(S.log.write('"NOOooo!"'),await l(S,"Can't sleep again, huh?")),await w(S)}async function w(S){return S.log.write('"....yeahh. Would you sing me a lullaby?"'),await l(S,"Of course. Get cozy."),await l(S,"It's nighttime in the desert-"),await l(S,"and the wind is dying down","and sand is fast asleep")?await v(S):(S.log.write(`"oh no it's another weird one"`),await b(S))}async function v(S){return S.log.write('"All the boys are in their bedrolls and the cows are"'),await l(S,"soft and brown","wearing gowns")?await A(S):(S.log.write('"What?"'),await A(S))}async function b(S){return S.log.write('"All the boys are in their bedrolls and the cows are"'),await l(S,"with the sheep","in a heap"),await A(S)}async function A(S){return S.log.write("The moon is shining bright above. The stars are-"),await l(S,"shining too","its little friends")?await I(S):(S.log.write(`"That's cute"`),await C(S))}async function I(S){return S.log.write('"And soon the aforementioned cows and boys"'),await l(S,"will take a snooze","will eat some stew")?await P(S):(S.log.write(`"But we just had s'mores"`),await P(S))}async function C(S){return S.log.write('"And soon the aforementioned cows and boys"'),await l(S,"to dreamland wend","all catch the bends")?await P(S):(S.log.write('"Like what divers get?"'),await P(S))}async function P(S){return S.log.write('"So rest easy, lay your head down, and"'),await l(S,"just gently close your eyes","sail off to Dream Isle")?await k(S):(S.log.write('"Ooooh nautical"'),await z(S))}async function k(S){return S.log.write("'Cause soon the day will start again"),await l(S,"the big ol sun will rise","the old day will have died")?await O(S):(S.log.write('"Why so morbid?"'),await O(S))}async function z(S){return S.log.write("'Cause soon the day will start again"),await l(S,"sleep tight for just a while","time flows on like the nile")?await O(S):(S.log.write('"Kinda pretentious IMO, but okay."'),await O(S))}async function O(S){return await u(S)}return{getAssetPaths:e,getX:a,getSprite:p,onEnterRoom:y,onEnterInteractRange:async S=>{S.currentNight==0?await g(S):S.currentNight==1?await f(S):S.currentNight==2&&await d(S),S.conversationOver=!0,await S.task.runTask(()=>{n+=2.5})}}}function kf(s){return{getAssetPaths:()=>["bed.png"],getX:()=>s,getSprite:n=>ft.fromFile("bed.png",.5),onInteract:async n=>{n.conversationOver?(n.log.write("Go to sleep?"),await n.log.showButtons("yes","no")=="yes"&&(await n.fadeOut(),n.currentNight++,n.room.goTo(ba))):n.currentNight===0?n.log.write("Tessie can't sleep, go talk to her."):n.currentNight===1?n.log.write("Nessie can't sleep, go talk to her."):n.currentNight===2&&n.log.write("Bessie can't sleep, go talk to her.")}}}const Mf=s=>({getAssetPaths:()=>["campfire.png"],getX:()=>s,getSprite:r=>ft.fromFile("campfire.png",.5)}),ba=Qd(s=>{const t=async n=>{n.currentNight!=3&&(n.avatar.set(wa),n.conversationOver=!1,n.log.clear(),n.currentNight==0?(n.setSlop("eRXE8Aebp7s"),n.log.write("The three most prized cattle of Slickhand Ranch's very own Big Rustlin' Pedro De Las Vacas, each having won Best in Class at this year's Rootinest Tootinest Cow Exhibition are traveling with you, their designated protector, a Cow-Boy. Each of the claims to the various Rootin Tootin titles they held were bona fide, but their personalities were nothing short of difficult. It's been a long fortnight on the dusty trail and the small town of Cactus Sands Ravine can be seen peeking over the horizon. After setting up camp and eating your nightly dinner of Beans and S'mores you're just about ready for bed.")):n.currentNight==1?(n.setSlop("5yYYFEhvBU8"),n.log.write("It's been a long fortnight and one day on the dusty trail.  The smell of burning wood permeates the air, and smoke clouds the  gibbous moon. The small town of Free Coyote Point can be seen peeking over the horizon.  After setting up camp and eating your nightly dinner of Beans and Popcorn you're just about ready for bed.")):n.currentNight==2&&(n.setSlop("orD6yIilR0A"),n.log.write("It's been a long fortnight and two days on the dusty trail. As you set up camp you finally see lights and smoke rising from just beyond the horizon. By tomorrow at noon you'll finally be in Mesa Springs Valley to collect your payment, and, more importantly, free yourself from your three irksome charges. It was time for one last set of nightly tasks and rituals and then freedom.")),await n.fadeIn())},e=Tf(1400,s.tessieState),i=kf(50),r=Mf(320);return{avatarPosition:{x:200,y:0},objects:[e,i,r],onEnter:t,sideviewGfx:{width:700,scrollDeadzone:50}}});function Ef(){const s=Xd(),t=qd(),e=tf(),i=rf(wa),r=xf(),n=_f(),o=wf();s.attachInputHandler(t);const a=document.createElement("div");a.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: black;
    opacity: 1;
    pointer-events: none;
    z-index: 67;
  `,document.body.appendChild(a),a.offsetHeight,a.style.transition="opacity 2s ease-in-out";const h=()=>new Promise(d=>{a.style.opacity="1",setTimeout(d,2e3)}),l=()=>new Promise(d=>{a.style.opacity="0",setTimeout(d,2e3)}),c={};c.gameName="threeCow",c.log=s,c.input=t,c.layout=e,c.avatar=i,c.task=r,c.color=n,c.audio=o,c.room=Kd(c),c.color.setDark("#08586E"),c.bessieState="alive",c.nessieState="alive",c.tessieState="alive",c.currentNight=0,c.fadeOut=h,c.fadeIn=l;const[u,f]=de("");return c.getSlop=u,c.setSlop=f,c.audio.init(c),c.layout.set(mf),c.room.goTo(ba),window.addEventListener("keydown",d=>{d.key==="f"&&(document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen())}),window.addEventListener("click",d=>{document.fullscreenElement||document.documentElement.requestFullscreen()}),c}function If(){return Ef()}var Rf=Ct("<div class=app-root>");const Bf=()=>{const s=If(),t=new Me;return t.maxFPS=60,t.add(()=>{s.task.update();const e=s.avatar.get();if(e){const i=e.processInput(s,s.room.get().avatarPosition);s.room.get().avatarPosition=i}}),t.start(),ot(nf,{value:s,get children(){var e=Rf();return mt(e,()=>s.layout.get()??"no layout!"),e}})};$a(()=>ot(Bf,{}),document.getElementById("root"));export{zh as $,Go as A,nt as B,dt as C,N as D,R as E,oo as F,Os as G,Pr as H,Ge as I,hl as J,yl as K,Qe as L,F as M,K as N,j as O,et as P,Ll as Q,Mi as R,Vi as S,Me as T,Ci as U,kr as V,Qs as W,Mr as X,Nh as Y,he as Z,Y as _,So as a,so as a0,Oo as a1,B as a2,D as a3,Wl as a4,cc as a5,ic as a6,Mc as a7,Ic as a8,Gc as a9,Dc as aa,zc as ab,Qo as ac,Hr as ad,$r as ae,yn as af,St as ag,Wu as ah,$ as ai,ue as aj,hh as ak,Ye as al,Tn as am,ea as an,_t as b,tc as c,Ve as d,tt as e,Ur as f,Zl as g,_s as h,Hi as i,Bo as j,po as k,wt as l,ko as m,Xe as n,kc as o,Ec as p,Fc as q,Ah as r,Oc as s,G as t,ah as u,Wc as v,U as w,pt as x,Jn as y,xt as z};
